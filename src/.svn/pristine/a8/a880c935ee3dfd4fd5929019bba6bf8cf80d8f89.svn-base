// $Id: PlateDKBatoz.h,v 1.4 2006-10-23 23:44:01 manav Exp $

#ifndef __fesystem_plate_DKBatoz_h__
#define __fesystem_plate_DKBatoz_h__

// C++ includes

// FESystem includes
#include "StructuralElems/structural_elem.h"


namespace Discipline
{
  class AnalysisDisciplineBase;
}



#ifndef PLATE_DK_BATOZ_HX_HX_FACTOR_ENUM_ID
#define PLATE_DK_BATOZ_HX_HX_FACTOR_ENUM_ID 1
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HX_HX_FACTOR_ENUM_NAME
#define PLATE_DK_BATOZ_HX_HX_FACTOR_ENUM_NAME "PLATE_DK_BATOZ_HX_HX_FACTOR"
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HY_HY_FACTOR_ENUM_ID
#define PLATE_DK_BATOZ_HY_HY_FACTOR_ENUM_ID 2
#else
#error
#endif


#ifndef PLATE_DK_BATOZ_HY_HY_FACTOR_ENUM_NAME
#define PLATE_DK_BATOZ_HY_HY_FACTOR_ENUM_NAME "PLATE_DK_BATOZ_HY_HY_FACTOR"
#else
#error
#endif


#ifndef PLATE_DK_BATOZ_HXX_HXX_FACTOR_ENUM_ID
#define PLATE_DK_BATOZ_HXX_HXX_FACTOR_ENUM_ID 3
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HXX_HXX_FACTOR_ENUM_NAME
#define PLATE_DK_BATOZ_HXX_HXX_FACTOR_ENUM_NAME "PLATE_DK_BATOZ_HXX_HXX_FACTOR"
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HYY_HYY_FACTOR_ENUM_ID
#define PLATE_DK_BATOZ_HYY_HYY_FACTOR_ENUM_ID 4
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HYY_HYY_FACTOR_ENUM_NAME
#define PLATE_DK_BATOZ_HYY_HYY_FACTOR_ENUM_NAME "PLATE_DK_BATOZ_HYY_HYY_FACTOR"
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HXX_HYY_FACTOR_ENUM_ID
#define PLATE_DK_BATOZ_HXX_HYY_FACTOR_ENUM_ID 5
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HXX_HYY_FACTOR_ENUM_NAME
#define PLATE_DK_BATOZ_HXX_HYY_FACTOR_ENUM_NAME "PLATE_DK_BATOZ_HXX_HYY_FACTOR"
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HXY_HXY_FACTOR_ENUM_ID
#define PLATE_DK_BATOZ_HXY_HXY_FACTOR_ENUM_ID 6
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HXY_HXY_FACTOR_ENUM_NAME
#define PLATE_DK_BATOZ_HXY_HXY_FACTOR_ENUM_NAME "PLATE_DK_BATOZ_HXY_HXY_FACTOR"
#else
#error
#endif


#ifndef PLATE_DK_BATOZ_HYX_HXY_FACTOR_ENUM_ID
#define PLATE_DK_BATOZ_HYX_HXY_FACTOR_ENUM_ID 7
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HYX_HXY_FACTOR_ENUM_NAME
#define PLATE_DK_BATOZ_HYX_HXY_FACTOR_ENUM_NAME "PLATE_DK_BATOZ_HYX_HXY_FACTOR"
#else
#error
#endif


#ifndef PLATE_DK_BATOZ_HYX_HYX_FACTOR_ENUM_ID
#define PLATE_DK_BATOZ_HYX_HYX_FACTOR_ENUM_ID 8
#else
#error
#endif

#ifndef PLATE_DK_BATOZ_HYX_HYX_FACTOR_ENUM_NAME
#define PLATE_DK_BATOZ_HYX_HYX_FACTOR_ENUM_NAME "PLATE_DK_BATOZ_HYX_HYX_FACTOR"
#else
#error
#endif


namespace FESystemElem
{
  
  DeclareEnumClass(PlateDKBatozQtyEnum);
  
  DeclareEnumName(PLATE_DK_BATOZ_HX_HX_FACTOR, PlateDKBatozQtyEnum,
                  PLATE_DK_BATOZ_HX_HX_FACTOR_ENUM_ID,
                  PLATE_DK_BATOZ_HX_HX_FACTOR_ENUM_NAME);

  DeclareEnumName(PLATE_DK_BATOZ_HY_HY_FACTOR, PlateDKBatozQtyEnum,
                  PLATE_DK_BATOZ_HY_HY_FACTOR_ENUM_ID,
                  PLATE_DK_BATOZ_HY_HY_FACTOR_ENUM_NAME);
  
  DeclareEnumName(PLATE_DK_BATOZ_HXX_HXX_FACTOR, PlateDKBatozQtyEnum,
                  PLATE_DK_BATOZ_HXX_HXX_FACTOR_ENUM_ID,
                  PLATE_DK_BATOZ_HXX_HXX_FACTOR_ENUM_NAME);

  DeclareEnumName(PLATE_DK_BATOZ_HYY_HYY_FACTOR, PlateDKBatozQtyEnum,
                  PLATE_DK_BATOZ_HYY_HYY_FACTOR_ENUM_ID,
                  PLATE_DK_BATOZ_HYY_HYY_FACTOR_ENUM_NAME);

  DeclareEnumName(PLATE_DK_BATOZ_HXX_HYY_FACTOR, PlateDKBatozQtyEnum,
                  PLATE_DK_BATOZ_HXX_HYY_FACTOR_ENUM_ID,
                  PLATE_DK_BATOZ_HXX_HYY_FACTOR_ENUM_NAME);

  DeclareEnumName(PLATE_DK_BATOZ_HXY_HXY_FACTOR, PlateDKBatozQtyEnum,
                  PLATE_DK_BATOZ_HXY_HXY_FACTOR_ENUM_ID,
                  PLATE_DK_BATOZ_HXY_HXY_FACTOR_ENUM_NAME);

  DeclareEnumName(PLATE_DK_BATOZ_HYX_HXY_FACTOR, PlateDKBatozQtyEnum,
                  PLATE_DK_BATOZ_HYX_HXY_FACTOR_ENUM_ID,
                  PLATE_DK_BATOZ_HYX_HXY_FACTOR_ENUM_NAME);
  
  DeclareEnumName(PLATE_DK_BATOZ_HYX_HYX_FACTOR, PlateDKBatozQtyEnum,
                  PLATE_DK_BATOZ_HYX_HYX_FACTOR_ENUM_ID,
                  PLATE_DK_BATOZ_HYX_HYX_FACTOR_ENUM_NAME);

  
  /// this method returns the quantity specified in the arguement list. This has 
  /// been templatized so that the template can be used in derived element types.
  /// This element class will provide its element quantity and calculation routines.
  /// @param name  name of the quantity to be returned
  /// @param qty data structure in which the quantity will be removed
  /// @param side_num number of the side if this is a side quantity
  template <class QtyType >
    void getPlateDKBatozQty(FESystemElem::FESystemElemBase* elem,
                            const unsigned int name,
                            QtyType* qty,
                            const unsigned int design_point_enum_ID,
                            const unsigned int domain,
                            const bool sensitivity);

  
  class PlateDKBatoz: public FESystemElem::StructuralElem
  {
public:
    
    PlateDKBatoz(const unsigned int dim, 
                 const unsigned int elem_enum_ID,
                 Discipline::AnalysisDisciplineBase& discipline);
    
    ~PlateDKBatoz();
    
    
    /// this function returns a vector of the post process quanties for this element. The quantities will 
    /// consist of the strain, stress and their sensitivities. 
    /// @param vector of load case IDs for which the post process quantities need to be calculated
    /// @param vector of DVs for which the quantities need to be calculated
    virtual std::auto_ptr<ElemPostProcessQty> 
      getElementPostProcessQty(std::vector<unsigned int> , std::vector<DesignData::DesignParameter*>);
    
protected:
      
      /// inserts the finite element types to be used for this element in the input 
      /// parameters
      virtual void getFETypes(std::vector<FEType>& fetypes);
    
    
    /// inserts the quadrature rules to be used for the different elements
    virtual void getQuadratureRules
      (std::map<FEFamily, std::pair<QuadratureType, Order> >& quadratures);
    
    

    virtual void calculate_M(DenseMatrix<double>*, 
			     const unsigned int design_point_enum_ID,
			     bool sensitivity_calculation);
	   
    
    virtual void calculate_K(DenseMatrix<double>*, 
			     const unsigned int design_point_enum_ID,
                             bool sensitivity_calculation);
	   
	   
    /// calculates and returns the stiffness matrix
    virtual void calculate_K_G(DenseMatrix<double>*, 
                               const unsigned int design_point_enum_ID,
                               bool sensitivity_calculation);
    
    virtual void calculate_F_T(DenseVector<double>*, 
                               const unsigned int design_point_enum_ID,
                               bool sensitivity_calculation);
    

    /// this is an  method to calculate the strain operator matrices
    /// @param the vector where all the strain operators will be returned
    /// @param vector of points, defined in the element local coordinate system
    /// where the operators will be calculated
    //virtual void calculateStrainOperator(std::vector<DenseMatrix<double> >* , const std::vector<Point>* );
    
  };
}

template <class QtyType >
void
FESystemElem::getPlateDKBatozQty(FESystemElem::FESystemElemBase* elem,
                                 const unsigned int name,
                                 QtyType* qty,
                                 const unsigned int design_point_enum_ID,
                                 const unsigned int domain,
                                 const bool sensitivity)
{
  assert (qty != NULL);
  
  // the quantity here is extracted from the shape function factors obtained 
  // from the base class FESystemElemBase. A static matrix is declared for that
  
  static unsigned int n_nodes;
  n_nodes = elem->getNNodes();
  static DenseMatrix<double> matrix(n_nodes * 6, n_nodes * 6);
  
  if (qty->m() != (n_nodes * 3) || qty->n() != (n_nodes * 3))
    qty->resize(n_nodes * 3, n_nodes * 3);
  
  matrix.zero();
  qty->zero();
  
  // first get the factors from the FESystemElemBase
  // row and column store the information of where the block containing the
  // desired quantitiy start in the shape factor matrix.
  static unsigned int row, column;

  switch (sensitivity)
    {
    case false:
      {
        switch(name)
          {
          case PLATE_DK_BATOZ_HX_HX_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQty(FESystemElem::N_N_FACTOR::num(), &matrix, 
                                       design_point_enum_ID,
                                       domain, BATOZ);
              row = 0;
              column = 0;
            }
            break;
            
          case PLATE_DK_BATOZ_HY_HY_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQty(FESystemElem::N_N_FACTOR::num(), &matrix, 
                                       design_point_enum_ID,
                                       domain, BATOZ);
              row = n_nodes * 3;
              column = n_nodes * 3;
            }
            break;
            
          case PLATE_DK_BATOZ_HXX_HXX_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQty(FESystemElem::N_X_N_X_FACTOR::num(), &matrix, 
                                       design_point_enum_ID,
                                       domain, BATOZ);
              row = 0; 
              column = 0;
            }
            break;
            
          case PLATE_DK_BATOZ_HYX_HYX_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQty(FESystemElem::N_X_N_X_FACTOR::num(), &matrix, 
                                       design_point_enum_ID,
                                       domain, BATOZ);
              row = n_nodes * 3;
              column = n_nodes * 3;
            }
            break;
            
          case PLATE_DK_BATOZ_HYY_HYY_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQty(FESystemElem::N_Y_N_Y_FACTOR::num(), &matrix, 
                                       design_point_enum_ID,
                                       domain, BATOZ);
              row = n_nodes * 3;
              column = n_nodes * 3;
            }
            break;
            
          case PLATE_DK_BATOZ_HXY_HXY_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQty(FESystemElem::N_Y_N_Y_FACTOR::num(), &matrix, 
                                       design_point_enum_ID,
                                       domain, BATOZ);
              row = 0;
              column = 0;
            }
            break;
            
          case PLATE_DK_BATOZ_HXX_HYY_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQty(FESystemElem::N_X_N_Y_FACTOR::num(), &matrix, 
                                       design_point_enum_ID,
                                       domain, BATOZ);
              row = 0;
              column = n_nodes * 3;
            }
            break;
            
          case PLATE_DK_BATOZ_HYX_HXY_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQty(FESystemElem::N_X_N_Y_FACTOR::num(), &matrix, 
                                       design_point_enum_ID,
                                       domain, BATOZ);
              row = n_nodes * 3;
              column = 0;
            }
            break;
            
          default:
            Assert(false, FESystemExceptions::ExcEnumCaseNotImplemented
                   (FESystemElem::PlateDKBatozQtyEnum::enumName(name)));
          }
      }
      break;
      
    case true:
    default:
      {
        switch(name)
          {
          case PLATE_DK_BATOZ_HX_HX_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQtyShapeSensitivity(FESystemElem::N_N_FACTOR::num(),
                                                       &matrix, domain, BATOZ);
              row = 0;
              column = 0;
            }
            break;
            
          case PLATE_DK_BATOZ_HY_HY_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQtyShapeSensitivity(FESystemElem::N_N_FACTOR::num(), 
                                                       &matrix, domain, BATOZ);
              row = n_nodes * 3;
              column = n_nodes * 3;
            }
            break;
            
          case PLATE_DK_BATOZ_HXX_HXX_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQtyShapeSensitivity(FESystemElem::N_X_N_X_FACTOR::num(), 
                                                       &matrix, domain, BATOZ);
              row = 0; 
              column = 0;
            }
            break;
            
          case PLATE_DK_BATOZ_HYX_HYX_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQtyShapeSensitivity(FESystemElem::N_X_N_X_FACTOR::num(), 
                                                       &matrix, domain, BATOZ);
              row = n_nodes * 3;
              column = n_nodes * 3;
            }
            break;
            
          case PLATE_DK_BATOZ_HYY_HYY_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQtyShapeSensitivity(FESystemElem::N_Y_N_Y_FACTOR::num(),
                                                       &matrix, domain, BATOZ);
              row = n_nodes * 3;
              column = n_nodes * 3;
            }
            break;
            
          case PLATE_DK_BATOZ_HXY_HXY_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQtyShapeSensitivity(FESystemElem::N_Y_N_Y_FACTOR::num(),
                                                       &matrix, domain, BATOZ);
              row = 0;
              column = 0;
            }
            break;
            
          case PLATE_DK_BATOZ_HXX_HYY_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQtyShapeSensitivity(FESystemElem::N_X_N_Y_FACTOR::num(),
                                                       &matrix, domain, BATOZ);
              row = 0;
              column = n_nodes * 3;
            }
            break;
            
          case PLATE_DK_BATOZ_HYX_HXY_FACTOR_ENUM_ID:
            {
              elem->getFESystemElemQtyShapeSensitivity(FESystemElem::N_X_N_Y_FACTOR::num(),
                                                       &matrix, domain, BATOZ);
              row = n_nodes * 3;
              column = 0;
            }
            break;
            
          default:
            Assert(false, FESystemExceptions::ExcEnumCaseNotImplemented
                   (FESystemElem::PlateDKBatozQtyEnum::enumName(name)));
          }
      }
    }
  
  // next, copy the data to the matrix
  for (unsigned int i=0; i < n_nodes * 3; i++)
    for (unsigned int j = 0; j < n_nodes * 3; j++)
      (*qty)(i,j) = matrix(row + i, column + j);
}


#endif // __fesystem_plate_DKT_h__
