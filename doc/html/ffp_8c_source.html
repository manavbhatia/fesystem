<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>fesystem: /Users/manav/Documents/codes/FESystemOld/FESystem/src/Radiation/ShapeFactors/ffp.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">fesystem
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9e51036813d6151dfecc72d5fa7c02b3.html">Users</a>      </li>
      <li class="navelem"><a class="el" href="dir_0c900164955ce081ffb4c6b051e456bf.html">manav</a>      </li>
      <li class="navelem"><a class="el" href="dir_1c27e0e86d47954644c3da6ab29e89d2.html">Documents</a>      </li>
      <li class="navelem"><a class="el" href="dir_702da5bd4e2e61517788da49174c071d.html">codes</a>      </li>
      <li class="navelem"><a class="el" href="dir_549ad45c2f63d8c1db46ab790c4cde83.html">FESystemOld</a>      </li>
      <li class="navelem"><a class="el" href="dir_fa1b40415469e23c583052e363adf212.html">FESystem</a>      </li>
      <li class="navelem"><a class="el" href="dir_f94e632e97ff28080483f5ca56254f08.html">src</a>      </li>
      <li class="navelem"><a class="el" href="dir_b98b4ad87f29291f65739bf96e8f09a1.html">Radiation</a>      </li>
      <li class="navelem"><a class="el" href="dir_49d6848791383390c46872b31ca28141.html">ShapeFactors</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">ffp.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ffp_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* $Id: ffp.c,v 1.6 2006-09-05 20:46:33 manav Exp $ */</span>
<a name="l00002"></a>00002 
<a name="l00003"></a><a class="code" href="ffp_8c.html#a0cf3b38cc3353ed52376c64cd61460f5">00003</a> <span class="keyword">static</span>  <span class="keywordtype">char</span>    <a class="code" href="ffp_8c.html#a0cf3b38cc3353ed52376c64cd61460f5">rcs_id</a>[] = <span class="stringliteral">&quot;$Header: /Users/manav/Documents/codes/CVS_ROOT/FESystem/src/Radiation/ShapeFactors/ffp.c,v 1.6 2006-09-05 20:46:33 manav Exp $&quot;</span>;
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">/*</span>
<a name="l00006"></a>00006 <span class="comment"> * to compile on SGI use: -Wf,-XNh1500 flag to keep (acom) from choking...</span>
<a name="l00007"></a>00007 <span class="comment"> */</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00010"></a>00010 <span class="comment">/*#include &lt;values.h&gt;*/</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="claussen_8h.html">claussen.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="ff_8h.html">ff.h</a>&quot;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">/*</span>
<a name="l00017"></a>00017 <span class="comment"> * on some machines the atan2() is busted for both arguments == 0</span>
<a name="l00018"></a>00018 <span class="comment"> * e.g. the Cray YMP</span>
<a name="l00019"></a>00019 <span class="comment"> */</span>
<a name="l00020"></a>00020 <span class="preprocessor">#ifdef  _CRAY</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#define ATAN2BUSTED     1</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#endif  </span><span class="comment">/* _CRAY */</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#ifdef  ATAN2BUSTED</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#define ATAN2(y,x)      (((x)==0)&amp;&amp;((y)==0)?0:atan2(y,x))</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#else   </span><span class="comment">/* ATAN2BUSTED */</span>
<a name="l00027"></a><a class="code" href="ffp_8c.html#af0d3e6a8f32593bce622be14a9f35db3">00027</a> <span class="preprocessor">#define ATAN2(y,x)      atan2(y,x)</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#endif  </span><span class="comment">/* ATAN2BUSTED */</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="ffp_8c.html#a8747af38b86aa2bbcda2f1b1aa0888c2">00031</a> <span class="preprocessor">#define DOUBLE</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#if     defined SINGLE</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>
<a name="l00034"></a>00034 <span class="preprocessor">#ifndef HUGE</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#define HUGE    MAXFLOAT</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#endif  </span><span class="comment">/* HUGE */</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#define real    float</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#define atan2   atan2f</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#define claussen        claussenf</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#define IDilog  IDilogf</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#define log     logf</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#define atan    atanf</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#define G       Gf</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor">#define sqrt    sqrtf</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#define H       Hf</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#define Pair    Pairf</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#define Area    Areaf</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#define Bilinear        Bilinearf</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">#define acos    acosf</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#define mach    machf</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#define cos     cosf</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#define sin     sinf</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#define fabs    fabsf</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor">#define IntegralPlanar  IntegralPlanarf</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#define Lcis    Lcisf</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor">#define LogSelect       LogSelectf</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="preprocessor">#define RM      RMf</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#define IDilogPath      IDilogPathf</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#define ILogPart        ILogPartf</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#define ILogIntegral    ILogIntegralf</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="preprocessor">#define floor   floorf</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#define Integral        Integralf</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#define FormFactor      FormFactorf</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00067"></a>00067 <span class="keyword">extern</span>  <span class="keywordtype">float</span>   logf( <span class="keywordtype">float</span> );
<a name="l00068"></a>00068 <span class="keyword">extern</span>  <span class="keywordtype">float</span>   atan2f( <span class="keywordtype">float</span>, <span class="keywordtype">float</span> );
<a name="l00069"></a>00069 <span class="keyword">extern</span>  <span class="keywordtype">float</span>   atanf( <span class="keywordtype">float</span> );
<a name="l00070"></a>00070 <span class="keyword">extern</span>  <span class="keywordtype">float</span>   sqrtf( <span class="keywordtype">float</span> );
<a name="l00071"></a>00071 <span class="keyword">extern</span>  <span class="keywordtype">float</span>   acosf( <span class="keywordtype">float</span> );
<a name="l00072"></a>00072 <span class="keyword">extern</span>  <span class="keywordtype">float</span>   cosf( <span class="keywordtype">float</span> );
<a name="l00073"></a>00073 <span class="keyword">extern</span>  <span class="keywordtype">float</span>   sinf( <span class="keywordtype">float</span> );
<a name="l00074"></a>00074 <span class="keyword">extern</span>  <span class="keywordtype">float</span>   fabsf( <span class="keywordtype">float</span> );
<a name="l00075"></a>00075 <span class="keyword">extern</span>  <span class="keywordtype">float</span>   floorf( <span class="keywordtype">float</span> );
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="preprocessor">#elif   defined DOUBLE</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>
<a name="l00079"></a>00079 <span class="preprocessor">#ifndef HUGE</span>
<a name="l00080"></a><a class="code" href="ffp_8c.html#a5f3d17bf39f78da3422ca52e475d7724">00080</a> <span class="preprocessor"></span><span class="preprocessor">#define HUGE    MAXDOUBLE</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span><span class="preprocessor">#endif  </span><span class="comment">/* HUGE */</span>
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="ffp_8c.html#a257a6362afd67dfd24d287c978d84f73">00083</a> <span class="keywordtype">int</span>     <a class="code" href="ff_8h.html#a257a6362afd67dfd24d287c978d84f73">fferror</a> = <a class="code" href="ff_8h.html#a895d748ba6378e87043a7814bfb92304">NO_FF_ERROR</a>;
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">00085</a> <span class="preprocessor">#define real    double</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span>
<a name="l00087"></a>00087 <span class="preprocessor">#endif  </span><span class="comment">/* DOUBLE */</span>
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">00089</a> <span class="preprocessor">#define M_PIF   ((real)M_PI)</span>
<a name="l00090"></a><a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define HALF    ((real).5)</span>
<a name="l00091"></a><a class="code" href="ffp_8c.html#a7e4ae29b944109cc587ab4496a123869">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define THREEHALF       ((real)1.5)</span>
<a name="l00092"></a><a class="code" href="ffp_8c.html#a536bc098e8f85949ace107289b121c1b">00092</a> <span class="preprocessor"></span><span class="preprocessor">#define ONEQUARTER      ((real).25)</span>
<a name="l00093"></a><a class="code" href="ffp_8c.html#a04665f0ee88061552c25b313416efcbb">00093</a> <span class="preprocessor"></span><span class="preprocessor">#define ONEEIGHTTH      ((real).125)</span>
<a name="l00094"></a><a class="code" href="ffp_8c.html#a8cbf59b7a08a3c4de29e0f7f996e2987">00094</a> <span class="preprocessor"></span><span class="preprocessor">#define ONESIXTEENTH    ((real).0625)</span>
<a name="l00095"></a><a class="code" href="ffp_8c.html#ad1f981f8d254a72265d87e625aa4fad1">00095</a> <span class="preprocessor"></span><span class="preprocessor">#define ONETHIRTYSECOND ((real).03125)</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a>00097 <span class="comment">/*</span>
<a name="l00098"></a>00098 <span class="comment"> * the magic array is called `c&#39; and it has slots named just as</span>
<a name="l00099"></a>00099 <span class="comment"> * in the paper. There are a few extra slots which are symbolically</span>
<a name="l00100"></a>00100 <span class="comment"> * named below</span>
<a name="l00101"></a>00101 <span class="comment"> */</span>
<a name="l00102"></a><a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">00102</a> <span class="preprocessor">#define X       0</span>
<a name="l00103"></a><a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">00103</a> <span class="preprocessor"></span><span class="preprocessor">#define Y       1</span>
<a name="l00104"></a><a class="code" href="ffp_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">00104</a> <span class="preprocessor"></span><span class="preprocessor">#define L       0</span>
<a name="l00105"></a><a class="code" href="ffp_8c.html#affc9cbf86b78292bdb405361761c47f5">00105</a> <span class="preprocessor"></span><span class="preprocessor">#define U       1</span>
<a name="l00106"></a><a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">00106</a> <span class="preprocessor"></span><span class="preprocessor">#define PHI     6       </span><span class="comment">/* otherwise unused */</span>
<a name="l00107"></a><a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">00107</a> <span class="preprocessor">#define THETA   7       </span><span class="comment">/* otherwise unused */</span>
<a name="l00108"></a><a class="code" href="ffp_8c.html#a0c33b494a68ce28497e7ce8e5e95feff">00108</a> <span class="preprocessor">#define CONST   8       </span><span class="comment">/* otherwise unused */</span>
<a name="l00109"></a><a class="code" href="ffp_8c.html#afecb0a00a3c2aa965c6fb5b87d8a56bb">00109</a> <span class="preprocessor">#define PSI     9       </span><span class="comment">/* otherwise unused */</span>
<a name="l00110"></a><a class="code" href="ffp_8c.html#a7ad8eaf8fe89c7f27a41cb7e1d0d28ab">00110</a> <span class="preprocessor">#define PLANE   PSI     </span><span class="comment">/* only needed initially */</span>
<a name="l00111"></a><a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">00111</a> <span class="preprocessor">#define UPPER   19</span>
<a name="l00112"></a><a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define LOWER   20</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00114"></a>00114 <span class="comment"> * in order to facilitate custom calling sequences</span>
<a name="l00115"></a>00115 <span class="comment"> * we put the following in ff.h</span>
<a name="l00116"></a>00116 <span class="comment"> */</span>
<a name="l00117"></a>00117 <span class="preprocessor">#if 0</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span><span class="preprocessor">#define ALLCOEFF        21      </span><span class="comment">/* length of array */</span>
<a name="l00119"></a>00119 <span class="preprocessor">#endif </span><span class="comment">/* 0 */</span>
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="comment">/*</span>
<a name="l00122"></a>00122 <span class="comment"> * for debugging</span>
<a name="l00123"></a>00123 <span class="comment"> */</span>
<a name="l00124"></a><a class="code" href="ffp_8c.html#ad61844ab25ea35139950e67e9693bc9f">00124</a> <span class="preprocessor">#define PRINT(x) (print?fprintf( stderr,&quot;%.16e\n&quot;,x):0)</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span>
<a name="l00126"></a>00126 <span class="comment">/*</span>
<a name="l00127"></a>00127 <span class="comment"> * return values for Lcis</span>
<a name="l00128"></a>00128 <span class="comment"> */</span>
<a name="l00129"></a><a class="code" href="ffp_8c.html#a8c1ae9efb17aed986d77726b15b127a5">00129</a> <span class="preprocessor">#define XSOL    0x1</span>
<a name="l00130"></a><a class="code" href="ffp_8c.html#a026e60a288f0b7bb09ad33f4929a0a0b">00130</a> <span class="preprocessor"></span><span class="preprocessor">#define YSOL    0x2</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>
<a name="l00132"></a>00132 <span class="comment">/*</span>
<a name="l00133"></a>00133 <span class="comment"> * for point data structures</span>
<a name="l00134"></a>00134 <span class="comment"> */</span>
<a name="l00135"></a><a class="code" href="ffp_8c.html#a7aac0a38641f2d6b53549677fa052a79">00135</a> <span class="preprocessor">#define dot(a,b)        ((a)[0]*(b)[0]+(a)[1]*(b)[1]+(a)[2]*(b)[2])</span>
<a name="l00136"></a><a class="code" href="ffp_8c.html#a1a19b15a588d6b625095ef9d40236ff9">00136</a> <span class="preprocessor"></span><span class="preprocessor">#define cross(c,a,b)    \</span>
<a name="l00137"></a>00137 <span class="preprocessor">  ((c)[0]=(a)[1]*(b)[2]-(a)[2]*(b)[1],\</span>
<a name="l00138"></a>00138 <span class="preprocessor">   (c)[1]=(a)[2]*(b)[0]-(a)[0]*(b)[2],\</span>
<a name="l00139"></a>00139 <span class="preprocessor">   (c)[2]=(a)[0]*(b)[1]-(a)[1]*(b)[0],(c))</span>
<a name="l00140"></a><a class="code" href="ffp_8c.html#a54ee677b517b7ebe8a14cd5691f327fe">00140</a> <span class="preprocessor"></span><span class="preprocessor">#define det(a,b,c)      \</span>
<a name="l00141"></a>00141 <span class="preprocessor">  (((a)[1]*(b)[2]-(a)[2]*(b)[1])*(c)[0]+\</span>
<a name="l00142"></a>00142 <span class="preprocessor">   ((a)[2]*(b)[0]-(a)[0]*(b)[2])*(c)[1]+\</span>
<a name="l00143"></a>00143 <span class="preprocessor">   ((a)[0]*(b)[1]-(a)[1]*(b)[0])*(c)[2])</span>
<a name="l00144"></a><a class="code" href="ffp_8c.html#adfad52b9bb9b1a0e90b888a67f1a25a4">00144</a> <span class="preprocessor"></span><span class="preprocessor">#define diff(d,a,b)     \</span>
<a name="l00145"></a>00145 <span class="preprocessor">  ((d)[0]=(a)[0]-(b)[0],\</span>
<a name="l00146"></a>00146 <span class="preprocessor">   (d)[1]=(a)[1]-(b)[1],\</span>
<a name="l00147"></a>00147 <span class="preprocessor">   (d)[2]=(a)[2]-(b)[2],(d))</span>
<a name="l00148"></a><a class="code" href="ffp_8c.html#ab8d486a980706859fd24258139433b3f">00148</a> <span class="preprocessor"></span><span class="preprocessor">#define add(d,a,b)      \</span>
<a name="l00149"></a>00149 <span class="preprocessor">  ((d)[0]=(a)[0]+(b)[0],\</span>
<a name="l00150"></a>00150 <span class="preprocessor">   (d)[1]=(a)[1]+(b)[1],\</span>
<a name="l00151"></a>00151 <span class="preprocessor">   (d)[2]=(a)[2]+(b)[2],(d))</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>
<a name="l00153"></a>00153 <span class="comment">/*</span>
<a name="l00154"></a>00154 <span class="comment"> * real and imaginary part of the product of two complex numbers</span>
<a name="l00155"></a>00155 <span class="comment"> */</span>
<a name="l00156"></a><a class="code" href="ffp_8c.html#a4bfd400f3705f534cfdbd5a333ba3ef1">00156</a> <span class="preprocessor">#define cmulx(a,b)      ((a)[X]*(b)[X]-(a)[Y]*(b)[Y])</span>
<a name="l00157"></a><a class="code" href="ffp_8c.html#ae77cad0a86b3141edb34698725b8ad3f">00157</a> <span class="preprocessor"></span><span class="preprocessor">#define cmuly(a,b)      ((a)[X]*(b)[Y]+(a)[Y]*(b)[X])</span>
<a name="l00158"></a>00158 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00159"></a>00159 <span class="comment"> * complex magnitude squared</span>
<a name="l00160"></a>00160 <span class="comment"> */</span>
<a name="l00161"></a><a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">00161</a> <span class="preprocessor">#define cmagsqr(c)      ((c)[X]*(c)[X]+(c)[Y]*(c)[Y])</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00163"></a>00163 <span class="comment"> * real and imaginary part of the square of a complex number</span>
<a name="l00164"></a>00164 <span class="comment"> */</span>
<a name="l00165"></a><a class="code" href="ffp_8c.html#ad7f488e8efc2d4d2197710fbf2627d53">00165</a> <span class="preprocessor">#define sqrx(z) ((z)[X]*(z)[X]-(z)[Y]*(z)[Y])</span>
<a name="l00166"></a><a class="code" href="ffp_8c.html#a2dc0cb5646db034b4a4849d776737faa">00166</a> <span class="preprocessor"></span><span class="preprocessor">#define sqry(z) (2*(z)[X]*(z)[Y])</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>
<a name="l00168"></a>00168 <span class="comment">/*</span>
<a name="l00169"></a>00169 <span class="comment"> * on the SGI hypot is broken. Isn&#39;t that great?</span>
<a name="l00170"></a>00170 <span class="comment"> */</span>
<a name="l00171"></a><a class="code" href="ffp_8c.html#a8bbb93bf48b7cba3bdcc7decbe9ac17c">00171</a> <span class="preprocessor">#define hypot(a,b)      sqrt((a)*(a)+(b)*(b))</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>
<a name="l00173"></a>00173 <span class="comment">/*</span>
<a name="l00174"></a>00174 <span class="comment"> * imaginary part of the complex logarithm as a function</span>
<a name="l00175"></a>00175 <span class="comment"> * of the particular extension choosen</span>
<a name="l00176"></a>00176 <span class="comment"> */</span>
<a name="l00177"></a><a class="code" href="ffp_8c.html#aeb98e00b7f80d78aa4b299a6e2a3f4ae">00177</a> <span class="preprocessor">#define ilog(j,x,y)     \</span>
<a name="l00178"></a>00178 <span class="preprocessor">  (ATAN2(y,x)+(((j)==1)&amp;&amp;((y)&lt;0)&amp;&amp;((x)&lt;=0)?(real)(2*M_PIF):\</span>
<a name="l00179"></a>00179 <span class="preprocessor">                (((((j)==2)&amp;&amp;(((y)&gt;0)||(((y)==0)&amp;&amp;((x)&lt;0))))||\</span>
<a name="l00180"></a>00180 <span class="preprocessor">                   (((j)==3)&amp;&amp;((y)&gt;=0)&amp;&amp;((x)&lt;0)))? -2*M_PIF : 0)))</span>
<a name="l00181"></a>00181 <span class="preprocessor"></span>
<a name="l00182"></a>00182 <span class="comment">/*</span>
<a name="l00183"></a>00183 <span class="comment"> * computes the imaginary part of dilog for complex arguments</span>
<a name="l00184"></a>00184 <span class="comment"> */</span>
<a name="l00185"></a>00185 <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a>
<a name="l00186"></a><a class="code" href="ffp_8c.html#a86078b899292a5cd1b8a79c63831b113">00186</a> <a class="code" href="ff_8h.html#a86078b899292a5cd1b8a79c63831b113">IDilog</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> z[2] )
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> r = <a class="code" href="ffp_8c.html#a8bbb93bf48b7cba3bdcc7decbe9ac17c">hypot</a>( z[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>], z[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] );
<a name="l00189"></a>00189   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> omega = 2 * <a class="code" href="ffp_8c.html#af0d3e6a8f32593bce622be14a9f35db3">ATAN2</a>( z[Y], 1 - z[X] );
<a name="l00190"></a>00190   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> theta = 2 * <a class="code" href="ffp_8c.html#af0d3e6a8f32593bce622be14a9f35db3">ATAN2</a>( z[Y], z[X] );
<a name="l00191"></a>00191   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> result = 0;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <span class="keywordflow">if</span>( r != 0 ){
<a name="l00194"></a>00194     result = <a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> * ( omega * log( r ) +
<a name="l00195"></a>00195                      <a class="code" href="claussen_8h.html#a07f70322fd89ddee0358e88ad469771b">claussen</a>( omega ) +
<a name="l00196"></a>00196                      <a class="code" href="claussen_8h.html#a07f70322fd89ddee0358e88ad469771b">claussen</a>( theta ) -
<a name="l00197"></a>00197                      <a class="code" href="claussen_8h.html#a07f70322fd89ddee0358e88ad469771b">claussen</a>( theta + omega ) );
<a name="l00198"></a>00198   }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200   <span class="keywordflow">return</span> result;
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a>
<a name="l00204"></a><a class="code" href="ffp_8c.html#a94e475a0b12910b2529625b63c0f96fa">00204</a> <a class="code" href="ff_8h.html#a94e475a0b12910b2529625b63c0f96fa">G</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> a, <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> b, <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c, <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> t )
<a name="l00205"></a>00205 {
<a name="l00206"></a>00206   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> qt = ( a * t + b ) * t + c;
<a name="l00207"></a>00207   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> qpt = 2 * a * t + b;
<a name="l00208"></a>00208   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> <a class="code" href="_arpack_eigen_solver_8h.html#a5b4b214d30ffefbec22a9edf4a91454f">d</a> = sqrt( 4 * a * c - b * b );
<a name="l00209"></a>00209 
<a name="l00210"></a>00210   <span class="keywordflow">return</span> qpt / ( 2 * a ) * log( qt ) - 2 * t + d / a * atan( qpt / d );
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a>
<a name="l00214"></a><a class="code" href="ffp_8c.html#a31e01a0c875043c95835ed564676cfab">00214</a> <a class="code" href="ff_8h.html#a31e01a0c875043c95835ed564676cfab">H</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> a, <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> b, <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c, <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> t )
<a name="l00215"></a>00215 {
<a name="l00216"></a>00216   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> at = a * t;
<a name="l00217"></a>00217   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> qt = ( at + b ) * t + c;
<a name="l00218"></a>00218   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> twoa = 2 * a;
<a name="l00219"></a>00219   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> qpt = twoa * t + b;
<a name="l00220"></a>00220   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> <a class="code" href="_arpack_eigen_solver_8h.html#a5b4b214d30ffefbec22a9edf4a91454f">d</a> = sqrt( 4 * a * c - b * b );
<a name="l00221"></a>00221 
<a name="l00222"></a>00222   <span class="keywordflow">return</span> ( ( at * t + c ) * twoa - b * b ) / ( twoa * twoa ) * log( qt )
<a name="l00223"></a>00223     - t * ( at - b ) / twoa - b * d / ( twoa * a ) * atan( qpt / d );
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">/*</span>
<a name="l00227"></a>00227 <span class="comment"> * compute c_0 to c_5 for a given pair of edges</span>
<a name="l00228"></a>00228 <span class="comment"> */</span>
<a name="l00229"></a>00229 <span class="keywordtype">void</span>
<a name="l00230"></a><a class="code" href="ffp_8c.html#ac3f93886fb359ab10b9870669b9d2cf4">00230</a> <a class="code" href="ff_8h.html#a16a448b0a249efcc309e99fbf310f045">Pair</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c[<a class="code" href="ff_8h.html#a83636a7d3d10670956ae5a0c6ff2f9f4">ALLCOEFF</a>][2],
<a name="l00231"></a>00231       <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> p1[3], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> p2[3],
<a name="l00232"></a>00232       <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> q1[3], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> q2[3] )
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> dp[3], dq[3], qp[3];
<a name="l00235"></a>00235   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> l;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   <a class="code" href="ffp_8c.html#adfad52b9bb9b1a0e90b888a67f1a25a4">diff</a>( dp, p2, p1 );
<a name="l00238"></a>00238   c[0][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = sqrt( <a class="code" href="ffp_8c.html#a7aac0a38641f2d6b53549677fa052a79">dot</a>( dp, dp ) ); <span class="comment">/* dj */</span>
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   l = 1 / c[0][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00241"></a>00241   dp[0] *= l; dp[1] *= l; dp[2] *= l;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243   <a class="code" href="ffp_8c.html#adfad52b9bb9b1a0e90b888a67f1a25a4">diff</a>( dq, q2, q1 );
<a name="l00244"></a>00244   c[2][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = sqrt( <a class="code" href="ffp_8c.html#a7aac0a38641f2d6b53549677fa052a79">dot</a>( dq, dq ) ); <span class="comment">/* di */</span>
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   l = 1 / c[2][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00247"></a>00247   dq[0] *= l; dq[1] *= l; dq[2] *= l;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249   c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -2 * <a class="code" href="ffp_8c.html#a7aac0a38641f2d6b53549677fa052a79">dot</a>( dp, dq );
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   <a class="code" href="ffp_8c.html#adfad52b9bb9b1a0e90b888a67f1a25a4">diff</a>( qp, q1, p1 );
<a name="l00252"></a>00252   c[3][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -2 * <a class="code" href="ffp_8c.html#a7aac0a38641f2d6b53549677fa052a79">dot</a>( dp, qp );
<a name="l00253"></a>00253   c[4][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 2 * <a class="code" href="ffp_8c.html#a7aac0a38641f2d6b53549677fa052a79">dot</a>( dq, qp );
<a name="l00254"></a>00254   c[5][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = <a class="code" href="ffp_8c.html#a7aac0a38641f2d6b53549677fa052a79">dot</a>( qp, qp );
<a name="l00255"></a>00255 
<a name="l00256"></a>00256   <span class="comment">/*</span>
<a name="l00257"></a>00257 <span class="comment">   * for sanity for later</span>
<a name="l00258"></a>00258 <span class="comment">   */</span>
<a name="l00259"></a>00259   c[<a class="code" href="ffp_8c.html#a0c33b494a68ce28497e7ce8e5e95feff">CONST</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = sqrt( c[5][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] );
<a name="l00260"></a>00260   <span class="keywordflow">if</span>( c[<a class="code" href="ffp_8c.html#a0c33b494a68ce28497e7ce8e5e95feff">CONST</a>][X] &gt; <a class="code" href="claussen_8h.html#a256dd8a6ef88598b713f7e744465bb8d">mach</a>[2] ){
<a name="l00261"></a>00261     c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = c[3][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] / ( 2 * c[<a class="code" href="ffp_8c.html#a0c33b494a68ce28497e7ce8e5e95feff">CONST</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] );
<a name="l00262"></a>00262     c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = c[4][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] / ( 2 * c[<a class="code" href="ffp_8c.html#a0c33b494a68ce28497e7ce8e5e95feff">CONST</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] );
<a name="l00263"></a>00263     c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] &gt; 1 ? c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 1 :
<a name="l00264"></a>00264       ( c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] &lt; -1 ? c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -1 : c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] );
<a name="l00265"></a>00265     c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] &gt; 1 ? c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 1 :
<a name="l00266"></a>00266       ( c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] &lt; -1 ? c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -1 : c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] );
<a name="l00267"></a>00267   }<span class="keywordflow">else</span>{
<a name="l00268"></a>00268     c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * <a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a>;
<a name="l00269"></a>00269     c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] &gt; 1 ? c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 1 :
<a name="l00270"></a>00270       ( c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] &lt; -1 ? c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -1 : c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] );
<a name="l00271"></a>00271   }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273   <span class="comment">/*</span>
<a name="l00274"></a>00274 <span class="comment">   * see whether the direction vector is parallel to</span>
<a name="l00275"></a>00275 <span class="comment">   * the plane defined by the cross product of the other</span>
<a name="l00276"></a>00276 <span class="comment">   * this is just qp X dp dot dq or the determinant</span>
<a name="l00277"></a>00277 <span class="comment">   */</span>
<a name="l00278"></a>00278   c[<a class="code" href="ffp_8c.html#a7ad8eaf8fe89c7f27a41cb7e1d0d28ab">PLANE</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = <a class="code" href="ffp_8c.html#a54ee677b517b7ebe8a14cd5691f327fe">det</a>( qp, dp, dq );
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="comment">/*</span>
<a name="l00282"></a>00282 <span class="comment"> * area of a polygon</span>
<a name="l00283"></a>00283 <span class="comment"> */</span>
<a name="l00284"></a>00284 <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a>
<a name="l00285"></a><a class="code" href="ffp_8c.html#a94d6695dd6b269114148ad734a217708">00285</a> <a class="code" href="ff_8h.html#a94d6695dd6b269114148ad734a217708">Area</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> ( *p )[3], <span class="keywordtype">int</span> np )
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287   <span class="keywordtype">int</span> i, ii;
<a name="l00288"></a>00288   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> d1[3], d2[3];
<a name="l00289"></a>00289   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> a[3];
<a name="l00290"></a>00290   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c[3];
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   a[0] = a[1] = a[2] = 0;
<a name="l00293"></a>00293   <span class="keywordflow">for</span>( i = 1, ii = 2; ii &lt; np; i++, ii++ ){
<a name="l00294"></a>00294     <a class="code" href="ffp_8c.html#adfad52b9bb9b1a0e90b888a67f1a25a4">diff</a>( d1, p[i], p[0] );
<a name="l00295"></a>00295     <a class="code" href="ffp_8c.html#adfad52b9bb9b1a0e90b888a67f1a25a4">diff</a>( d2, p[ii], p[0] );
<a name="l00296"></a>00296     <a class="code" href="ffp_8c.html#a1a19b15a588d6b625095ef9d40236ff9">cross</a>( c, d1, d2 );
<a name="l00297"></a>00297     <a class="code" href="ffp_8c.html#ab8d486a980706859fd24258139433b3f">add</a>( a, a, c );
<a name="l00298"></a>00298   }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="keywordflow">return</span> sqrt( a[0] * a[0] + a[1] * a[1] + a[2] * a[2] ) * <a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a>;
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 <span class="comment">/*</span>
<a name="l00304"></a>00304 <span class="comment"> * compute the quantities necessary if the two edges share a plane</span>
<a name="l00305"></a>00305 <span class="comment"> */</span>
<a name="l00306"></a>00306 <span class="keywordtype">int</span>
<a name="l00307"></a><a class="code" href="ffp_8c.html#ac61a1c609ad9a74ba415c5a5e8a2e9ee">00307</a> <a class="code" href="ff_8h.html#ad4e1d7a295e34cafaae901f9676bcfbd">Bilinear</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c[<a class="code" href="ff_8h.html#a83636a7d3d10670956ae5a0c6ff2f9f4">ALLCOEFF</a>][2] )
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309   <span class="keywordflow">if</span>( c[<a class="code" href="ffp_8c.html#a7ad8eaf8fe89c7f27a41cb7e1d0d28ab">PLANE</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * c[<a class="code" href="ffp_8c.html#a7ad8eaf8fe89c7f27a41cb7e1d0d28ab">PLANE</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] &lt; <a class="code" href="claussen_8h.html#a256dd8a6ef88598b713f7e744465bb8d">mach</a>[2] ){
<a name="l00310"></a>00310     <span class="comment">/*</span>
<a name="l00311"></a>00311 <span class="comment">     * guaranteed to share a plane</span>
<a name="l00312"></a>00312 <span class="comment">     */</span>
<a name="l00313"></a>00313     <span class="keywordflow">if</span>( c[<a class="code" href="ffp_8c.html#a0c33b494a68ce28497e7ce8e5e95feff">CONST</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] &lt; <a class="code" href="claussen_8h.html#a256dd8a6ef88598b713f7e744465bb8d">mach</a>[2] ){
<a name="l00314"></a>00314       c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = sin( acos( c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] ) );
<a name="l00315"></a>00315       c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 1; c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = 0;
<a name="l00316"></a>00316     }<span class="keywordflow">else</span>{
<a name="l00317"></a>00317       <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> ts = sin( acos( c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] ) );
<a name="l00318"></a>00318       <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> ps = sin( acos( c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][X] ) );
<a name="l00319"></a>00319       
<a name="l00320"></a>00320       <span class="keywordflow">if</span>( c[1][X] * <a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> - ( c[3][X] * c[4][X] ) / ( 4 * c[5][X] ) &gt; 0 ){
<a name="l00321"></a>00321         c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = ts; c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = ps;
<a name="l00322"></a>00322       }<span class="keywordflow">else</span>{
<a name="l00323"></a>00323         c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -ts; c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = ps;
<a name="l00324"></a>00324       }
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326     <span class="keywordflow">return</span> 1;
<a name="l00327"></a>00327   }<span class="keywordflow">else</span>{
<a name="l00328"></a>00328     <span class="keywordflow">return</span> 0;
<a name="l00329"></a>00329   }
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 <span class="comment">/*</span>
<a name="l00333"></a>00333 <span class="comment"> * evaluate h^2(log(h)-1.5)</span>
<a name="l00334"></a>00334 <span class="comment"> */</span>
<a name="l00335"></a><a class="code" href="ffp_8c.html#a4da31d0bfd7b67cd40c9ff10ebb5e603">00335</a> <span class="preprocessor">#define evalintp(f,c,s,t)       \</span>
<a name="l00336"></a>00336 <span class="preprocessor">  (tmp[X]=(s)*(c)[THETA][X]+(t)*(c)[PHI][X]+(c)[CONST][X],\</span>
<a name="l00337"></a>00337 <span class="preprocessor">   tmp[Y]=(s)*(c)[THETA][Y]+(t)*(c)[PHI][Y],\</span>
<a name="l00338"></a>00338 <span class="preprocessor">   tmp2[X]=sqrx(tmp),tmp2[Y]=sqry(tmp),\</span>
<a name="l00339"></a>00339 <span class="preprocessor">   tmp[Y]=ATAN2(tmp[Y],tmp[X]),tmp[X]=cmagsqr(tmp2),\</span>
<a name="l00340"></a>00340 <span class="preprocessor">   tmp[X]=((tmp[X]&gt;mach[0]?ONEQUARTER*log(tmp[X]):0)-THREEHALF),\</span>
<a name="l00341"></a>00341 <span class="preprocessor">   (f)[X]+=cmulx(tmp,tmp2),(f)[Y]+=cmuly(tmp,tmp2))</span>
<a name="l00342"></a><a class="code" href="ffp_8c.html#a47f4772d27fc21bb951b020eb518a718">00342</a> <span class="preprocessor"></span><span class="preprocessor">#define evalintm(f,c,s,t)       \</span>
<a name="l00343"></a>00343 <span class="preprocessor">  (tmp[X]=(s)*(c)[THETA][X]+(t)*(c)[PHI][X]+(c)[CONST][X],\</span>
<a name="l00344"></a>00344 <span class="preprocessor">   tmp[Y]=(s)*(c)[THETA][Y]+(t)*(c)[PHI][Y],\</span>
<a name="l00345"></a>00345 <span class="preprocessor">   tmp2[X]=sqrx(tmp),tmp2[Y]=sqry(tmp),\</span>
<a name="l00346"></a>00346 <span class="preprocessor">   tmp[Y]=ATAN2(tmp[Y],tmp[X]),tmp[X]=cmagsqr(tmp2),\</span>
<a name="l00347"></a>00347 <span class="preprocessor">   tmp[X]=((tmp[X]&gt;mach[0]?ONEQUARTER*log(tmp[X]):0)-THREEHALF),\</span>
<a name="l00348"></a>00348 <span class="preprocessor">   (f)[X]-=cmulx(tmp,tmp2),(f)[Y]-=cmuly(tmp,tmp2))</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span>
<a name="l00350"></a>00350 <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a>
<a name="l00351"></a><a class="code" href="ffp_8c.html#abf89798190ee96db2c54b902ec3124c4">00351</a> <a class="code" href="ff_8h.html#ac26d45524b1c5dc5a209f8d80580c6aa">IntegralPlanar</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c[<a class="code" href="ff_8h.html#a83636a7d3d10670956ae5a0c6ff2f9f4">ALLCOEFF</a>][2] )
<a name="l00352"></a>00352 {
<a name="l00353"></a>00353   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> tmp[2], tmp2[2]; <span class="comment">/* for evalint{p|m}() macro */</span>
<a name="l00354"></a>00354   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> den[2], f[2];
<a name="l00355"></a>00355 
<a name="l00356"></a>00356   den[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = <a class="code" href="ffp_8c.html#a4bfd400f3705f534cfdbd5a333ba3ef1">cmulx</a>( c[<a class="code" href="ffp_8c.html#aaa169fd8b9a843d1bd57fe1eae032115">THETA</a>], c[<a class="code" href="ffp_8c.html#a2203853edabc3de5f785e54b55eb5e3c">PHI</a>] );
<a name="l00357"></a>00357   den[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -<a class="code" href="ffp_8c.html#ae77cad0a86b3141edb34698725b8ad3f">cmuly</a>( c[THETA], c[PHI] );
<a name="l00358"></a>00358 
<a name="l00359"></a>00359   f[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = f[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = 0;
<a name="l00360"></a>00360   <a class="code" href="ffp_8c.html#a4da31d0bfd7b67cd40c9ff10ebb5e603">evalintp</a>( f, c, c[0][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>], c[2][X] );
<a name="l00361"></a>00361   <a class="code" href="ffp_8c.html#a47f4772d27fc21bb951b020eb518a718">evalintm</a>( f, c, c[0][X], 0 );
<a name="l00362"></a>00362   <a class="code" href="ffp_8c.html#a47f4772d27fc21bb951b020eb518a718">evalintm</a>( f, c, 0, c[2][X] );
<a name="l00363"></a>00363   <a class="code" href="ffp_8c.html#a4da31d0bfd7b67cd40c9ff10ebb5e603">evalintp</a>( f, c, 0, 0 );
<a name="l00364"></a>00364   
<a name="l00365"></a>00365   <span class="keywordflow">return</span> <a class="code" href="ffp_8c.html#a4bfd400f3705f534cfdbd5a333ba3ef1">cmulx</a>( den, f );
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="comment">/*</span>
<a name="l00369"></a>00369 <span class="comment"> * (L)ine (C)ircle (I)nter(s)ection</span>
<a name="l00370"></a>00370 <span class="comment"> */</span>
<a name="l00371"></a>00371 <span class="keywordtype">int</span>
<a name="l00372"></a><a class="code" href="ffp_8c.html#a9ec837e66acfd00f690d2d5c13af764e">00372</a> <a class="code" href="ff_8h.html#a9ec837e66acfd00f690d2d5c13af764e">Lcis</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> xax[2], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> yax[2], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> rad[2], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> cnt[2] )
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374   <span class="comment">/*</span>
<a name="l00375"></a>00375 <span class="comment">   * see whether a circle at c with radius r</span>
<a name="l00376"></a>00376 <span class="comment">   * intersects the x or y axis</span>
<a name="l00377"></a>00377 <span class="comment">   */</span>
<a name="l00378"></a>00378   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> cabs = <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( cnt );
<a name="l00379"></a>00379   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> rabs = <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( rad );
<a name="l00380"></a>00380   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> xdisc = cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] - cabs + rabs;
<a name="l00381"></a>00381   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> ydisc = cnt[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * cnt[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] - cabs + rabs;
<a name="l00382"></a>00382   <span class="keywordtype">int</span> ret = 0;
<a name="l00383"></a>00383   
<a name="l00384"></a>00384   <span class="keywordflow">if</span>( xdisc &gt;= 0 ){
<a name="l00385"></a>00385     xdisc = sqrt( xdisc );
<a name="l00386"></a>00386     xax[0] = cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] + xdisc;
<a name="l00387"></a>00387     xax[1] = cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] - xdisc;
<a name="l00388"></a>00388     ret |= <a class="code" href="ffp_8c.html#a8c1ae9efb17aed986d77726b15b127a5">XSOL</a>;
<a name="l00389"></a>00389   }<span class="keywordflow">else</span>{
<a name="l00390"></a>00390     xax[0] = xax[1] = <a class="code" href="ffp_8c.html#a5f3d17bf39f78da3422ca52e475d7724">HUGE</a>;
<a name="l00391"></a>00391   }
<a name="l00392"></a>00392   <span class="keywordflow">if</span>( ydisc &gt;= 0 ){
<a name="l00393"></a>00393     ydisc = sqrt( ydisc );
<a name="l00394"></a>00394     yax[0] = cnt[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] + ydisc;
<a name="l00395"></a>00395     yax[1] = cnt[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] - ydisc;
<a name="l00396"></a>00396     ret |= <a class="code" href="ffp_8c.html#a026e60a288f0b7bb09ad33f4929a0a0b">YSOL</a>;
<a name="l00397"></a>00397   }<span class="keywordflow">else</span>{
<a name="l00398"></a>00398     yax[0] = yax[1] = <a class="code" href="ffp_8c.html#a5f3d17bf39f78da3422ca52e475d7724">HUGE</a>;
<a name="l00399"></a>00399   }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401   <span class="keywordflow">return</span> ret;
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="comment">/*</span>
<a name="l00405"></a>00405 <span class="comment"> * is the given intersection of the circle with one of the axes</span>
<a name="l00406"></a>00406 <span class="comment"> * in the range between l and u?</span>
<a name="l00407"></a>00407 <span class="comment"> */</span>
<a name="l00408"></a><a class="code" href="ffp_8c.html#a665ad4c3c21a2e65a8fa7ed4eb2c02a4">00408</a> <span class="preprocessor">#define seghitx(x,psi)  \</span>
<a name="l00409"></a>00409 <span class="preprocessor">  (tmp=ATAN2(-rad[Y]*((x)-cnt[X])-rad[X]*cnt[Y],\</span>
<a name="l00410"></a>00410 <span class="preprocessor">              rad[X]*((x)-cnt[X])-rad[Y]*cnt[Y]),\</span>
<a name="l00411"></a>00411 <span class="preprocessor">   (psi)[L]&lt;(psi)[U]?(tmp&gt;=(psi)[L]?tmp&lt;=(psi)[U]:0):\</span>
<a name="l00412"></a>00412 <span class="preprocessor">                     (tmp&gt;=(psi)[U]?tmp&lt;=(psi)[L]:0))</span>
<a name="l00413"></a><a class="code" href="ffp_8c.html#a54cf31934d7f5b4b70b176ea26da0097">00413</a> <span class="preprocessor"></span><span class="preprocessor">#define seghity(x,psi)  \</span>
<a name="l00414"></a>00414 <span class="preprocessor">  (tmp=ATAN2(rad[Y]*cnt[X]+rad[X]*((x)-cnt[Y]),\</span>
<a name="l00415"></a>00415 <span class="preprocessor">              -rad[X]*cnt[X]+rad[Y]*((x)-cnt[Y])),\</span>
<a name="l00416"></a>00416 <span class="preprocessor">   (psi)[L]&lt;(psi)[U]?(tmp&gt;=(psi)[L]?tmp&lt;=(psi)[U]:0):\</span>
<a name="l00417"></a>00417 <span class="preprocessor">                     (tmp&gt;=(psi)[U]?tmp&lt;=(psi)[L]:0))</span>
<a name="l00418"></a>00418 <span class="preprocessor"></span>
<a name="l00419"></a>00419 <span class="comment">/*</span>
<a name="l00420"></a>00420 <span class="comment"> * based on whether a circle segment between angles (l)ower</span>
<a name="l00421"></a>00421 <span class="comment"> * and (u)pper intersects any of the coordinate axes, return</span>
<a name="l00422"></a>00422 <span class="comment"> * an index for the particular extension of the complex</span>
<a name="l00423"></a>00423 <span class="comment"> * logarithm which does not put the branchcut under our path</span>
<a name="l00424"></a>00424 <span class="comment"> * (of integration).</span>
<a name="l00425"></a>00425 <span class="comment"> */</span>
<a name="l00426"></a>00426 <span class="keywordtype">int</span>
<a name="l00427"></a><a class="code" href="ffp_8c.html#aac86cb0d272975513dcceff485dc6e23">00427</a> <a class="code" href="ff_8h.html#aac86cb0d272975513dcceff485dc6e23">LogSelect</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> rad[2], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> cnt[2], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> psi[2] )
<a name="l00428"></a>00428 {
<a name="l00429"></a>00429   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> tmp; <span class="comment">/* seghit() needs this one */</span>
<a name="l00430"></a>00430   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> xax[2], yax[2];
<a name="l00431"></a>00431   <span class="keywordtype">int</span> sl;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433   <span class="comment">/*</span>
<a name="l00434"></a>00434 <span class="comment">   * get intersections, if any and return the index of the</span>
<a name="l00435"></a>00435 <span class="comment">   * particular extension of the logarithm to be used</span>
<a name="l00436"></a>00436 <span class="comment">   */</span>
<a name="l00437"></a>00437   <span class="comment">/*</span>
<a name="l00438"></a>00438 <span class="comment">   * there is some debate whether the below should use</span>
<a name="l00439"></a>00439 <span class="comment">   * &lt;= (&gt;=) or &lt; (&gt;) depending on whether atan(0,0) is</span>
<a name="l00440"></a>00440 <span class="comment">   * considered a well defined point (it is not, but in</span>
<a name="l00441"></a>00441 <span class="comment">   * practice 0 is returned and that seems to work...)</span>
<a name="l00442"></a>00442 <span class="comment">   */</span>
<a name="l00443"></a>00443   sl = <a class="code" href="ff_8h.html#a9ec837e66acfd00f690d2d5c13af764e">Lcis</a>( xax, yax, rad, cnt );
<a name="l00444"></a>00444   <span class="keywordflow">if</span>( !( ( sl &amp; <a class="code" href="ffp_8c.html#a8c1ae9efb17aed986d77726b15b127a5">XSOL</a> ) &amp;&amp;
<a name="l00445"></a>00445         ( ( ( xax[0] &lt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a665ad4c3c21a2e65a8fa7ed4eb2c02a4">seghitx</a>( xax[0], psi ) ) ||
<a name="l00446"></a>00446          ( ( xax[1] &lt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a665ad4c3c21a2e65a8fa7ed4eb2c02a4">seghitx</a>( xax[1], psi ) ) ) ) ){
<a name="l00447"></a>00447     <span class="keywordflow">return</span> 0;
<a name="l00448"></a>00448   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( !( ( sl &amp; <a class="code" href="ffp_8c.html#a026e60a288f0b7bb09ad33f4929a0a0b">YSOL</a> ) &amp;&amp;
<a name="l00449"></a>00449               ( ( ( yax[0] &lt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a54cf31934d7f5b4b70b176ea26da0097">seghity</a>( yax[0], psi ) ) ||
<a name="l00450"></a>00450                ( ( yax[1] &lt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a54cf31934d7f5b4b70b176ea26da0097">seghity</a>( yax[1], psi ) ) ) ) ){
<a name="l00451"></a>00451     <span class="keywordflow">return</span> 1;
<a name="l00452"></a>00452   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( !( ( sl &amp; YSOL ) &amp;&amp;
<a name="l00453"></a>00453               ( ( ( yax[0] &gt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a54cf31934d7f5b4b70b176ea26da0097">seghity</a>( yax[0], psi ) ) ||
<a name="l00454"></a>00454                ( ( yax[1] &gt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a54cf31934d7f5b4b70b176ea26da0097">seghity</a>( yax[1], psi ) ) ) ) ){
<a name="l00455"></a>00455     <span class="keywordflow">return</span> 3;
<a name="l00456"></a>00456   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( !( ( sl &amp; XSOL ) &amp;&amp;
<a name="l00457"></a>00457               ( ( ( xax[0] &gt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a665ad4c3c21a2e65a8fa7ed4eb2c02a4">seghitx</a>( xax[0], psi ) ) ||
<a name="l00458"></a>00458                ( ( xax[1] &gt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a665ad4c3c21a2e65a8fa7ed4eb2c02a4">seghitx</a>( xax[1], psi ) ) ) ) ){
<a name="l00459"></a>00459     <span class="keywordflow">return</span> 2;
<a name="l00460"></a>00460   }<span class="keywordflow">else</span>{
<a name="l00461"></a>00461     assert( 0 );
<a name="l00462"></a>00462     <span class="keywordflow">return</span> 0;
<a name="l00463"></a>00463   }
<a name="l00464"></a>00464 }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 <span class="comment">/*</span>
<a name="l00467"></a>00467 <span class="comment"> * only the real part of M</span>
<a name="l00468"></a>00468 <span class="comment"> */</span>
<a name="l00469"></a>00469 <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a>
<a name="l00470"></a><a class="code" href="ffp_8c.html#a5dbedd2152370d1b5fb3616ccd7925a1">00470</a> <a class="code" href="ff_8h.html#a5dbedd2152370d1b5fb3616ccd7925a1">RM</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> z[2] )
<a name="l00471"></a>00471 {
<a name="l00472"></a>00472   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> t2_1[2]; <span class="comment">/* conj(t^2 - 1) */</span>
<a name="l00473"></a>00473   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> t2_1_2[2]; <span class="comment">/* conj(t^2 - 1)^2 */</span>
<a name="l00474"></a>00474   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> t_1[2], tp1[2]; <span class="comment">/* t-1, t+1 */</span>
<a name="l00475"></a>00475   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> quot;
<a name="l00476"></a>00476 
<a name="l00477"></a>00477   t2_1[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = <a class="code" href="ffp_8c.html#ad7f488e8efc2d4d2197710fbf2627d53">sqrx</a>( z ) - 1; t2_1[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -<a class="code" href="ffp_8c.html#a2dc0cb5646db034b4a4849d776737faa">sqry</a>( z );
<a name="l00478"></a>00478   t2_1_2[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = <a class="code" href="ffp_8c.html#ad7f488e8efc2d4d2197710fbf2627d53">sqrx</a>( t2_1 ); t2_1_2[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = <a class="code" href="ffp_8c.html#a2dc0cb5646db034b4a4849d776737faa">sqry</a>( t2_1 );
<a name="l00479"></a>00479   quot = 1 / <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( t2_1 );
<a name="l00480"></a>00480   t_1[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = z[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] - 1; t_1[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = z[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00481"></a>00481   tp1[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = z[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] + 1; tp1[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = z[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00482"></a>00482 
<a name="l00483"></a>00483   <span class="keywordflow">return</span> <a class="code" href="ffp_8c.html#a536bc098e8f85949ace107289b121c1b">ONEQUARTER</a> * <a class="code" href="ffp_8c.html#a4bfd400f3705f534cfdbd5a333ba3ef1">cmulx</a>( z, t2_1_2 ) * quot * quot +
<a name="l00484"></a>00484       <a class="code" href="ffp_8c.html#a04665f0ee88061552c25b313416efcbb">ONEEIGHTTH</a> * <a class="code" href="ffp_8c.html#a4bfd400f3705f534cfdbd5a333ba3ef1">cmulx</a>( z, t2_1 ) * quot +
<a name="l00485"></a>00485         <a class="code" href="ffp_8c.html#ad1f981f8d254a72265d87e625aa4fad1">ONETHIRTYSECOND</a> * log( <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( t_1 ) / <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( tp1 ) );
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 <span class="comment">/*</span>
<a name="l00489"></a>00489 <span class="comment"> * turn segment on unit circle into segment on given circle</span>
<a name="l00490"></a>00490 <span class="comment"> */</span>
<a name="l00491"></a><a class="code" href="ffp_8c.html#ab1b150d0765c946ccf58127cfbdf20d9">00491</a> <span class="preprocessor">#define circlemap(p,t)  \</span>
<a name="l00492"></a>00492 <span class="preprocessor">    ((p)[X]=1-cnt[X]-cmulx(rad,t),\</span>
<a name="l00493"></a>00493 <span class="preprocessor">     (p)[Y]=-cnt[Y]-cmuly(rad,t))</span>
<a name="l00494"></a>00494 <span class="preprocessor"></span>
<a name="l00495"></a>00495 <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a>
<a name="l00496"></a><a class="code" href="ffp_8c.html#a35cc45ed551b38b7e1b8642183027740">00496</a> <a class="code" href="ff_8h.html#ada7d91a116af2f5310f10d33d1d187b1">IDilogPath</a>( <span class="keywordtype">int</span> k, <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> rad[2], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> cnt[2], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c[<a class="code" href="ff_8h.html#a83636a7d3d10670956ae5a0c6ff2f9f4">ALLCOEFF</a>][2] )
<a name="l00497"></a>00497 {
<a name="l00498"></a>00498   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> xax[2], yax[2], end[2], start[2];
<a name="l00499"></a>00499   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> tmp; <span class="comment">/* seghit() needs this one */</span>
<a name="l00500"></a>00500   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> parg, p[2];
<a name="l00501"></a>00501   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> f;
<a name="l00502"></a>00502   <span class="keywordtype">int</span> sl;
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <span class="comment">/*</span>
<a name="l00505"></a>00505 <span class="comment">   * if we don&#39;t walk over the branchcut we just apply</span>
<a name="l00506"></a>00506 <span class="comment">   * the dilog</span>
<a name="l00507"></a>00507 <span class="comment">   */</span>
<a name="l00508"></a>00508   <a class="code" href="ffp_8c.html#ab1b150d0765c946ccf58127cfbdf20d9">circlemap</a>( end, c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>] );
<a name="l00509"></a>00509   <a class="code" href="ffp_8c.html#ab1b150d0765c946ccf58127cfbdf20d9">circlemap</a>( start, c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>] );
<a name="l00510"></a>00510   f = <a class="code" href="ff_8h.html#a86078b899292a5cd1b8a79c63831b113">IDilog</a>( end ) - <a class="code" href="ff_8h.html#a86078b899292a5cd1b8a79c63831b113">IDilog</a>( start );
<a name="l00511"></a>00511 
<a name="l00512"></a>00512   <span class="comment">/*</span>
<a name="l00513"></a>00513 <span class="comment">   * return the points where the given circle cuts the real axis</span>
<a name="l00514"></a>00514 <span class="comment">   */</span>
<a name="l00515"></a>00515   sl = <a class="code" href="ff_8h.html#a9ec837e66acfd00f690d2d5c13af764e">Lcis</a>( xax, yax, rad, cnt );
<a name="l00516"></a>00516 
<a name="l00517"></a>00517   <span class="comment">/*</span>
<a name="l00518"></a>00518 <span class="comment">   * we have to correct for the branchcut:</span>
<a name="l00519"></a>00519 <span class="comment">   * </span>
<a name="l00520"></a>00520 <span class="comment">   * only if there are any solutions,</span>
<a name="l00521"></a>00521 <span class="comment">   * the solutions are on the negative real axis,</span>
<a name="l00522"></a>00522 <span class="comment">   * they are within the segment of interest,</span>
<a name="l00523"></a>00523 <span class="comment">   * there is only one intersection (we actually</span>
<a name="l00524"></a>00524 <span class="comment">   * cross)</span>
<a name="l00525"></a>00525 <span class="comment">   */</span>
<a name="l00526"></a>00526   <span class="keywordflow">if</span>( ( ( k == 1 ) || ( k == 3 ) ) &amp;&amp;
<a name="l00527"></a>00527      ( ( ( xax[0] &lt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a665ad4c3c21a2e65a8fa7ed4eb2c02a4">seghitx</a>( xax[0], c[<a class="code" href="ffp_8c.html#afecb0a00a3c2aa965c6fb5b87d8a56bb">PSI</a>] ) ) !=
<a name="l00528"></a>00528       ( ( xax[1] &lt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a665ad4c3c21a2e65a8fa7ed4eb2c02a4">seghitx</a>( xax[1], c[PSI] ) ) ) ){
<a name="l00529"></a>00529     <span class="comment">/*</span>
<a name="l00530"></a>00530 <span class="comment">     * for the dilog we have an argument of the form</span>
<a name="l00531"></a>00531 <span class="comment">     * 1-z, compute it and its arg</span>
<a name="l00532"></a>00532 <span class="comment">     */</span>
<a name="l00533"></a>00533     <span class="keywordflow">if</span>( ( xax[0] &lt;= 0 ) &amp;&amp; <a class="code" href="ffp_8c.html#a665ad4c3c21a2e65a8fa7ed4eb2c02a4">seghitx</a>( xax[0], c[PSI] ) ){
<a name="l00534"></a>00534       p[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 1 - xax[0]; p[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = 0;
<a name="l00535"></a>00535       parg = <a class="code" href="ffp_8c.html#af0d3e6a8f32593bce622be14a9f35db3">ATAN2</a>( -rad[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * ( xax[0] - cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] ) - rad[X] * cnt[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>],
<a name="l00536"></a>00536                     rad[X] * ( xax[0] - cnt[X] ) - rad[Y] * cnt[Y] );
<a name="l00537"></a>00537     }<span class="keywordflow">else</span>{
<a name="l00538"></a>00538       p[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 1 - xax[1]; p[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = 0;
<a name="l00539"></a>00539       parg = <a class="code" href="ffp_8c.html#af0d3e6a8f32593bce622be14a9f35db3">ATAN2</a>( -rad[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * ( xax[1] - cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] ) - rad[X] * cnt[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>],
<a name="l00540"></a>00540                     rad[X] * ( xax[1] - cnt[X] ) - rad[Y] * cnt[Y] );
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543     <span class="keywordflow">if</span>( k == 1 ){
<a name="l00544"></a>00544       <span class="keywordflow">if</span>( parg * ( c[PSI][<a class="code" href="ffp_8c.html#affc9cbf86b78292bdb405361761c47f5">U</a>] - c[PSI][<a class="code" href="ffp_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>] ) * ( p[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] - cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] ) &lt; 0 ){
<a name="l00545"></a>00545         f += -<a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">M_PIF</a> *
<a name="l00546"></a>00546           ( 2 * log( <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( p ) ) - log( <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( start ) ) );
<a name="l00547"></a>00547       }<span class="keywordflow">else</span>{
<a name="l00548"></a>00548         f += -<a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">M_PIF</a> * log( <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( end ) );
<a name="l00549"></a>00549       }
<a name="l00550"></a>00550     }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( k == 3 ){
<a name="l00551"></a>00551       <span class="keywordflow">if</span>( parg * ( c[PSI][<a class="code" href="ffp_8c.html#affc9cbf86b78292bdb405361761c47f5">U</a>] - c[PSI][<a class="code" href="ffp_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>] ) * ( p[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] - cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] ) &lt; 0 ){
<a name="l00552"></a>00552         f += -<a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">M_PIF</a> *
<a name="l00553"></a>00553           ( 2 * log( <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( p ) ) - log( <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( end ) ) );
<a name="l00554"></a>00554       }<span class="keywordflow">else</span>{
<a name="l00555"></a>00555         f += -<a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">M_PIF</a> * log( <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( start ) );
<a name="l00556"></a>00556       }
<a name="l00557"></a>00557     }
<a name="l00558"></a>00558   }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560   <span class="keywordflow">return</span> f;
<a name="l00561"></a>00561 }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <span class="comment">/*</span>
<a name="l00564"></a>00564 <span class="comment"> * 2(b-t)/((b^2-1)(t^2-1))+</span>
<a name="l00565"></a>00565 <span class="comment"> */</span>
<a name="l00566"></a><a class="code" href="ffp_8c.html#a54f916ec53efcf798f6625285ffe1391">00566</a> <span class="preprocessor">#define subexpr1(c)     \</span>
<a name="l00567"></a>00567 <span class="preprocessor">  (tmp[X]=sqrx(z)-1,tmp[Y]=sqry(z),\</span>
<a name="l00568"></a>00568 <span class="preprocessor">   tmp2[X]=sqrx(c)-1,tmp2[Y]=sqry(c),\</span>
<a name="l00569"></a>00569 <span class="preprocessor">   denom[X]=cmulx(tmp,tmp2),denom[Y]=-cmuly(tmp,tmp2),\</span>
<a name="l00570"></a>00570 <span class="preprocessor">   fac[X]=2*(z[X]-(c)[X]),fac[Y]=2*(z[Y]-(c)[Y]),\</span>
<a name="l00571"></a>00571 <span class="preprocessor">   cmuly(fac,denom)/cmagsqr(denom))</span>
<a name="l00572"></a>00572 <span class="preprocessor"></span>
<a name="l00573"></a>00573 <span class="comment">/*</span>
<a name="l00574"></a>00574 <span class="comment"> * -p1[t-1]b/(1+b)^2</span>
<a name="l00575"></a>00575 <span class="comment"> */</span>
<a name="l00576"></a><a class="code" href="ffp_8c.html#abeb739af71c78e8c9127f5dfb3af8a2f">00576</a> <span class="preprocessor">#define subexpr2(c)     \</span>
<a name="l00577"></a>00577 <span class="preprocessor">  (tmp[X]=z[X]+1,tmp[Y]=z[Y],\</span>
<a name="l00578"></a>00578 <span class="preprocessor">   tmp2[X]=sqrx(tmp),tmp2[Y]=-sqry(tmp),\</span>
<a name="l00579"></a>00579 <span class="preprocessor">   fac[X]=-cmulx(z,tmp2),fac[Y]=-cmuly(z,tmp2),\</span>
<a name="l00580"></a>00580 <span class="preprocessor">   tmp[X]=(c)[X]-1,tmp[Y]=(c)[Y],\</span>
<a name="l00581"></a>00581 <span class="preprocessor">   (fac[X]*ilog(p1,tmp[X],tmp[Y])+\</span>
<a name="l00582"></a>00582 <span class="preprocessor">    fac[Y]*HALF*log(cmagsqr(tmp)))/cmagsqr(tmp2))</span>
<a name="l00583"></a>00583 <span class="preprocessor"></span>
<a name="l00584"></a>00584 <span class="comment">/*</span>
<a name="l00585"></a>00585 <span class="comment"> * -p1[1+t]b/(b-1)^2</span>
<a name="l00586"></a>00586 <span class="comment"> */</span>
<a name="l00587"></a><a class="code" href="ffp_8c.html#ac58f8f04c010827e2b84728a670dfde5">00587</a> <span class="preprocessor">#define subexpr3(c)     \</span>
<a name="l00588"></a>00588 <span class="preprocessor">  (tmp[X]=z[X]-1,tmp[Y]=z[Y],\</span>
<a name="l00589"></a>00589 <span class="preprocessor">   tmp2[X]=sqrx(tmp),tmp2[Y]=-sqry(tmp),\</span>
<a name="l00590"></a>00590 <span class="preprocessor">   fac[X]=-cmulx(z,tmp2),fac[Y]=-cmuly(z,tmp2),\</span>
<a name="l00591"></a>00591 <span class="preprocessor">   tmp[X]=(c)[X]+1,tmp[Y]=(c)[Y],\</span>
<a name="l00592"></a>00592 <span class="preprocessor">   (fac[X]*ilog(p1,tmp[X],tmp[Y])+\</span>
<a name="l00593"></a>00593 <span class="preprocessor">    fac[Y]*HALF*log(cmagsqr(tmp)))/cmagsqr(tmp2))</span>
<a name="l00594"></a>00594 <span class="preprocessor"></span>
<a name="l00595"></a>00595 <span class="comment">/*</span>
<a name="l00596"></a>00596 <span class="comment"> * 2(b+t)(1+b t)((b-t)^2+(b t-1)^2)/((b^2-1)^2(t^2-1)^2)</span>
<a name="l00597"></a>00597 <span class="comment"> */</span>
<a name="l00598"></a><a class="code" href="ffp_8c.html#a5dffc6e3d45cc4f3babb2d65c1cf6888">00598</a> <span class="preprocessor">#define subexpr4(sum,c) \</span>
<a name="l00599"></a>00599 <span class="preprocessor">  (tmp[X]=sqrx(z)-1,tmp[Y]=sqry(z),\</span>
<a name="l00600"></a>00600 <span class="preprocessor">   tmp2[X]=sqrx(c)-1,tmp2[Y]=sqry(c),\</span>
<a name="l00601"></a>00601 <span class="preprocessor">   fac[X]=sqrx(tmp),fac[Y]=sqry(tmp),\</span>
<a name="l00602"></a>00602 <span class="preprocessor">   tmp[X]=sqrx(tmp2),tmp[Y]=sqry(tmp2),\</span>
<a name="l00603"></a>00603 <span class="preprocessor">   denom[X]=cmulx(fac,tmp),denom[Y]=-cmuly(fac,tmp),\</span>
<a name="l00604"></a>00604 <span class="preprocessor">   quot=1/cmagsqr(denom),\</span>
<a name="l00605"></a>00605 <span class="preprocessor">   denom[X]*=quot,denom[Y]*=quot,\</span>
<a name="l00606"></a>00606 <span class="preprocessor">   tmp[X]=z[X]+(c)[X],tmp[Y]=z[Y]+(c)[Y],\</span>
<a name="l00607"></a>00607 <span class="preprocessor">   tmp2[X]=cmulx(z,c)+1,tmp2[Y]=cmuly(z,c),\</span>
<a name="l00608"></a>00608 <span class="preprocessor">   fac[X]=2*cmulx(tmp,tmp2),fac[Y]=2*cmuly(tmp,tmp2),\</span>
<a name="l00609"></a>00609 <span class="preprocessor">   tmp2[X]-=2,\</span>
<a name="l00610"></a>00610 <span class="preprocessor">   tmp[X]=sqrx(tmp2),tmp[Y]=sqry(tmp2),\</span>
<a name="l00611"></a>00611 <span class="preprocessor">   tmp2[X]=z[X]-(c)[X],tmp2[Y]=z[Y]-(c)[Y],\</span>
<a name="l00612"></a>00612 <span class="preprocessor">   tmp[X]+=sqrx(tmp2),tmp[Y]+=sqry(tmp2),\</span>
<a name="l00613"></a>00613 <span class="preprocessor">   tmp2[X]=cmulx(fac,tmp),tmp2[Y]=cmuly(fac,tmp),\</span>
<a name="l00614"></a>00614 <span class="preprocessor">   (sum)[X]+=cmulx(tmp2,denom),(sum)[Y]=cmuly(tmp2,denom))</span>
<a name="l00615"></a>00615 <span class="preprocessor"></span>
<a name="l00616"></a>00616 <span class="comment">/*</span>
<a name="l00617"></a>00617 <span class="comment"> * p2[(1-t)/(1+b)]</span>
<a name="l00618"></a>00618 <span class="comment"> */</span>
<a name="l00619"></a><a class="code" href="ffp_8c.html#a9fac91c408fe0b8acd55206df0ccb7d4">00619</a> <span class="preprocessor">#define subexpr5(sum,c) \</span>
<a name="l00620"></a>00620 <span class="preprocessor">  (tmp[X]=1-(c)[X],tmp[Y]=-(c)[Y],\</span>
<a name="l00621"></a>00621 <span class="preprocessor">   tmp2[X]=1+z[X],tmp2[Y]=-z[Y],\</span>
<a name="l00622"></a>00622 <span class="preprocessor">   quot=1/cmagsqr(tmp2),\</span>
<a name="l00623"></a>00623 <span class="preprocessor">   tmp2[0]*=quot,tmp2[1]*=quot,\</span>
<a name="l00624"></a>00624 <span class="preprocessor">   fac[X]=cmulx(tmp,tmp2),fac[Y]=cmuly(tmp,tmp2),\</span>
<a name="l00625"></a>00625 <span class="preprocessor">   (sum)[X]+=HALF*log(cmagsqr(fac)),(sum)[Y]+=ilog(p2,fac[X],fac[Y]))</span>
<a name="l00626"></a>00626 <span class="preprocessor"></span>
<a name="l00627"></a>00627 <span class="comment">/*</span>
<a name="l00628"></a>00628 <span class="comment"> * -p3[(1+t)/(1-b)]</span>
<a name="l00629"></a>00629 <span class="comment"> */</span>
<a name="l00630"></a><a class="code" href="ffp_8c.html#ac45b81366da49e0a9093ad24464cc563">00630</a> <span class="preprocessor">#define subexpr6(sum,c) \</span>
<a name="l00631"></a>00631 <span class="preprocessor">  (tmp[X]=1+(c)[X],tmp[Y]=(c)[Y],\</span>
<a name="l00632"></a>00632 <span class="preprocessor">   tmp2[X]=1-z[X],tmp2[Y]=z[Y],\</span>
<a name="l00633"></a>00633 <span class="preprocessor">   quot=1/cmagsqr(tmp2),\</span>
<a name="l00634"></a>00634 <span class="preprocessor">   tmp2[0]*=quot,tmp2[1]*=quot,\</span>
<a name="l00635"></a>00635 <span class="preprocessor">   fac[X]=cmulx(tmp,tmp2),fac[Y]=cmuly(tmp,tmp2),\</span>
<a name="l00636"></a>00636 <span class="preprocessor">   (sum)[X]-=HALF*log(cmagsqr(fac)),(sum)[Y]-=ilog(p3,fac[X],fac[Y]))</span>
<a name="l00637"></a>00637 <span class="preprocessor"></span>
<a name="l00638"></a>00638 <span class="comment">/*</span>
<a name="l00639"></a>00639 <span class="comment"> * sum*p1[b+t]</span>
<a name="l00640"></a>00640 <span class="comment"> */</span>
<a name="l00641"></a><a class="code" href="ffp_8c.html#a056c10426debf2743bbf584c0478cfdc">00641</a> <span class="preprocessor">#define subexpr7(sum,c) \</span>
<a name="l00642"></a>00642 <span class="preprocessor">  (tmp[X]=z[X]+(c)[X],tmp[Y]=z[Y]+(c)[Y],\</span>
<a name="l00643"></a>00643 <span class="preprocessor">   (sum)[X]*ilog(p1,tmp[X],tmp[Y])+HALF*(sum)[Y]*log(cmagsqr(tmp)))</span>
<a name="l00644"></a>00644 <span class="preprocessor"></span>
<a name="l00645"></a>00645 <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a>
<a name="l00646"></a><a class="code" href="ffp_8c.html#a13e0b8ab5905f4a047accb2c1921d221">00646</a> <a class="code" href="ff_8h.html#a1c61d009e1b65836d9ac081bdb2ba261">ILogPart</a>( <span class="keywordtype">int</span> p1, <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> z[2], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c[<a class="code" href="ff_8h.html#a83636a7d3d10670956ae5a0c6ff2f9f4">ALLCOEFF</a>][2] )
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> rad[2], cnt[2]; <span class="comment">/* radius, center */</span>
<a name="l00649"></a>00649   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> tmp[2], tmp2[2]; <span class="comment">/* the macros need these */</span>
<a name="l00650"></a>00650   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> fac[2]; <span class="comment">/* generic factor holding slot */</span>
<a name="l00651"></a>00651   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> denom[2]; <span class="comment">/* generic denominator holding slot */</span>
<a name="l00652"></a>00652   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> f = 0; <span class="comment">/* the final result */</span>
<a name="l00653"></a>00653   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> quot; <span class="comment">/* for quotients */</span>
<a name="l00654"></a>00654   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> sum[2];
<a name="l00655"></a>00655   <span class="keywordtype">int</span> p2, p3;
<a name="l00656"></a>00656   
<a name="l00657"></a>00657   <span class="comment">/*</span>
<a name="l00658"></a>00658 <span class="comment">   * get the right extensions of the log</span>
<a name="l00659"></a>00659 <span class="comment">   */</span>
<a name="l00660"></a>00660   cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 1 + z[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>]; cnt[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -z[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00661"></a>00661   quot = 1 / <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( cnt );
<a name="l00662"></a>00662   rad[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -( cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] *= quot ); rad[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -( cnt[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] *= quot );
<a name="l00663"></a>00663   p2 = <a class="code" href="ff_8h.html#aac86cb0d272975513dcceff485dc6e23">LogSelect</a>( rad, cnt, c[<a class="code" href="ffp_8c.html#afecb0a00a3c2aa965c6fb5b87d8a56bb">PSI</a>] );
<a name="l00664"></a>00664   f += <a class="code" href="ff_8h.html#ada7d91a116af2f5310f10d33d1d187b1">IDilogPath</a>( p2, rad, cnt, c );
<a name="l00665"></a>00665 
<a name="l00666"></a>00666   cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 1 - z[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>]; cnt[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = z[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00667"></a>00667   quot = 1 / <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( cnt );
<a name="l00668"></a>00668   rad[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = cnt[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] *= quot; rad[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = cnt[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] *= quot;
<a name="l00669"></a>00669   p3 = <a class="code" href="ff_8h.html#aac86cb0d272975513dcceff485dc6e23">LogSelect</a>( rad, cnt, c[PSI] );
<a name="l00670"></a>00670   f -= <a class="code" href="ff_8h.html#ada7d91a116af2f5310f10d33d1d187b1">IDilogPath</a>( p3, rad, cnt, c );
<a name="l00671"></a>00671 
<a name="l00672"></a>00672   <span class="comment">/*</span>
<a name="l00673"></a>00673 <span class="comment">   * 2(b-t)/((b^2-1)(t^2-1))</span>
<a name="l00674"></a>00674 <span class="comment">   */</span>
<a name="l00675"></a>00675   f += <a class="code" href="ffp_8c.html#a54f916ec53efcf798f6625285ffe1391">subexpr1</a>( c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>] );
<a name="l00676"></a>00676   
<a name="l00677"></a>00677   <span class="comment">/*</span>
<a name="l00678"></a>00678 <span class="comment">   * -p1[t-1]b/(1+b)^2</span>
<a name="l00679"></a>00679 <span class="comment">   */</span>
<a name="l00680"></a>00680   f += <a class="code" href="ffp_8c.html#abeb739af71c78e8c9127f5dfb3af8a2f">subexpr2</a>( c[UPPER] );
<a name="l00681"></a>00681 
<a name="l00682"></a>00682   <span class="comment">/*</span>
<a name="l00683"></a>00683 <span class="comment">   * -p1[1+t]b/(b-1)^2</span>
<a name="l00684"></a>00684 <span class="comment">   */</span>
<a name="l00685"></a>00685   f += <a class="code" href="ffp_8c.html#ac58f8f04c010827e2b84728a670dfde5">subexpr3</a>( c[UPPER] );
<a name="l00686"></a>00686 
<a name="l00687"></a>00687   <span class="comment">/*</span>
<a name="l00688"></a>00688 <span class="comment">   * sum += 2(b+t)(1+b t)((b-t)^2+(b t-1)^2)/((b^2-1)^2(t^2-1)^2)</span>
<a name="l00689"></a>00689 <span class="comment">   */</span>
<a name="l00690"></a>00690   sum[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = sum[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = 0;
<a name="l00691"></a>00691   <a class="code" href="ffp_8c.html#a5dffc6e3d45cc4f3babb2d65c1cf6888">subexpr4</a>( sum, c[UPPER] );
<a name="l00692"></a>00692 
<a name="l00693"></a>00693   <span class="comment">/*</span>
<a name="l00694"></a>00694 <span class="comment">   * sum += p2[(1-t)/(1+b)]</span>
<a name="l00695"></a>00695 <span class="comment">   */</span>
<a name="l00696"></a>00696   <a class="code" href="ffp_8c.html#a9fac91c408fe0b8acd55206df0ccb7d4">subexpr5</a>( sum, c[UPPER] );
<a name="l00697"></a>00697 
<a name="l00698"></a>00698   <span class="comment">/*</span>
<a name="l00699"></a>00699 <span class="comment">   * sum += -p3[(1+t)/(1-b)]</span>
<a name="l00700"></a>00700 <span class="comment">   */</span>
<a name="l00701"></a>00701   <a class="code" href="ffp_8c.html#ac45b81366da49e0a9093ad24464cc563">subexpr6</a>( sum, c[UPPER] );
<a name="l00702"></a>00702 
<a name="l00703"></a>00703   <span class="comment">/*</span>
<a name="l00704"></a>00704 <span class="comment">   * sum*p1[b+t]</span>
<a name="l00705"></a>00705 <span class="comment">   */</span>
<a name="l00706"></a>00706   f += <a class="code" href="ffp_8c.html#a056c10426debf2743bbf584c0478cfdc">subexpr7</a>( sum, c[UPPER] );
<a name="l00707"></a>00707 
<a name="l00708"></a>00708   f -= <a class="code" href="ffp_8c.html#a54f916ec53efcf798f6625285ffe1391">subexpr1</a>( c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>] );
<a name="l00709"></a>00709   f -= <a class="code" href="ffp_8c.html#abeb739af71c78e8c9127f5dfb3af8a2f">subexpr2</a>( c[LOWER] );
<a name="l00710"></a>00710   f -= <a class="code" href="ffp_8c.html#ac58f8f04c010827e2b84728a670dfde5">subexpr3</a>( c[LOWER] );
<a name="l00711"></a>00711   sum[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = sum[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = 0;
<a name="l00712"></a>00712   <a class="code" href="ffp_8c.html#a5dffc6e3d45cc4f3babb2d65c1cf6888">subexpr4</a>( sum, c[LOWER] );
<a name="l00713"></a>00713   <a class="code" href="ffp_8c.html#a9fac91c408fe0b8acd55206df0ccb7d4">subexpr5</a>( sum, c[LOWER] );
<a name="l00714"></a>00714   <a class="code" href="ffp_8c.html#ac45b81366da49e0a9093ad24464cc563">subexpr6</a>( sum, c[LOWER] );
<a name="l00715"></a>00715   f -= <a class="code" href="ffp_8c.html#a056c10426debf2743bbf584c0478cfdc">subexpr7</a>( sum, c[LOWER] );
<a name="l00716"></a>00716 
<a name="l00717"></a>00717   <span class="keywordflow">return</span> <a class="code" href="ffp_8c.html#a8cbf59b7a08a3c4de29e0f7f996e2987">ONESIXTEENTH</a> * f;
<a name="l00718"></a>00718 }
<a name="l00719"></a>00719 
<a name="l00720"></a>00720 <span class="comment">/*</span>
<a name="l00721"></a>00721 <span class="comment"> * the part of the overall integral due to the value of k</span>
<a name="l00722"></a>00722 <span class="comment"> */</span>
<a name="l00723"></a><a class="code" href="ffp_8c.html#ab3fb4dbffec8c313b98d7d1193aa87ed">00723</a> <span class="preprocessor">#define kpart(k,c)      \</span>
<a name="l00724"></a>00724 <span class="preprocessor">  ((2*(k)+1)*M_PIF*(RM((c)[UPPER])-RM((c)[LOWER])))</span>
<a name="l00725"></a>00725 <span class="preprocessor"></span>
<a name="l00726"></a>00726 <span class="comment">/*</span>
<a name="l00727"></a>00727 <span class="comment"> * the nasty integral</span>
<a name="l00728"></a>00728 <span class="comment"> */</span>
<a name="l00729"></a>00729 <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a>
<a name="l00730"></a><a class="code" href="ffp_8c.html#a17fbcad29e573d285044b03602100708">00730</a> <a class="code" href="ff_8h.html#a4e8a65fd313b5fe4eb2439771878302f">ILogIntegral</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c[<a class="code" href="ff_8h.html#a83636a7d3d10670956ae5a0c6ff2f9f4">ALLCOEFF</a>][2], <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> s )
<a name="l00731"></a>00731 {
<a name="l00732"></a>00732   <span class="keyword">static</span> <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> unit[2] = { 1, 0 };
<a name="l00733"></a>00733   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> mc17[2]; <span class="comment">/* -c[17] */</span>
<a name="l00734"></a>00734   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> mc18[2]; <span class="comment">/* -c[18] */</span>
<a name="l00735"></a>00735   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> logu, logl;
<a name="l00736"></a>00736   <span class="comment">/*</span>
<a name="l00737"></a>00737 <span class="comment">   * to find k we are lazy. Evaluate the original</span>
<a name="l00738"></a>00738 <span class="comment">   * form of the inverse tangent at the beginning</span>
<a name="l00739"></a>00739 <span class="comment">   * and end of the path</span>
<a name="l00740"></a>00740 <span class="comment">   */</span>
<a name="l00741"></a>00741   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> tanu = -<a class="code" href="ffp_8c.html#af0d3e6a8f32593bce622be14a9f35db3">ATAN2</a>( 2 * s + c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * c[2][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] + c[3][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>],
<a name="l00742"></a>00742                      sqrt( ( c[10][X] * c[2][X] + c[11][X] ) *
<a name="l00743"></a>00743                           c[2][X] + c[12][X] ) );
<a name="l00744"></a>00744   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> tanl = -<a class="code" href="ffp_8c.html#af0d3e6a8f32593bce622be14a9f35db3">ATAN2</a>( 2 * s + c[3][X], sqrt( c[12][X] ) );
<a name="l00745"></a>00745   <span class="keywordtype">int</span> p1, p2, p3, p4, ku, kl, k;
<a name="l00746"></a>00746   
<a name="l00747"></a>00747   <span class="comment">/*</span>
<a name="l00748"></a>00748 <span class="comment">   * after decomposing the inverse tangent into 4 logarithms</span>
<a name="l00749"></a>00749 <span class="comment">   * first find out which of the extensions we need to use</span>
<a name="l00750"></a>00750 <span class="comment">   */</span>
<a name="l00751"></a>00751   mc17[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -c[17][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>]; mc17[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -c[17][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00752"></a>00752   p1 = <a class="code" href="ff_8h.html#aac86cb0d272975513dcceff485dc6e23">LogSelect</a>( unit, mc17, c[<a class="code" href="ffp_8c.html#afecb0a00a3c2aa965c6fb5b87d8a56bb">PSI</a>] );
<a name="l00753"></a>00753   mc18[<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -c[18][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>]; mc18[<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -c[18][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00754"></a>00754   p2 = <a class="code" href="ff_8h.html#aac86cb0d272975513dcceff485dc6e23">LogSelect</a>( unit, mc18, c[PSI] );
<a name="l00755"></a>00755   p3 = <a class="code" href="ff_8h.html#aac86cb0d272975513dcceff485dc6e23">LogSelect</a>( unit, c[17], c[PSI] );
<a name="l00756"></a>00756   p4 = <a class="code" href="ff_8h.html#aac86cb0d272975513dcceff485dc6e23">LogSelect</a>( unit, c[18], c[PSI] );
<a name="l00757"></a>00757   
<a name="l00758"></a>00758   <span class="comment">/*</span>
<a name="l00759"></a>00759 <span class="comment">   * now evaluate this alternative form at the two endpoints</span>
<a name="l00760"></a>00760 <span class="comment">   */</span>
<a name="l00761"></a>00761   logu =
<a name="l00762"></a>00762     <a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> * ( <a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">M_PIF</a> +
<a name="l00763"></a>00763            <a class="code" href="ffp_8c.html#aeb98e00b7f80d78aa4b299a6e2a3f4ae">ilog</a>( p1, c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][X] - c[17][X], c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] - c[17][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] ) +
<a name="l00764"></a>00764            <a class="code" href="ffp_8c.html#aeb98e00b7f80d78aa4b299a6e2a3f4ae">ilog</a>( p2, c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][X] - c[18][X], c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][Y] - c[18][Y] ) -
<a name="l00765"></a>00765            <a class="code" href="ffp_8c.html#aeb98e00b7f80d78aa4b299a6e2a3f4ae">ilog</a>( p3, c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][X] + c[17][X], c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][Y] + c[17][Y] ) -
<a name="l00766"></a>00766            <a class="code" href="ffp_8c.html#aeb98e00b7f80d78aa4b299a6e2a3f4ae">ilog</a>( p4, c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][X] + c[18][X], c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][Y] + c[18][Y] ) );
<a name="l00767"></a>00767   logl =
<a name="l00768"></a>00768     <a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> * ( <a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">M_PIF</a> +
<a name="l00769"></a>00769            <a class="code" href="ffp_8c.html#aeb98e00b7f80d78aa4b299a6e2a3f4ae">ilog</a>( p1, c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][X] - c[17][X], c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][Y] - c[17][Y] ) +
<a name="l00770"></a>00770            <a class="code" href="ffp_8c.html#aeb98e00b7f80d78aa4b299a6e2a3f4ae">ilog</a>( p2, c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][X] - c[18][X], c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][Y] - c[18][Y] ) -
<a name="l00771"></a>00771            <a class="code" href="ffp_8c.html#aeb98e00b7f80d78aa4b299a6e2a3f4ae">ilog</a>( p3, c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][X] + c[17][X], c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][Y] + c[17][Y] ) -
<a name="l00772"></a>00772            <a class="code" href="ffp_8c.html#aeb98e00b7f80d78aa4b299a6e2a3f4ae">ilog</a>( p4, c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][X] + c[18][X], c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][Y] + c[18][Y] ) );
<a name="l00773"></a>00773 
<a name="l00774"></a>00774   <span class="comment">/*</span>
<a name="l00775"></a>00775 <span class="comment">   * and compare to find k. This whole shebang should be</span>
<a name="l00776"></a>00776 <span class="comment">   * done more intelligently by figuring out exactly what</span>
<a name="l00777"></a>00777 <span class="comment">   * happens to the integration path and chosing k directly.</span>
<a name="l00778"></a>00778 <span class="comment">   */</span>
<a name="l00779"></a>00779   ku = floor( ( tanu - logu ) / <a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">M_PIF</a> + <a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> );
<a name="l00780"></a>00780   kl = floor( ( tanl - logl ) / <a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">M_PIF</a> + <a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> );
<a name="l00781"></a>00781 
<a name="l00782"></a>00782   <span class="comment">/*</span>
<a name="l00783"></a>00783 <span class="comment">   * needless to say this error check should not be necessary...</span>
<a name="l00784"></a>00784 <span class="comment">   */</span>
<a name="l00785"></a>00785     assert( ku == kl );
<a name="l00786"></a>00786     <span class="comment">/*assert( ku == -1 || ku == 0 || ku == 1 );*/</span>
<a name="l00787"></a>00787     assert (ku &lt;= 2 &amp;&amp; ku &gt;= -2);
<a name="l00788"></a>00788     <span class="keywordflow">if</span> (ku == -2 || ku == 2)
<a name="l00789"></a>00789       ku = 0;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791   k = ku;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793   <span class="keywordflow">return</span> <a class="code" href="ffp_8c.html#ab3fb4dbffec8c313b98d7d1193aa87ed">kpart</a>( k, c ) +
<a name="l00794"></a>00794     <a class="code" href="ff_8h.html#a1c61d009e1b65836d9ac081bdb2ba261">ILogPart</a>( p1, mc17, c ) + <a class="code" href="ff_8h.html#a1c61d009e1b65836d9ac081bdb2ba261">ILogPart</a>( p2, mc18, c ) -
<a name="l00795"></a>00795       <a class="code" href="ff_8h.html#a1c61d009e1b65836d9ac081bdb2ba261">ILogPart</a>( p3, c[17], c ) - <a class="code" href="ff_8h.html#a1c61d009e1b65836d9ac081bdb2ba261">ILogPart</a>( p4, c[18], c );
<a name="l00796"></a>00796 }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 <span class="comment">/*</span>
<a name="l00799"></a>00799 <span class="comment"> * everything but the tricky integral</span>
<a name="l00800"></a>00800 <span class="comment"> */</span>
<a name="l00801"></a><a class="code" href="ffp_8c.html#aa4f6e83059455d7dd06d3f34d9446389">00801</a> <span class="preprocessor">#define firstpart(c,s,t)        \</span>
<a name="l00802"></a>00802 <span class="preprocessor">  (((s)+(c)[3][X]*HALF)*\</span>
<a name="l00803"></a>00803 <span class="preprocessor">   G(1,(c)[4][X]+(c)[1][X]*(s),((s)+(c)[3][X])*(s)+(c)[5][X],t)+\</span>
<a name="l00804"></a>00804 <span class="preprocessor">   (c)[1][X]*HALF*\</span>
<a name="l00805"></a>00805 <span class="preprocessor">   H(1,(c)[4][X]+(c)[1][X]*(s),((s)+(c)[3][X])*(s)+(c)[5][X],t))</span>
<a name="l00806"></a>00806 <span class="preprocessor"></span>
<a name="l00807"></a>00807 <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a>
<a name="l00808"></a><a class="code" href="ffp_8c.html#a15037bb24a5e848d5e35ccc739b7c466">00808</a> <a class="code" href="ff_8h.html#a48eb86a5dbd8b9eedb7f240b6b88e9b5">Integral</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c[<a class="code" href="ff_8h.html#a83636a7d3d10670956ae5a0c6ff2f9f4">ALLCOEFF</a>][2] )
<a name="l00809"></a>00809 {
<a name="l00810"></a>00810   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> f;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812   <span class="keywordflow">if</span>( <a class="code" href="ff_8h.html#ad4e1d7a295e34cafaae901f9676bcfbd">Bilinear</a>( c ) ){
<a name="l00813"></a>00813     f = <a class="code" href="ff_8h.html#ac26d45524b1c5dc5a209f8d80580c6aa">IntegralPlanar</a>( c );
<a name="l00814"></a>00814   }<span class="keywordflow">else</span>{
<a name="l00815"></a>00815     <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> tmp, c16magsqr;
<a name="l00816"></a>00816     
<a name="l00817"></a>00817     f = <a class="code" href="ffp_8c.html#aa4f6e83059455d7dd06d3f34d9446389">firstpart</a>( c, c[0][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>], c[2][X] ) - <a class="code" href="ffp_8c.html#aa4f6e83059455d7dd06d3f34d9446389">firstpart</a>( c, 0, c[2][X] ) -
<a name="l00818"></a>00818       <a class="code" href="ffp_8c.html#aa4f6e83059455d7dd06d3f34d9446389">firstpart</a>( c, c[0][X], 0 ) + <a class="code" href="ffp_8c.html#aa4f6e83059455d7dd06d3f34d9446389">firstpart</a>( c, 0, 0 ) -
<a name="l00819"></a>00819         2 * c[0][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * c[2][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00820"></a>00820 
<a name="l00821"></a>00821     <span class="comment">/*</span>
<a name="l00822"></a>00822 <span class="comment">     * all the same for t = lower/upper</span>
<a name="l00823"></a>00823 <span class="comment">     */</span>
<a name="l00824"></a>00824     c[10][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 4 - c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00825"></a>00825     c[11][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 4 * c[4][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] - 2 * c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * c[3][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00826"></a>00826     c[12][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = 4 * c[5][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] - c[3][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * c[3][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00827"></a>00827     c[13][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = c[11][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] / ( 2 * c[10][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] );
<a name="l00828"></a>00828     c[13][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -sqrt( 4 * c[10][X] * c[12][X] - c[11][X] * c[11][X] ) /
<a name="l00829"></a>00829       ( 2 * c[10][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] );
<a name="l00830"></a>00830     tmp = 1 / <a class="code" href="ffp_8c.html#a8bbb93bf48b7cba3bdcc7decbe9ac17c">hypot</a>( c[13][X], c[13][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] );
<a name="l00831"></a>00831     c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = c[13][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * tmp;
<a name="l00832"></a>00832     c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = c[13][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * tmp;
<a name="l00833"></a>00833     <span class="keywordflow">if</span>( c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][Y] &lt; 0 ){
<a name="l00834"></a>00834       c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>]; c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00835"></a>00835     }
<a name="l00836"></a>00836     c[<a class="code" href="ffp_8c.html#afecb0a00a3c2aa965c6fb5b87d8a56bb">PSI</a>][<a class="code" href="ffp_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>] = <a class="code" href="ffp_8c.html#af0d3e6a8f32593bce622be14a9f35db3">ATAN2</a>( c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][Y], c[<a class="code" href="ffp_8c.html#aaa9295df3f8f6033cae4b89cc7e5ff29">LOWER</a>][X] );
<a name="l00837"></a>00837     tmp = 1 / <a class="code" href="ffp_8c.html#a8bbb93bf48b7cba3bdcc7decbe9ac17c">hypot</a>( c[13][X] + c[2][X], c[13][Y] );
<a name="l00838"></a>00838     c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = ( c[13][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] + c[2][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] ) * tmp;
<a name="l00839"></a>00839     c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = c[13][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * tmp;
<a name="l00840"></a>00840     <span class="keywordflow">if</span>( c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][Y] &lt; 0 ){
<a name="l00841"></a>00841       c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>]; c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843     c[<a class="code" href="ffp_8c.html#afecb0a00a3c2aa965c6fb5b87d8a56bb">PSI</a>][<a class="code" href="ffp_8c.html#affc9cbf86b78292bdb405361761c47f5">U</a>] = <a class="code" href="ffp_8c.html#af0d3e6a8f32593bce622be14a9f35db3">ATAN2</a>( c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][Y], c[<a class="code" href="ffp_8c.html#ab7a309e1cb06fb6bcbd4314371443416">UPPER</a>][X] );
<a name="l00844"></a>00844     c[14][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = c[13][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * -2;
<a name="l00845"></a>00845     c[15][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = sqrt( c[10][X] ) * c[14][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00846"></a>00846 
<a name="l00847"></a>00847     <span class="comment">/*</span>
<a name="l00848"></a>00848 <span class="comment">     * s = c[0]</span>
<a name="l00849"></a>00849 <span class="comment">     */</span>
<a name="l00850"></a>00850     c[16][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * c[13][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] - c[3][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] - 2 * c[0][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00851"></a>00851     c[16][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * c[13][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00852"></a>00852     tmp = 1 / ( c16magsqr = <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( c[16] ) );
<a name="l00853"></a>00853     <span class="keywordflow">if</span>( c16magsqr &gt; <a class="code" href="claussen_8h.html#a256dd8a6ef88598b713f7e744465bb8d">mach</a>[0] ){
<a name="l00854"></a>00854       c[17][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = c[18][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -<a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> * c[15][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * c[16][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * tmp;
<a name="l00855"></a>00855       c[17][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = c[18][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -<a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> * c[15][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * c[16][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * tmp;
<a name="l00856"></a>00856       tmp *= <a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> * sqrt( c[15][Y] * c[15][Y] + 4 * c16magsqr );
<a name="l00857"></a>00857       c[17][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] += tmp * c[16][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00858"></a>00858       c[17][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] += tmp * c[16][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00859"></a>00859       c[18][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] -= tmp * c[16][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00860"></a>00860       c[18][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] -= tmp * c[16][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00861"></a>00861       
<a name="l00862"></a>00862       f -= c[14][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * c[15][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * <a class="code" href="ff_8h.html#a4e8a65fd313b5fe4eb2439771878302f">ILogIntegral</a>( c, c[0][X] );
<a name="l00863"></a>00863     }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865     <span class="comment">/*</span>
<a name="l00866"></a>00866 <span class="comment">     * s = 0</span>
<a name="l00867"></a>00867 <span class="comment">     */</span>
<a name="l00868"></a>00868     c[16][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * c[13][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] - c[3][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00869"></a>00869     c[16][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * c[13][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00870"></a>00870     tmp = 1 / ( c16magsqr = <a class="code" href="ffp_8c.html#a777c7ed7e4699b08b9b42164ffacdea7">cmagsqr</a>( c[16] ) );
<a name="l00871"></a>00871     <span class="keywordflow">if</span>( c16magsqr &gt; <a class="code" href="claussen_8h.html#a256dd8a6ef88598b713f7e744465bb8d">mach</a>[0] ){
<a name="l00872"></a>00872       c[17][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = c[18][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] = -<a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> * c[15][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * c[16][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * tmp;
<a name="l00873"></a>00873       c[17][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = c[18][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] = -<a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> * c[15][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * c[16][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * tmp;
<a name="l00874"></a>00874       tmp *= <a class="code" href="ffp_8c.html#a37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a> * sqrt( c[15][Y] * c[15][Y] + 4 * c16magsqr );
<a name="l00875"></a>00875       c[17][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] += tmp * c[16][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00876"></a>00876       c[17][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] += tmp * c[16][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00877"></a>00877       c[18][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] -= tmp * c[16][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>];
<a name="l00878"></a>00878       c[18][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] -= tmp * c[16][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>];
<a name="l00879"></a>00879       
<a name="l00880"></a>00880       f += c[14][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * c[15][<a class="code" href="ffp_8c.html#a798e4073d613ca5ba9618e1b3253df14">Y</a>] * <a class="code" href="ff_8h.html#a4e8a65fd313b5fe4eb2439771878302f">ILogIntegral</a>( c, 0 );
<a name="l00881"></a>00881     }
<a name="l00882"></a>00882   }
<a name="l00883"></a>00883 
<a name="l00884"></a>00884   <span class="keywordflow">return</span> f;
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 <span class="keywordtype">void</span>
<a name="l00888"></a><a class="code" href="ffp_8c.html#aa64f5c5a5b18c86a86300a187a315c58">00888</a> <a class="code" href="ff_8h.html#aa64f5c5a5b18c86a86300a187a315c58">FormFactor</a>( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> ( *p )[3], <span class="keywordtype">int</span> np, <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> ( *q )[3], <span class="keywordtype">int</span> nq , 
<a name="l00889"></a>00889             <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> *factor12, <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> *factor21)
<a name="l00890"></a>00890 {
<a name="l00891"></a>00891   <span class="keywordtype">int</span> i, j, ii, jj;
<a name="l00892"></a>00892   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> ff = 0;
<a name="l00893"></a>00893   <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> c[<a class="code" href="ff_8h.html#a83636a7d3d10670956ae5a0c6ff2f9f4">ALLCOEFF</a>][2];
<a name="l00894"></a>00894 
<a name="l00895"></a>00895   <span class="keywordflow">for</span>( i = 0, ii = 1; i &lt; np; i++, ii = ( i + 1 ) % np ){
<a name="l00896"></a>00896     <span class="keywordflow">for</span>( j = 0, jj = 1; j &lt; nq; j++, jj = ( j + 1 ) % nq ){
<a name="l00897"></a>00897       <a class="code" href="ff_8h.html#a16a448b0a249efcc309e99fbf310f045">Pair</a>( c, p[i], p[ii], q[j], q[jj] );
<a name="l00898"></a>00898       <span class="keywordflow">if</span>( fabs( c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] ) &gt; <a class="code" href="claussen_8h.html#a256dd8a6ef88598b713f7e744465bb8d">mach</a>[2] ){
<a name="l00899"></a>00899         ff -= c[1][<a class="code" href="ffp_8c.html#a207fd5507206d307cd63f95374fcd00d">X</a>] * <a class="code" href="ff_8h.html#a48eb86a5dbd8b9eedb7f240b6b88e9b5">Integral</a>( c );
<a name="l00900"></a>00900       }
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902   }
<a name="l00903"></a>00903 
<a name="l00904"></a>00904   <span class="comment">/*  return ff / ( ( ( real )( M_PIF * 8 ) ) * Area( p, np ) );*/</span>
<a name="l00905"></a>00905   
<a name="l00906"></a>00906   *factor12 = ff / ( ( ( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> )( <a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">M_PIF</a> * 8 ) ) * <a class="code" href="ff_8h.html#a94d6695dd6b269114148ad734a217708">Area</a>( p, np ) );
<a name="l00907"></a>00907   *factor21 = ff / ( ( ( <a class="code" href="ffp_8c.html#a5f5a64ef503db0fc824df8320929b126">real</a> )( <a class="code" href="ffp_8c.html#a7ff374d4809b623599a72f902957798a">M_PIF</a> * 8 ) ) * <a class="code" href="ff_8h.html#a94d6695dd6b269114148ad734a217708">Area</a>( q, nq ) );
<a name="l00908"></a>00908 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 12 2012 18:06:18 for fesystem by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
