<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>fesystem: /Users/manav/Documents/codes/FESystemOld/FESystem/src/Radiation/RadiationCavityAnalysis.C Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">fesystem
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9e51036813d6151dfecc72d5fa7c02b3.html">Users</a>      </li>
      <li class="navelem"><a class="el" href="dir_0c900164955ce081ffb4c6b051e456bf.html">manav</a>      </li>
      <li class="navelem"><a class="el" href="dir_1c27e0e86d47954644c3da6ab29e89d2.html">Documents</a>      </li>
      <li class="navelem"><a class="el" href="dir_702da5bd4e2e61517788da49174c071d.html">codes</a>      </li>
      <li class="navelem"><a class="el" href="dir_549ad45c2f63d8c1db46ab790c4cde83.html">FESystemOld</a>      </li>
      <li class="navelem"><a class="el" href="dir_fa1b40415469e23c583052e363adf212.html">FESystem</a>      </li>
      <li class="navelem"><a class="el" href="dir_f94e632e97ff28080483f5ca56254f08.html">src</a>      </li>
      <li class="navelem"><a class="el" href="dir_b98b4ad87f29291f65739bf96e8f09a1.html">Radiation</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">RadiationCavityAnalysis.C</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_radiation_cavity_analysis_8_c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: RadiationCavityAnalysis.C,v 1.25.4.9 2008-08-21 00:36:15 manav Exp $</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="comment">//C++ includes</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="comment">// FESystem includes</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="_f_e_system_controller_8h.html">FESystem/FESystemController.h</a>&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="_radiation_cavity_analysis_8h.html">Radiation/RadiationCavityAnalysis.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="_radiation_element_pair_8h.html">Radiation/RadiationElementPair.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="_radiation_cavity_8h.html">Radiation/RadiationCavity.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="_thermal_analysis_8h.html">Discipline/ThermalAnalysis.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="_solution_base_8h.html">Solutions/SolutionBase.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="_transient_analysis_driver_8h.html">AnalysisDriver/TransientAnalysisDriver.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="_mesh_list_8h.html">Mesh/MeshList.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="_analysis_case_8h.html">FESystem/AnalysisCase.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="_design_database_8h.html">DesignData/DesignDatabase.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="_property_parameter_8h.html">DesignData/PropertyParameter.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="_shape_parameter_8h.html">DesignData/ShapeParameter.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="_property_database_8h.html">Properties/PropertyDatabase.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="_elem_data_card_8h.html">Properties/ElemDataCard.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="_time_logs_8h.html">Utilities/TimeLogs.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="_petsc_seq_dense_matrix_8h.html">Numerics/PetscSeqDenseMatrix.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="_petsc_seq_vector_8h.html">Numerics/PetscSeqVector.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="_global_data_storage_8h.html">Database/GlobalDataStorage.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="_data_info_8h.html">Database/DataInfo.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="_isotropic_material_property_card_8h.html">Properties/IsotropicMaterialPropertyCard.h</a>&quot;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">// libmesh includes</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;mesh/mesh.h&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;geom/face_quad4.h&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;geom/elem.h&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;quadrature/quadrature_gauss.h&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;fe/fe.h&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="comment">// petsc includes</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;petscksp.h&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;petscmat.h&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;petscvec.h&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="class_radiation_cavity_analysis.html#a0ddae630a11c7aabb1e893846ed2c14c">00045</a> <a class="code" href="class_radiation_cavity_analysis.html#a0ddae630a11c7aabb1e893846ed2c14c" title="constructor">RadiationCavityAnalysis::RadiationCavityAnalysis</a>(<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html">FESystem::FESystemController</a>&amp; fesys_controller,
<a name="l00046"></a>00046                                                  <a class="code" href="class_discipline_1_1_thermal_analysis.html">Discipline::ThermalAnalysis</a>&amp; thermal_anal,
<a name="l00047"></a>00047                                                  <a class="code" href="class_radiation_cavity.html">RadiationCavity</a>&amp; rad_cavity):
<a name="l00048"></a>00048 fesystem_controller(fesys_controller),
<a name="l00049"></a>00049 thermal_discipline(thermal_anal),
<a name="l00050"></a>00050 radiation_cavity(rad_cavity),
<a name="l00051"></a>00051 n_ABinv_calculations(0),
<a name="l00052"></a>00052 fe_nodal_temp_vector(NULL),
<a name="l00053"></a>00053 performance_logging_header(<span class="stringliteral">&quot;RadiationCavityAnalysis&quot;</span>)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a4201bf5919eac5fb0fcc87ba36368d6c" title="Performance logging.">performance_logging</a>-&gt;setEvent
<a name="l00056"></a>00056   (<span class="stringliteral">&quot;RadiationCavityAnalysis::RadiationCavityAnalysis()&quot;</span>,
<a name="l00057"></a>00057    this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#aa6dcacf6d9a9f8f15e150f7bb86c88c2" title="performance logging header">performance_logging_header</a>);
<a name="l00058"></a>00058   
<a name="l00059"></a>00059   <span class="comment">// set the mesh data for the radiation cavity and tell it to initialize its data </span>
<a name="l00060"></a>00060   <span class="comment">// structures</span>
<a name="l00061"></a>00061   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mesh_ID = this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1f138bfc5a3a6de6219d5893bfb79ec0" title="cavity for this analysis">radiation_cavity</a>.<a class="code" href="class_radiation_cavity.html#ad45cf72eecc60e080c8b9b98dbfd1955">getFiniteElementMeshID</a>();
<a name="l00062"></a>00062   
<a name="l00063"></a>00063   <a class="code" href="class_mesh_d_s_1_1_f_e_mesh_data.html">MeshDS::FEMeshData</a>* mesh_data = 
<a name="l00064"></a>00064   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a2d2bb90b45aa11cc32c79c27d2b9f6ab" title="data structure to store the mesh used for FE analysis">mesh_list</a>-&gt;getMeshDataFromID(mesh_ID);
<a name="l00065"></a>00065   
<a name="l00066"></a>00066   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1f138bfc5a3a6de6219d5893bfb79ec0" title="cavity for this analysis">radiation_cavity</a>.<a class="code" href="class_radiation_cavity.html#ac11874b9a7a8544a8ad3d2154f3eea33">setMeshData</a>(mesh_data);
<a name="l00067"></a>00067   
<a name="l00068"></a>00068   <span class="comment">// now, iterate over all the dsign variables, and set the mesh data for each</span>
<a name="l00069"></a>00069   std::auto_ptr&lt;std::vector&lt;DesignData::DesignParameter*&gt; &gt; dv_vector =
<a name="l00070"></a>00070   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a3531570abaab0e6a4c4b04c05d0ffbf8" title="stores design data">design_database</a>-&gt;getParameters();
<a name="l00071"></a>00071   
<a name="l00072"></a>00072   std::vector&lt;DesignData::DesignParameter*&gt;::const_iterator dv_it, dv_end;
<a name="l00073"></a>00073   dv_it = dv_vector-&gt;begin();
<a name="l00074"></a>00074   dv_end = dv_vector-&gt;end();
<a name="l00075"></a>00075   
<a name="l00076"></a>00076   
<a name="l00077"></a>00077   <span class="keywordflow">for</span> (; dv_it != dv_end; dv_it++)
<a name="l00078"></a>00078     {
<a name="l00079"></a>00079       <span class="keywordflow">if</span> ((*dv_it)-&gt;getParameterTypeEnumID() == DesignData::SHAPE_PARAMETER::num())
<a name="l00080"></a>00080         {
<a name="l00081"></a>00081           <a class="code" href="class_design_data_1_1_shape_parameter.html">DesignData::ShapeParameter</a>* shape_dv = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_design_data_1_1_shape_parameter.html">DesignData::ShapeParameter</a>*<span class="keyword">&gt;</span>(*dv_it);
<a name="l00082"></a>00082           mesh_ID = shape_dv-&gt;<a class="code" href="class_design_data_1_1_shape_parameter.html#a473b21f5c0bd1de4d19a13cc534cf32c">getPerturbedMeshID</a>(Discipline::THERMAL_DISCIPLINE::num());
<a name="l00083"></a>00083           mesh_data = 
<a name="l00084"></a>00084           this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a2d2bb90b45aa11cc32c79c27d2b9f6ab" title="data structure to store the mesh used for FE analysis">mesh_list</a>-&gt;getMeshDataFromID(mesh_ID);
<a name="l00085"></a>00085           
<a name="l00086"></a>00086           this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1f138bfc5a3a6de6219d5893bfb79ec0" title="cavity for this analysis">radiation_cavity</a>.<a class="code" href="class_radiation_cavity.html#ac11874b9a7a8544a8ad3d2154f3eea33">setMeshData</a>(mesh_data, shape_dv-&gt;<a class="code" href="class_design_data_1_1_design_parameter.html#ab0cb6d6c10206acebbc06d2be204c2e7">getID</a>());
<a name="l00087"></a>00087         }
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089   
<a name="l00090"></a>00090   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a4201bf5919eac5fb0fcc87ba36368d6c" title="Performance logging.">performance_logging</a>-&gt;unsetEvent
<a name="l00091"></a>00091   (<span class="stringliteral">&quot;RadiationCavityAnalysis::RadiationCavityAnalysis()&quot;</span>,
<a name="l00092"></a>00092    this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#aa6dcacf6d9a9f8f15e150f7bb86c88c2" title="performance logging header">performance_logging_header</a>);  
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="class_radiation_cavity_analysis.html#a6d237076ba441b7182a6ba3390a648dd">00101</a> <a class="code" href="class_radiation_cavity_analysis.html#a6d237076ba441b7182a6ba3390a648dd" title="destructor">RadiationCavityAnalysis::~RadiationCavityAnalysis</a>()
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103   
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="keywordtype">void</span>
<a name="l00111"></a><a class="code" href="class_radiation_cavity_analysis.html#a9f4b19a51682c6e3aceaa1c7f507b389">00111</a> <a class="code" href="class_radiation_cavity_analysis.html#a9f4b19a51682c6e3aceaa1c7f507b389">RadiationCavityAnalysis::getMatrixQuantity</a>(<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; matrix,
<a name="l00112"></a>00112                                            <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9" title="enum for the matrix names for this analysis">RadiationQty</a> qty_name) 
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114   <span class="comment">// check if the matrix exists. If not, then calculate it, store it and </span>
<a name="l00115"></a>00115   <span class="comment">// return it.</span>
<a name="l00116"></a>00116   
<a name="l00117"></a>00117   <span class="comment">// create a data info object based on the kind of analysis </span>
<a name="l00118"></a>00118   std::auto_ptr&lt;FESystemDatabase::DataInfoBase&gt; data_info(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a15c6ef55ace32a38f7b37339187abc95">getDataInfoForQty</a>(qty_name).release());  
<a name="l00119"></a>00119   
<a name="l00120"></a>00120   <span class="comment">// this bool will check if this quantity needs to be recalculated and resaved</span>
<a name="l00121"></a>00121   <span class="keywordtype">bool</span> recalculate_and_store = <span class="keyword">false</span>;
<a name="l00122"></a>00122   <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a6dc9ef38729f861b96bf31634e24b5d0" title="checks if the analysis is dependent on temperature">checkPropertyDependenceOnTemperature</a>() &amp;&amp; 
<a name="l00123"></a>00123       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a6f756b8d67e57b6d605c102fb3209e97">checkIfTemperatureDependent</a>(qty_name))
<a name="l00124"></a>00124     recalculate_and_store = <span class="keyword">true</span>;
<a name="l00125"></a>00125   
<a name="l00126"></a>00126   
<a name="l00127"></a>00127   <span class="keywordtype">bool</span> qty_exists = 
<a name="l00128"></a>00128   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a61c6211b1a2e6518ac9e357e385fad2b" title="stores global matrices and vectors">global_data_storage</a>-&gt;checkIfQtyExists(*data_info);
<a name="l00129"></a>00129   
<a name="l00130"></a>00130   
<a name="l00131"></a>00131   <span class="comment">// if the quantity is not present or if the qty is dependent on temperature</span>
<a name="l00132"></a>00132   <span class="comment">// and </span>
<a name="l00133"></a>00133   <span class="keywordflow">if</span> ( !qty_exists || recalculate_and_store)
<a name="l00134"></a>00134     {
<a name="l00135"></a>00135       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a72530913e06cbae197063f3e3f8fa2ca">calculateQty</a>(&amp;matrix, qty_name);
<a name="l00136"></a>00136       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a61c6211b1a2e6518ac9e357e385fad2b" title="stores global matrices and vectors">global_data_storage</a>-&gt;storeMatrix(*data_info, matrix);
<a name="l00137"></a>00137       
<a name="l00138"></a>00138       <span class="comment">//**************** this is only temporary *********************</span>
<a name="l00139"></a>00139       <span class="comment">/*      if (qty_name == RadiationCavityAnalysis::F_MATRIX)</span>
<a name="l00140"></a>00140 <span class="comment">       {</span>
<a name="l00141"></a>00141 <span class="comment">       FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;&amp; matrix = *(insert_return_pair.first-&gt;second);</span>
<a name="l00142"></a>00142 <span class="comment">       </span>
<a name="l00143"></a>00143 <span class="comment">       Mat petsc_matrix;</span>
<a name="l00144"></a>00144 <span class="comment">       MatCreateSeqAIJ(PETSC_COMM_SELF,</span>
<a name="l00145"></a>00145 <span class="comment">       matrix.m(),</span>
<a name="l00146"></a>00146 <span class="comment">       matrix.n(),</span>
<a name="l00147"></a>00147 <span class="comment">       0,</span>
<a name="l00148"></a>00148 <span class="comment">       PETSC_NULL,</span>
<a name="l00149"></a>00149 <span class="comment">       &amp;petsc_matrix);</span>
<a name="l00150"></a>00150 <span class="comment">       </span>
<a name="l00151"></a>00151 <span class="comment">       for (unsigned int i=0; i &lt; matrix.m(); i++)</span>
<a name="l00152"></a>00152 <span class="comment">       for (unsigned int j=0; j &lt; matrix.n(); j++)</span>
<a name="l00153"></a>00153 <span class="comment">       MatSetValue(petsc_matrix, i,j, matrix(i,j), INSERT_VALUES);</span>
<a name="l00154"></a>00154 <span class="comment">       </span>
<a name="l00155"></a>00155 <span class="comment">       MatAssemblyBegin(petsc_matrix, MAT_FINAL_ASSEMBLY);</span>
<a name="l00156"></a>00156 <span class="comment">       MatAssemblyEnd(petsc_matrix, MAT_FINAL_ASSEMBLY);</span>
<a name="l00157"></a>00157 <span class="comment">       </span>
<a name="l00158"></a>00158 <span class="comment">       PetscViewer binary_viewer;</span>
<a name="l00159"></a>00159 <span class="comment">       </span>
<a name="l00160"></a>00160 <span class="comment">       std::string file_name = name;</span>
<a name="l00161"></a>00161 <span class="comment">       std::ostringstream osstream;</span>
<a name="l00162"></a>00162 <span class="comment">       osstream &lt;&lt; this-&gt;radiation_cavity.getCavityID();</span>
<a name="l00163"></a>00163 <span class="comment">       file_name += osstream.str();</span>
<a name="l00164"></a>00164 <span class="comment">       </span>
<a name="l00165"></a>00165 <span class="comment">       PetscViewerBinaryOpen( FESystem::COMM_WORLD,</span>
<a name="l00166"></a>00166 <span class="comment">       file_name.c_str(),</span>
<a name="l00167"></a>00167 <span class="comment">       PETSC_FILE_CREATE,</span>
<a name="l00168"></a>00168 <span class="comment">       &amp;binary_viewer);</span>
<a name="l00169"></a>00169 <span class="comment">       </span>
<a name="l00170"></a>00170 <span class="comment">       </span>
<a name="l00171"></a>00171 <span class="comment">       MatView(petsc_matrix, binary_viewer);</span>
<a name="l00172"></a>00172 <span class="comment">       </span>
<a name="l00173"></a>00173 <span class="comment">       PetscViewerDestroy(binary_viewer);</span>
<a name="l00174"></a>00174 <span class="comment">       </span>
<a name="l00175"></a>00175 <span class="comment">       MatDestroy(petsc_matrix);</span>
<a name="l00176"></a>00176 <span class="comment">       }*/</span>
<a name="l00177"></a>00177       <span class="comment">//**************** this is only temporary *********************</span>
<a name="l00178"></a>00178       <span class="comment">//**************** this is only temporary *********************</span>
<a name="l00179"></a>00179       <span class="comment">/*          if (qty_name == RadiationCavityAnalysis::F_MATRIX )</span>
<a name="l00180"></a>00180 <span class="comment">       {</span>
<a name="l00181"></a>00181 <span class="comment">       FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;&amp; matrix = *(insert_return_pair.first-&gt;second);</span>
<a name="l00182"></a>00182 <span class="comment">       </span>
<a name="l00183"></a>00183 <span class="comment">       Mat Fmatrix, dFmatrix;</span>
<a name="l00184"></a>00184 <span class="comment">       </span>
<a name="l00185"></a>00185 <span class="comment">       PetscViewer binary_viewer;</span>
<a name="l00186"></a>00186 <span class="comment">       </span>
<a name="l00187"></a>00187 <span class="comment">       std::string base_name, sens_name;</span>
<a name="l00188"></a>00188 <span class="comment">       base_name = this-&gt;getStringNameForQty(qty_name);</span>
<a name="l00189"></a>00189 <span class="comment">       sens_name = this-&gt;getStringNameForQtySensitivity(qty_name, 1);</span>
<a name="l00190"></a>00190 <span class="comment">       </span>
<a name="l00191"></a>00191 <span class="comment">       std::ostringstream osstream;</span>
<a name="l00192"></a>00192 <span class="comment">       osstream &lt;&lt; this-&gt;radiation_cavity.getCavityID();</span>
<a name="l00193"></a>00193 <span class="comment">       </span>
<a name="l00194"></a>00194 <span class="comment">       base_name += osstream.str();</span>
<a name="l00195"></a>00195 <span class="comment">       sens_name += osstream.str();</span>
<a name="l00196"></a>00196 <span class="comment">       </span>
<a name="l00197"></a>00197 <span class="comment">       // Read in F</span>
<a name="l00198"></a>00198 <span class="comment">       PetscViewerBinaryOpen( FESystem::COMM_WORLD,</span>
<a name="l00199"></a>00199 <span class="comment">       base_name.c_str(),</span>
<a name="l00200"></a>00200 <span class="comment">       PETSC_FILE_RDONLY,</span>
<a name="l00201"></a>00201 <span class="comment">       &amp;binary_viewer);</span>
<a name="l00202"></a>00202 <span class="comment">       MatLoad(binary_viewer, MATSEQAIJ, &amp;Fmatrix);</span>
<a name="l00203"></a>00203 <span class="comment">       PetscViewerDestroy(binary_viewer);</span>
<a name="l00204"></a>00204 <span class="comment">       MatAssemblyBegin(Fmatrix, MAT_FINAL_ASSEMBLY);</span>
<a name="l00205"></a>00205 <span class="comment">       MatAssemblyEnd(Fmatrix, MAT_FINAL_ASSEMBLY);</span>
<a name="l00206"></a>00206 <span class="comment">       </span>
<a name="l00207"></a>00207 <span class="comment">       // now read in dF/dalpha</span>
<a name="l00208"></a>00208 <span class="comment">       PetscViewerBinaryOpen( FESystem::COMM_WORLD,</span>
<a name="l00209"></a>00209 <span class="comment">       sens_name.c_str(),</span>
<a name="l00210"></a>00210 <span class="comment">       PETSC_FILE_RDONLY,</span>
<a name="l00211"></a>00211 <span class="comment">       &amp;binary_viewer);</span>
<a name="l00212"></a>00212 <span class="comment">       MatLoad(binary_viewer, MATSEQAIJ, &amp;dFmatrix);</span>
<a name="l00213"></a>00213 <span class="comment">       PetscViewerDestroy(binary_viewer);</span>
<a name="l00214"></a>00214 <span class="comment">       MatAssemblyBegin(dFmatrix, MAT_FINAL_ASSEMBLY);</span>
<a name="l00215"></a>00215 <span class="comment">       MatAssemblyEnd(dFmatrix, MAT_FINAL_ASSEMBLY);</span>
<a name="l00216"></a>00216 <span class="comment">       </span>
<a name="l00217"></a>00217 <span class="comment">       </span>
<a name="l00218"></a>00218 <span class="comment">       double ddv = this-&gt;fesystem_controller.analysis_case-&gt;getRealParameter(&quot;DDV&quot;);</span>
<a name="l00219"></a>00219 <span class="comment">       </span>
<a name="l00220"></a>00220 <span class="comment">       MatAXPY(Fmatrix , ddv, dFmatrix, SAME_NONZERO_PATTERN);</span>
<a name="l00221"></a>00221 <span class="comment">       MatAssemblyBegin(Fmatrix, MAT_FINAL_ASSEMBLY);</span>
<a name="l00222"></a>00222 <span class="comment">       MatAssemblyEnd(Fmatrix, MAT_FINAL_ASSEMBLY);</span>
<a name="l00223"></a>00223 <span class="comment">       </span>
<a name="l00224"></a>00224 <span class="comment">       </span>
<a name="l00225"></a>00225 <span class="comment">       double value;</span>
<a name="l00226"></a>00226 <span class="comment">       for (unsigned int i=0; i &lt; matrix.m(); i++)</span>
<a name="l00227"></a>00227 <span class="comment">       for (unsigned int j=0; j &lt; matrix.n(); j++)</span>
<a name="l00228"></a>00228 <span class="comment">       {</span>
<a name="l00229"></a>00229 <span class="comment">       const int  ii  = i;</span>
<a name="l00230"></a>00230 <span class="comment">       const int jj = j;</span>
<a name="l00231"></a>00231 <span class="comment">       if (DV == NULL)</span>
<a name="l00232"></a>00232 <span class="comment">       MatGetValues(Fmatrix, 1, &amp;ii, 1, &amp;jj, &amp;value);</span>
<a name="l00233"></a>00233 <span class="comment">       else </span>
<a name="l00234"></a>00234 <span class="comment">       MatGetValues(dFmatrix, 1, &amp;ii, 1, &amp;jj, &amp;value);</span>
<a name="l00235"></a>00235 <span class="comment">       </span>
<a name="l00236"></a>00236 <span class="comment">       matrix(i,j) = value;</span>
<a name="l00237"></a>00237 <span class="comment">       }</span>
<a name="l00238"></a>00238 <span class="comment">       </span>
<a name="l00239"></a>00239 <span class="comment">       MatDestroy(Fmatrix);</span>
<a name="l00240"></a>00240 <span class="comment">       MatDestroy(dFmatrix);</span>
<a name="l00241"></a>00241 <span class="comment">       </span>
<a name="l00242"></a>00242 <span class="comment">       }*/</span>
<a name="l00243"></a>00243       <span class="comment">//**************** this is only temporary *********************</span>
<a name="l00244"></a>00244       
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246   <span class="keywordflow">else</span>
<a name="l00247"></a>00247     this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a61c6211b1a2e6518ac9e357e385fad2b" title="stores global matrices and vectors">global_data_storage</a>-&gt;fillMatrix(*data_info, matrix);
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 
<a name="l00254"></a><a class="code" href="class_radiation_cavity_analysis.html#a72530913e06cbae197063f3e3f8fa2ca">00254</a> <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a72530913e06cbae197063f3e3f8fa2ca">RadiationCavityAnalysis::calculateQty</a>(<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>* matrix,
<a name="l00255"></a>00255                                            <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9" title="enum for the matrix names for this analysis">RadiationQty</a> qty)
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257   <span class="keywordflow">switch</span> (qty)
<a name="l00258"></a>00258   {
<a name="l00259"></a>00259     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a710db01b9ba0d3806327e466cf5b6607">RadiationCavityAnalysis::F_MATRIX</a>:
<a name="l00260"></a>00260       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a3a2849b2e8421de972e93744f335e757">calculateShapeFactorMatrix</a>(matrix, <span class="keyword">false</span>);
<a name="l00261"></a>00261       <span class="keywordflow">break</span>;
<a name="l00262"></a>00262       
<a name="l00263"></a>00263     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a01aacfc6d2b8119467903e4413350d70">RadiationCavityAnalysis::F_MATRIX_SENSITIVITY</a>:
<a name="l00264"></a>00264       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a3a2849b2e8421de972e93744f335e757">calculateShapeFactorMatrix</a>(matrix, <span class="keyword">true</span>);
<a name="l00265"></a>00265       <span class="keywordflow">break</span>;
<a name="l00266"></a>00266       
<a name="l00267"></a>00267     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaebaf5b8a62e34552ead17659e9d0415">RadiationCavityAnalysis::A_MATRIX</a>:
<a name="l00268"></a>00268       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a5a8bcd110b1fab5e384846642fc90020">calculateA_Matrix</a>(matrix, <span class="keyword">false</span>);
<a name="l00269"></a>00269       <span class="keywordflow">break</span>;
<a name="l00270"></a>00270       
<a name="l00271"></a>00271     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ae8bc4b7f41e205e9e6fe14a31a551ef0">RadiationCavityAnalysis::A_INVERSE_MATRIX</a>:
<a name="l00272"></a>00272       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a2225147650551e23cfff7ed0e9dcdc4c">calculateA_InverseMatrix</a>(matrix);
<a name="l00273"></a>00273       <span class="keywordflow">break</span>;
<a name="l00274"></a>00274       
<a name="l00275"></a>00275     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9afc5da26c57bb9e45d36e0b65db2e061b">RadiationCavityAnalysis::A_MATRIX_SENSITIVITY</a>:
<a name="l00276"></a>00276       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a5a8bcd110b1fab5e384846642fc90020">calculateA_Matrix</a>(matrix, <span class="keyword">true</span>);
<a name="l00277"></a>00277       <span class="keywordflow">break</span>;
<a name="l00278"></a>00278       
<a name="l00279"></a>00279     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9abe6a1b3373498e2afa348361975f9ee9">RadiationCavityAnalysis::B_MATRIX</a>:
<a name="l00280"></a>00280       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a8142f6d6d27312dc289796a6a7188a61">calculateB_Matrix</a>(matrix, <span class="keyword">false</span>);
<a name="l00281"></a>00281       <span class="keywordflow">break</span>;
<a name="l00282"></a>00282       
<a name="l00283"></a>00283     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aa8e253c18366682e146778d7d9c6d09e">RadiationCavityAnalysis::B_MATRIX_SENSITIVITY</a>:
<a name="l00284"></a>00284       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a8142f6d6d27312dc289796a6a7188a61">calculateB_Matrix</a>(matrix, <span class="keyword">true</span>);
<a name="l00285"></a>00285       <span class="keywordflow">break</span>;
<a name="l00286"></a>00286       
<a name="l00287"></a>00287     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a82a5786d2a5fc2125c69c3b0c4b25795">RadiationCavityAnalysis::B_INVERSE_MATRIX</a>:
<a name="l00288"></a>00288       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a03d86d48b9c5d0cd54a43f34a16326b6">calculateB_InverseMatrix</a>(matrix);
<a name="l00289"></a>00289       <span class="keywordflow">break</span>;
<a name="l00290"></a>00290       
<a name="l00291"></a>00291     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaddba04b27f5a8c99ae4edac90bdf939">RadiationCavityAnalysis::G_MATRIX</a>:
<a name="l00292"></a>00292       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1b96d789767e44f16f503128ed62a5c9">calculateG_Matrix</a>(matrix, <span class="keyword">false</span>);
<a name="l00293"></a>00293       <span class="keywordflow">break</span>;
<a name="l00294"></a>00294       
<a name="l00295"></a>00295     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ab3e00964c9ce893d80049b2b2daf4967">RadiationCavityAnalysis::G_MATRIX_SENSITIVITY</a>:
<a name="l00296"></a>00296       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1b96d789767e44f16f503128ed62a5c9">calculateG_Matrix</a>(matrix, <span class="keyword">true</span>);
<a name="l00297"></a>00297       <span class="keywordflow">break</span>;
<a name="l00298"></a>00298       
<a name="l00299"></a>00299     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a706dd25ad60743b308702c7c244fc998">RadiationCavityAnalysis::FACTOR_MATRIX</a>:
<a name="l00300"></a>00300       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a2efa1a2121b55ef46dd5d57fca123d7c">calculateFactorMatrix</a>(matrix);
<a name="l00301"></a>00301       <span class="keywordflow">break</span>;
<a name="l00302"></a>00302       
<a name="l00303"></a>00303     <span class="keywordflow">case</span> <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ada425f7476e4534bd9684e2d4fab9ce0">RadiationCavityAnalysis::AB_INV_MATRIX</a>:
<a name="l00304"></a>00304       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a9b773a18ce7531728bf76b2b6905723b">calculateABInvFactorMatrix</a>(matrix);
<a name="l00305"></a>00305       <span class="keywordflow">break</span>;
<a name="l00306"></a>00306       
<a name="l00307"></a>00307     <span class="keywordflow">default</span>:
<a name="l00308"></a>00308       abort();
<a name="l00309"></a>00309       <span class="keywordflow">break</span>;
<a name="l00310"></a>00310   }
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a3a2849b2e8421de972e93744f335e757">RadiationCavityAnalysis::calculateShapeFactorMatrix</a>
<a name="l00316"></a><a class="code" href="class_radiation_cavity_analysis.html#a3a2849b2e8421de972e93744f335e757">00316</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>* matrix_ptr,
<a name="l00317"></a>00317  <span class="keywordtype">bool</span> sensitivity)
<a name="l00318"></a>00318 {
<a name="l00319"></a>00319   this-&gt;fesystem_controller.performance_logging-&gt;setEvent
<a name="l00320"></a>00320   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateShapeFactorMatrix()&quot;</span>,
<a name="l00321"></a>00321    this-&gt;performance_logging_header);
<a name="l00322"></a>00322   
<a name="l00323"></a>00323   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; matrix = *(matrix_ptr);
<a name="l00324"></a>00324   
<a name="l00325"></a>00325   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();
<a name="l00326"></a>00326   <span class="keywordflow">if</span> (matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() != n_elems || matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a6cd62edc363882589e4d9520f2c3f566">n</a>() != n_elems)
<a name="l00327"></a>00327     matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#a5acdf5297d21c760dfe0dda54f4d66ca" title="resize the matrix to the given dimensions">resize</a>(n_elems, n_elems);
<a name="l00328"></a>00328   matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a7f4e4f7b27462324d6c89aa908c3cb6c">zero</a>();
<a name="l00329"></a>00329   
<a name="l00330"></a>00330   <span class="comment">// for shape design variable, the shape factor matrix will be calculated for </span>
<a name="l00331"></a>00331   <span class="comment">// the perturbed mesh. The base shape factor matrix, is then retrived and the </span>
<a name="l00332"></a>00332   <span class="comment">// sensitivity is then calculated</span>
<a name="l00333"></a>00333   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> DV_ID = 0;
<a name="l00334"></a>00334   <span class="keywordtype">double</span> perturbation = 0.0;
<a name="l00335"></a>00335   <span class="keywordflow">if</span> (sensitivity)
<a name="l00336"></a>00336     {
<a name="l00337"></a>00337       <span class="comment">// for a Property DV, the sensitivity of this quantity is zero</span>
<a name="l00338"></a>00338       <span class="keyword">const</span> <a class="code" href="class_design_data_1_1_design_parameter.html" title="this class forms the base class for all design parameters.">DesignData::DesignParameter</a>&amp; dparam = 
<a name="l00339"></a>00339       this-&gt;thermal_discipline.getAnalysisDriver().getCurrentDesignParameter();
<a name="l00340"></a>00340       <span class="keywordflow">if</span> (dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#ada780fbd596a879cb3d57cb44376a702">getParameterTypeEnumID</a>() == DesignData::PROPERTY_PARAMETER::num())
<a name="l00341"></a>00341         <span class="keywordflow">return</span>;
<a name="l00342"></a>00342       <span class="keywordflow">else</span> 
<a name="l00343"></a>00343         {
<a name="l00344"></a>00344           DV_ID = dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#ab0cb6d6c10206acebbc06d2be204c2e7">getID</a>();
<a name="l00345"></a>00345           perturbation = dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#a0eb8202d84916cb7562fa2429e3bf7f8">getPerturbationStepSize</a>();
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348   
<a name="l00349"></a>00349   <span class="comment">// get the iterators to the elements of the radiation mesh</span>
<a name="l00350"></a>00350   <a class="code" href="_radiation_cavity_8h.html#a95a54ed90e810eea01d0a99c2d9fdfe4">RadiationElemConstIterator</a> elem_it, elem_end, nested_elem_it;
<a name="l00351"></a>00351   elem_it = this-&gt;radiation_cavity.getElemBeginIterator(DV_ID);
<a name="l00352"></a>00352   elem_end = this-&gt;radiation_cavity.getElemEndIterator(DV_ID);
<a name="l00353"></a>00353   
<a name="l00354"></a>00354   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof_elem1 =0, dof_elem2 = 0;
<a name="l00355"></a>00355   <a class="code" href="class_radiation_element.html">RadiationElement</a> *rad_elem1 = NULL, *rad_elem2 = NULL;
<a name="l00356"></a>00356   <a class="code" href="class_radiation_element_pair.html">RadiationElementPair</a> elem_pair;
<a name="l00357"></a>00357   
<a name="l00358"></a>00358   <span class="comment">// do a nested iteration on the elements</span>
<a name="l00359"></a>00359   <span class="keywordflow">for</span> ( ; elem_it != elem_end; elem_it++)
<a name="l00360"></a>00360     {
<a name="l00361"></a>00361       rad_elem1 = *elem_it;
<a name="l00362"></a>00362       
<a name="l00363"></a>00363       dof_elem1 = rad_elem1-&gt;<a class="code" href="class_radiation_element.html#a447d88c256c0428c9d7750f9d6a2efb2" title="ID of the elem.">ID</a>();
<a name="l00364"></a>00364       
<a name="l00365"></a>00365       <span class="comment">// inside the loop, create a pair of the two elements for which shape</span>
<a name="l00366"></a>00366       <span class="comment">// factor calculations will have to be performed</span>
<a name="l00367"></a>00367       nested_elem_it = elem_it;
<a name="l00368"></a>00368       nested_elem_it++;
<a name="l00369"></a>00369       
<a name="l00370"></a>00370       <span class="keywordflow">for</span> (; nested_elem_it != elem_end; nested_elem_it++)
<a name="l00371"></a>00371         {
<a name="l00372"></a>00372           <span class="comment">// create an element pair for the two elements, and calculate the shape factor</span>
<a name="l00373"></a>00373           rad_elem2 = *nested_elem_it;
<a name="l00374"></a>00374           
<a name="l00375"></a>00375           dof_elem2 = rad_elem2-&gt;ID();
<a name="l00376"></a>00376           
<a name="l00377"></a>00377           elem_pair.<a class="code" href="class_radiation_element_pair.html#ac2c50e1d3bcc6f8086469389a56bb229" title="initializes the pair with two elements">reinit</a>(rad_elem1, rad_elem2);
<a name="l00378"></a>00378 <span class="preprocessor">#ifdef WITH_MATHEMATICA</span>
<a name="l00379"></a>00379 <span class="preprocessor"></span>          elem_pair.setMathLink(FESystem::mathlink_link);
<a name="l00380"></a>00380 <span class="preprocessor">#endif</span>
<a name="l00381"></a>00381 <span class="preprocessor"></span>          
<a name="l00382"></a>00382           <span class="comment">// get the shape factors from this element pair, and set the appropriate </span>
<a name="l00383"></a>00383           <span class="comment">// matrix elements in the shape factor matrix. note that both f12 and f21 </span>
<a name="l00384"></a>00384           <span class="comment">// need to be obtained.</span>
<a name="l00385"></a>00385           std::pair&lt;double, double&gt; shape_factors = 
<a name="l00386"></a>00386           elem_pair.<a class="code" href="class_radiation_element_pair.html#a82194ce5777e2ca4e4824bcf64a62496">getShapeFactor</a>(<a class="code" href="class_radiation_element_pair.html#ad8dffe6ca48b084fb7f88fff36dc532da62bd790cf2af06cb857619412c85d39e">RadiationElementPair::MITALAS_CONTOUR_INT</a>);
<a name="l00387"></a>00387           
<a name="l00388"></a>00388           <span class="comment">// next, insert the two shape factors into the shape factor matrix</span>
<a name="l00389"></a>00389           matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a029417d563ab83a4825b417682e9ce38">set</a>(dof_elem1, dof_elem2, shape_factors.first);
<a name="l00390"></a>00390           matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a029417d563ab83a4825b417682e9ce38">set</a>(dof_elem2, dof_elem1, shape_factors.second);
<a name="l00391"></a>00391           
<a name="l00392"></a>00392           <span class="comment">// clear the radiation element pair initialization</span>
<a name="l00393"></a>00393           elem_pair.<a class="code" href="class_radiation_element_pair.html#ae297673eb5565ceba91e952b2db04dec" title="clears the initialization">clear</a>();
<a name="l00394"></a>00394         }
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396   
<a name="l00397"></a>00397   <span class="keywordflow">if</span> (sensitivity) <span class="comment">// implies shape sensitivity is being sought</span>
<a name="l00398"></a>00398     {
<a name="l00399"></a>00399       <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> matrix_base(n_elems, n_elems);
<a name="l00400"></a>00400       this-&gt;getMatrixQuantity(matrix_base,
<a name="l00401"></a>00401                               <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a710db01b9ba0d3806327e466cf5b6607">RadiationCavityAnalysis::F_MATRIX</a>);
<a name="l00402"></a>00402       matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a5cf620d20826ab76f11656a9e73acaaa">add</a>(-1.0, matrix_base, <span class="keyword">true</span>);
<a name="l00403"></a>00403       matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a1974a31b7aae6c6ff305dc612dc5113b">scale</a>(1.0/perturbation);
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405   
<a name="l00406"></a>00406   this-&gt;fesystem_controller.performance_logging-&gt;unsetEvent
<a name="l00407"></a>00407   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateShapeFactorMatrix()&quot;</span>,
<a name="l00408"></a>00408    this-&gt;performance_logging_header);
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 
<a name="l00415"></a><a class="code" href="class_radiation_cavity_analysis.html#a5a8bcd110b1fab5e384846642fc90020">00415</a> <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a5a8bcd110b1fab5e384846642fc90020">RadiationCavityAnalysis::calculateA_Matrix</a>(<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>* matrix_ptr,
<a name="l00416"></a>00416                                                 <span class="keywordtype">bool</span> sensitivity)
<a name="l00417"></a>00417 {
<a name="l00418"></a>00418   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a4201bf5919eac5fb0fcc87ba36368d6c" title="Performance logging.">performance_logging</a>-&gt;setEvent
<a name="l00419"></a>00419   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateA_Matrix()&quot;</span>,
<a name="l00420"></a>00420    this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#aa6dcacf6d9a9f8f15e150f7bb86c88c2" title="performance logging header">performance_logging_header</a>);
<a name="l00421"></a>00421   
<a name="l00422"></a>00422   <span class="comment">// get a pointer to the matrices</span>
<a name="l00423"></a>00423   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; matrix = *matrix_ptr;
<a name="l00424"></a>00424   
<a name="l00425"></a>00425   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1f138bfc5a3a6de6219d5893bfb79ec0" title="cavity for this analysis">radiation_cavity</a>.<a class="code" href="class_radiation_cavity.html#a5fb60ba2eb1d222cd3457059eec084b1" title="returns the number of radiation elems in the cavity">nRadiationElems</a>();
<a name="l00426"></a>00426   <span class="keywordflow">if</span> (matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() != n_elems || matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a6cd62edc363882589e4d9520f2c3f566">n</a>() != n_elems)
<a name="l00427"></a>00427     matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#a5acdf5297d21c760dfe0dda54f4d66ca" title="resize the matrix to the given dimensions">resize</a>(n_elems, n_elems);
<a name="l00428"></a>00428   matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a7f4e4f7b27462324d6c89aa908c3cb6c">zero</a>();
<a name="l00429"></a>00429   
<a name="l00430"></a>00430   <span class="comment">// for shape design variable, the shape factor matrix will be calculated for </span>
<a name="l00431"></a>00431   <span class="comment">// the perturbed mesh. The base shape factor matrix, is then retrived and the </span>
<a name="l00432"></a>00432   <span class="comment">// sensitivity is then calculated</span>
<a name="l00433"></a>00433   <span class="keywordflow">if</span> (sensitivity)
<a name="l00434"></a>00434     {
<a name="l00435"></a>00435       <span class="comment">// for a Property DV, the sensitivity of this quantity is zero</span>
<a name="l00436"></a>00436       <span class="keyword">const</span> <a class="code" href="class_design_data_1_1_design_parameter.html" title="this class forms the base class for all design parameters.">DesignData::DesignParameter</a>&amp; dparam = 
<a name="l00437"></a>00437       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>().<a class="code" href="class_driver_1_1_analysis_driver.html#ac258e74334cc629c3961bde90f9e5fd9" title="returns the current design variable">getCurrentDesignParameter</a>();
<a name="l00438"></a>00438       <span class="keywordflow">if</span> (dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#ada780fbd596a879cb3d57cb44376a702">getParameterTypeEnumID</a>() == DesignData::PROPERTY_PARAMETER::num())
<a name="l00439"></a>00439         <span class="keywordflow">return</span>;
<a name="l00440"></a>00440     }
<a name="l00441"></a>00441   
<a name="l00442"></a>00442   
<a name="l00443"></a>00443   <span class="comment">// in case the DV is NULL, the F_matrix will contain the actual shape factor matrix, </span>
<a name="l00444"></a>00444   <span class="comment">// otherwise, it will contain the sensitivity of the shape factor matrix</span>
<a name="l00445"></a>00445   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> F_matrix(n_elems, n_elems); 
<a name="l00446"></a>00446   <span class="keywordflow">if</span> (sensitivity)
<a name="l00447"></a>00447     this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a9f4b19a51682c6e3aceaa1c7f507b389">getMatrixQuantity</a>(F_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a01aacfc6d2b8119467903e4413350d70">RadiationCavityAnalysis::F_MATRIX_SENSITIVITY</a>);
<a name="l00448"></a>00448   <span class="keywordflow">else</span>
<a name="l00449"></a>00449     this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a9f4b19a51682c6e3aceaa1c7f507b389">getMatrixQuantity</a>(F_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a710db01b9ba0d3806327e466cf5b6607">RadiationCavityAnalysis::F_MATRIX</a>);
<a name="l00450"></a>00450   
<a name="l00451"></a>00451   <span class="comment">// get the value of sigma</span>
<a name="l00452"></a>00452   <span class="keywordtype">double</span> <a class="code" href="_arpack_eigen_solver_8h.html#ac687728cb5722b5730ca1b1197128920">sigma</a> = 
<a name="l00453"></a>00453   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#ae2f9f30b83db8a3cb69787c283708210" title="stores analysis details">analysis_case</a>-&gt;getRealParameter(<span class="stringliteral">&quot;S_B_CONSTANT&quot;</span>);
<a name="l00454"></a>00454   
<a name="l00455"></a>00455   <span class="comment">// calculate [A] = sigma * ([I] - [F]) or its sensitivity</span>
<a name="l00456"></a>00456   matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a5cf620d20826ab76f11656a9e73acaaa">add</a>(-1.0, F_matrix, <span class="keyword">true</span>);
<a name="l00457"></a>00457   
<a name="l00458"></a>00458   <span class="keywordflow">if</span> (!sensitivity)
<a name="l00459"></a>00459     matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a61d3ca9a3e1f750e2b28f1dd503990d7" title="adds val to all diagonal elements of the matrix">shift</a>(1.0);
<a name="l00460"></a>00460   
<a name="l00461"></a>00461   <span class="comment">// finally, scale the parameter with sigma</span>
<a name="l00462"></a>00462   matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a1974a31b7aae6c6ff305dc612dc5113b">scale</a>(sigma);
<a name="l00463"></a>00463   
<a name="l00464"></a>00464   
<a name="l00465"></a>00465   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a4201bf5919eac5fb0fcc87ba36368d6c" title="Performance logging.">performance_logging</a>-&gt;unsetEvent
<a name="l00466"></a>00466   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateA_Matrix()&quot;</span>,
<a name="l00467"></a>00467    this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#aa6dcacf6d9a9f8f15e150f7bb86c88c2" title="performance logging header">performance_logging_header</a>);
<a name="l00468"></a>00468 }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 
<a name="l00472"></a><a class="code" href="class_radiation_cavity_analysis.html#a8142f6d6d27312dc289796a6a7188a61">00472</a> <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a8142f6d6d27312dc289796a6a7188a61">RadiationCavityAnalysis::calculateB_Matrix</a>(<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>* matrix_ptr,
<a name="l00473"></a>00473                                                 <span class="keywordtype">bool</span> sensitivity)
<a name="l00474"></a>00474 {
<a name="l00475"></a>00475   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a4201bf5919eac5fb0fcc87ba36368d6c" title="Performance logging.">performance_logging</a>-&gt;setEvent
<a name="l00476"></a>00476   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateB_Matrix()&quot;</span>,
<a name="l00477"></a>00477    this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#aa6dcacf6d9a9f8f15e150f7bb86c88c2" title="performance logging header">performance_logging_header</a>);
<a name="l00478"></a>00478   
<a name="l00479"></a>00479   <span class="comment">// get a pointer to the matrices</span>
<a name="l00480"></a>00480   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; matrix = *matrix_ptr;
<a name="l00481"></a>00481   
<a name="l00482"></a>00482   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1f138bfc5a3a6de6219d5893bfb79ec0" title="cavity for this analysis">radiation_cavity</a>.<a class="code" href="class_radiation_cavity.html#a5fb60ba2eb1d222cd3457059eec084b1" title="returns the number of radiation elems in the cavity">nRadiationElems</a>();
<a name="l00483"></a>00483   <span class="keywordflow">if</span> (matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() != n_elems || matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a6cd62edc363882589e4d9520f2c3f566">n</a>() != n_elems)
<a name="l00484"></a>00484     matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#a5acdf5297d21c760dfe0dda54f4d66ca" title="resize the matrix to the given dimensions">resize</a>(n_elems, n_elems);
<a name="l00485"></a>00485   matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a7f4e4f7b27462324d6c89aa908c3cb6c">zero</a>();
<a name="l00486"></a>00486   
<a name="l00487"></a>00487   <span class="keyword">const</span> <a class="code" href="class_design_data_1_1_design_parameter.html" title="this class forms the base class for all design parameters.">DesignData::DesignParameter</a>* dparam = NULL;
<a name="l00488"></a>00488   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> DV_ID = 0;
<a name="l00489"></a>00489   <span class="keywordflow">if</span> (sensitivity)
<a name="l00490"></a>00490     {
<a name="l00491"></a>00491       <span class="comment">// for a Property DV, the sensitivity of this quantity is zero</span>
<a name="l00492"></a>00492       dparam = 
<a name="l00493"></a>00493       &amp;(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>().<a class="code" href="class_driver_1_1_analysis_driver.html#ac258e74334cc629c3961bde90f9e5fd9" title="returns the current design variable">getCurrentDesignParameter</a>());
<a name="l00494"></a>00494       DV_ID = dparam-&gt;<a class="code" href="class_design_data_1_1_design_parameter.html#ab0cb6d6c10206acebbc06d2be204c2e7">getID</a>();
<a name="l00495"></a>00495       
<a name="l00496"></a>00496       <span class="keywordflow">if</span> (dparam-&gt;<a class="code" href="class_design_data_1_1_design_parameter.html#ada780fbd596a879cb3d57cb44376a702">getParameterTypeEnumID</a>() == DesignData::PROPERTY_PARAMETER::num())
<a name="l00497"></a>00497         this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a9f4b19a51682c6e3aceaa1c7f507b389">getMatrixQuantity</a>(matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a710db01b9ba0d3806327e466cf5b6607">RadiationCavityAnalysis::F_MATRIX</a>);
<a name="l00498"></a>00498       <span class="keywordflow">else</span>
<a name="l00499"></a>00499         this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a9f4b19a51682c6e3aceaa1c7f507b389">getMatrixQuantity</a>(matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a01aacfc6d2b8119467903e4413350d70">RadiationCavityAnalysis::F_MATRIX_SENSITIVITY</a>);
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501   <span class="keywordflow">else</span> 
<a name="l00502"></a>00502     this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a9f4b19a51682c6e3aceaa1c7f507b389">getMatrixQuantity</a>(matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a710db01b9ba0d3806327e466cf5b6607">RadiationCavityAnalysis::F_MATRIX</a>);
<a name="l00503"></a>00503   
<a name="l00504"></a>00504   
<a name="l00505"></a>00505   <a class="code" href="class_property_1_1_property_database.html">Property::PropertyDatabase</a>&amp; property_database = 
<a name="l00506"></a>00506   *(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a698a7debaa46df85ed9cbeef30536254" title="stores property cards">property_database</a>.get());
<a name="l00507"></a>00507   <a class="code" href="class_mesh_d_s_1_1_f_e_mesh_data.html">MeshDS::FEMeshData</a>&amp; mesh_data = *(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1f138bfc5a3a6de6219d5893bfb79ec0" title="cavity for this analysis">radiation_cavity</a>.<a class="code" href="class_radiation_cavity.html#a4c47512a0221ec3bd6cc5bf93d38d17d">getMeshData</a>());
<a name="l00508"></a>00508   
<a name="l00509"></a>00509   <span class="comment">// calculate [B] = [1/epsilon] - [(1 - epsilon)/epsilon] [F]</span>
<a name="l00510"></a>00510   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_rad_elems = this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1f138bfc5a3a6de6219d5893bfb79ec0" title="cavity for this analysis">radiation_cavity</a>.<a class="code" href="class_radiation_cavity.html#a5fb60ba2eb1d222cd3457059eec084b1" title="returns the number of radiation elems in the cavity">nRadiationElems</a>(),
<a name="l00511"></a>00511   fe_elem_ID = 0,  property_ID = 0;
<a name="l00512"></a>00512   <span class="keywordtype">double</span>  factor1 = 0.0, factor2 = 0.0;
<a name="l00513"></a>00513   
<a name="l00514"></a>00514   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> factor_1_vec(n_elems),
<a name="l00515"></a>00515   factor_2_vec(n_elems);
<a name="l00516"></a>00516   
<a name="l00517"></a>00517   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; n_rad_elems; i++)
<a name="l00518"></a>00518     {
<a name="l00519"></a>00519       <span class="comment">// get the ID of the finite elem, get the property card for this elem</span>
<a name="l00520"></a>00520       fe_elem_ID = this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1f138bfc5a3a6de6219d5893bfb79ec0" title="cavity for this analysis">radiation_cavity</a>.<a class="code" href="class_radiation_cavity.html#aa2186ca4c287a20ae923e6b5a5619801">getElemFromID</a>(i).<a class="code" href="class_radiation_element.html#a3cae7f1c590c9bb5de710f8e5fe517eb" title="ID of the finite element that this is attached to.">FeElementID</a>();
<a name="l00521"></a>00521       <span class="keyword">const</span> Elem* elem = mesh_data.<a class="code" href="class_mesh_d_s_1_1_f_e_mesh_data.html#ad0a5644dd5120fb02d602cae62a5a330">getElemFromForeignID</a>(fe_elem_ID);
<a name="l00522"></a>00522       property_ID = mesh_data.<a class="code" href="class_mesh_d_s_1_1_f_e_mesh_data.html#ae50bb83a080c0f9d30cb6a7b9458af54">getElemPropertyID</a>(elem);
<a name="l00523"></a>00523       <a class="code" href="class_elem_data_card.html">ElemDataCard</a>&amp; elem_data_card = property_database.<a class="code" href="class_property_1_1_property_database.html#a4120ff84d49bd7d1b547507759f2d27f" title="returns the element property card for this ID">getElemDataCardFromID</a>(property_ID);
<a name="l00524"></a>00524       
<a name="l00525"></a>00525       <span class="comment">// if the property is temperature dependent, then initialize the property card </span>
<a name="l00526"></a>00526       <span class="comment">// at the average temperature of the finite element to which this radiation </span>
<a name="l00527"></a>00527       <span class="comment">// element belongs</span>
<a name="l00528"></a>00528       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a3db1f2f4043524354d149fe910fd72df" title="initializes the property card at the specified temperature">initializePropertyCardAtElementTemperature</a>(elem_data_card, i);
<a name="l00529"></a>00529       
<a name="l00530"></a>00530       <span class="keywordflow">if</span> (sensitivity)
<a name="l00531"></a>00531         {
<a name="l00532"></a>00532           <span class="keywordflow">if</span> (dparam-&gt;<a class="code" href="class_design_data_1_1_design_parameter.html#ada780fbd596a879cb3d57cb44376a702">getParameterTypeEnumID</a>() == DesignData::PROPERTY_PARAMETER::num())
<a name="l00533"></a>00533             {
<a name="l00534"></a>00534               <span class="comment">// sensitivity wrt global property parameter</span>
<a name="l00535"></a>00535               elem_data_card.<a class="code" href="class_elem_data_card.html#afb821b62f9ea7f4b9895115ee33bee7c">getFactorSensitivityForGlobalParameter</a>(factor1, 
<a name="l00536"></a>00536                                                                     RADIATION_EPSILON_FACTOR_1::num(),
<a name="l00537"></a>00537                                                                     DV_ID);
<a name="l00538"></a>00538               elem_data_card.<a class="code" href="class_elem_data_card.html#afb821b62f9ea7f4b9895115ee33bee7c">getFactorSensitivityForGlobalParameter</a>(factor2,
<a name="l00539"></a>00539                                                                     RADIATION_EPSILON_FACTOR_2::num(),
<a name="l00540"></a>00540                                                                     DV_ID);
<a name="l00541"></a>00541             }
<a name="l00542"></a>00542           <span class="keywordflow">else</span> 
<a name="l00543"></a>00543             {
<a name="l00544"></a>00544               <span class="comment">// shape sensitivity</span>
<a name="l00545"></a>00545               elem_data_card.<a class="code" href="class_elem_data_card.html#a27af74f2017cf1c03e920645e59a2359" title="returns the value of the factor">getFactor</a>(factor1, RADIATION_EPSILON_FACTOR_1::num());
<a name="l00546"></a>00546               elem_data_card.<a class="code" href="class_elem_data_card.html#a27af74f2017cf1c03e920645e59a2359" title="returns the value of the factor">getFactor</a>(factor2, RADIATION_EPSILON_FACTOR_2::num());
<a name="l00547"></a>00547             }
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549       <span class="keywordflow">else</span> 
<a name="l00550"></a>00550         {
<a name="l00551"></a>00551           elem_data_card.<a class="code" href="class_elem_data_card.html#a27af74f2017cf1c03e920645e59a2359" title="returns the value of the factor">getFactor</a>(factor1, RADIATION_EPSILON_FACTOR_1::num());
<a name="l00552"></a>00552           elem_data_card.<a class="code" href="class_elem_data_card.html#a27af74f2017cf1c03e920645e59a2359" title="returns the value of the factor">getFactor</a>(factor2, RADIATION_EPSILON_FACTOR_2::num());
<a name="l00553"></a>00553           <span class="keywordflow">if</span> (factor1 &lt;= 1.0)
<a name="l00554"></a>00554             std::cout &lt;&lt; <span class="stringliteral">&quot;emissivity greater than 1, factor : &quot;</span> &lt;&lt; factor1 &lt;&lt; std::endl;
<a name="l00555"></a>00555         }
<a name="l00556"></a>00556       
<a name="l00557"></a>00557       
<a name="l00558"></a>00558       
<a name="l00559"></a>00559       factor_2_vec.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a9fe9c425efb52cefc5b552cdf3295328">set</a>(i, -factor2);
<a name="l00560"></a>00560       factor_1_vec.set(i, factor1);
<a name="l00561"></a>00561       
<a name="l00562"></a>00562       this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af707b1f733c9f12a5d791d18c74efc47" title="clears the property card initialization">clearPropertyCardInitialization</a>(elem_data_card);
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564   
<a name="l00565"></a>00565   matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aa6a1ff5036f446d56c04ebc418ff2e2d">leftDiagonalScale</a>(factor_2_vec);
<a name="l00566"></a>00566   
<a name="l00567"></a>00567   <span class="keywordflow">if</span> (!(sensitivity &amp;&amp; 
<a name="l00568"></a>00568         dparam-&gt;<a class="code" href="class_design_data_1_1_design_parameter.html#ada780fbd596a879cb3d57cb44376a702">getParameterTypeEnumID</a>() == DesignData::SHAPE_PARAMETER::num()))
<a name="l00569"></a>00569     matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a15f229e47968131c7df600ba3e6f2448">diagonalAdd</a>(1.0, factor_1_vec);
<a name="l00570"></a>00570   
<a name="l00571"></a>00571   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a548f39e72dfdeea8e77d637931023e55" title="fesystem controller for this analysis">fesystem_controller</a>.<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a4201bf5919eac5fb0fcc87ba36368d6c" title="Performance logging.">performance_logging</a>-&gt;unsetEvent
<a name="l00572"></a>00572   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateB_Matrix()&quot;</span>,
<a name="l00573"></a>00573    this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#aa6dcacf6d9a9f8f15e150f7bb86c88c2" title="performance logging header">performance_logging_header</a>);
<a name="l00574"></a>00574 }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 
<a name="l00578"></a>00578 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a1b96d789767e44f16f503128ed62a5c9">RadiationCavityAnalysis::calculateG_Matrix</a>
<a name="l00579"></a><a class="code" href="class_radiation_cavity_analysis.html#a1b96d789767e44f16f503128ed62a5c9">00579</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>* matrix_ptr,
<a name="l00580"></a>00580  <span class="keywordtype">bool</span> sensitivity)
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582   this-&gt;fesystem_controller.performance_logging-&gt;setEvent
<a name="l00583"></a>00583   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateG_Matrix()&quot;</span>,
<a name="l00584"></a>00584    this-&gt;performance_logging_header);
<a name="l00585"></a>00585   
<a name="l00586"></a>00586   <span class="comment">// get a pointer to the matrices</span>
<a name="l00587"></a>00587   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; matrix = *matrix_ptr;
<a name="l00588"></a>00588   
<a name="l00589"></a>00589   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();
<a name="l00590"></a>00590   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_nodes = this-&gt;radiation_cavity.getFENodes().size();
<a name="l00591"></a>00591   <span class="keywordflow">if</span> (matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() != n_elems || matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a6cd62edc363882589e4d9520f2c3f566">n</a>() != n_nodes)
<a name="l00592"></a>00592     matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#a5acdf5297d21c760dfe0dda54f4d66ca" title="resize the matrix to the given dimensions">resize</a>(n_elems, n_nodes);
<a name="l00593"></a>00593   matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a7f4e4f7b27462324d6c89aa908c3cb6c">zero</a>();
<a name="l00594"></a>00594   
<a name="l00595"></a>00595   <span class="comment">// for shape design variable, the shape factor matrix will be calculated for </span>
<a name="l00596"></a>00596   <span class="comment">// the perturbed mesh. The base shape factor matrix, is then retrived and the </span>
<a name="l00597"></a>00597   <span class="comment">// sensitivity is then calculated</span>
<a name="l00598"></a>00598   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> DV_ID = 0;
<a name="l00599"></a>00599   <span class="keywordtype">double</span> perturbation = 0.0;
<a name="l00600"></a>00600   <span class="keywordflow">if</span> (sensitivity)
<a name="l00601"></a>00601     {
<a name="l00602"></a>00602       <span class="comment">// for a Property DV, the sensitivity of this quantity is zero</span>
<a name="l00603"></a>00603       <span class="keyword">const</span> <a class="code" href="class_design_data_1_1_design_parameter.html" title="this class forms the base class for all design parameters.">DesignData::DesignParameter</a>&amp; dparam = 
<a name="l00604"></a>00604       this-&gt;thermal_discipline.getAnalysisDriver().getCurrentDesignParameter();
<a name="l00605"></a>00605       <span class="keywordflow">if</span> (dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#ada780fbd596a879cb3d57cb44376a702">getParameterTypeEnumID</a>() == DesignData::PROPERTY_PARAMETER::num())
<a name="l00606"></a>00606         <span class="keywordflow">return</span>;
<a name="l00607"></a>00607       <span class="keywordflow">else</span> 
<a name="l00608"></a>00608         {
<a name="l00609"></a>00609           DV_ID = dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#ab0cb6d6c10206acebbc06d2be204c2e7">getID</a>();
<a name="l00610"></a>00610           perturbation = dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#a0eb8202d84916cb7562fa2429e3bf7f8">getPerturbationStepSize</a>();
<a name="l00611"></a>00611         }
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613   
<a name="l00614"></a>00614   
<a name="l00615"></a>00615   <span class="comment">// iterate over all the radiation elements, get G matrix from each, </span>
<a name="l00616"></a>00616   <span class="comment">// and add them to the global G matrix. The rows where the G matrix rows </span>
<a name="l00617"></a>00617   <span class="comment">// will be added will be the dof of the radiation element</span>
<a name="l00618"></a>00618   <span class="comment">// and the column will be the node number for the FE to which this</span>
<a name="l00619"></a>00619   <span class="comment">// radiation element belongs</span>
<a name="l00620"></a>00620   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> elem_dof = 0, n_elem_nodes = 0;
<a name="l00621"></a>00621   std::vector&lt;unsigned int&gt; fe_node_ID_vec;
<a name="l00622"></a>00622   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> elem_G_vec;
<a name="l00623"></a>00623   
<a name="l00624"></a>00624   <span class="comment">// if sensitivity is requested, then the DV_ID will be nonzero, due to which</span>
<a name="l00625"></a>00625   <span class="comment">// the elem iterators will point to the perturbed geom elements</span>
<a name="l00626"></a>00626   <a class="code" href="_radiation_cavity_8h.html#a95a54ed90e810eea01d0a99c2d9fdfe4">RadiationElemConstIterator</a> elem_it, elem_end;
<a name="l00627"></a>00627   elem_it = this-&gt;radiation_cavity.getElemBeginIterator(DV_ID);
<a name="l00628"></a>00628   elem_end = this-&gt;radiation_cavity.getElemEndIterator(DV_ID);
<a name="l00629"></a>00629   
<a name="l00630"></a>00630   <span class="keywordflow">for</span> (; elem_it != elem_end; elem_it++)
<a name="l00631"></a>00631     {
<a name="l00632"></a>00632       elem_dof = (*elem_it)-&gt;ID();
<a name="l00633"></a>00633       this-&gt;radiation_cavity.getInternalNodeIDForRadElem
<a name="l00634"></a>00634       (elem_dof, fe_node_ID_vec);
<a name="l00635"></a>00635       
<a name="l00636"></a>00636       n_elem_nodes = fe_node_ID_vec.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>();
<a name="l00637"></a>00637       
<a name="l00638"></a>00638       elem_G_vec.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html#a734ca8b60d564df1539ae11e9fd5f867" title="resize the matrix to the given dimensions">resize</a>(n_elem_nodes);
<a name="l00639"></a>00639       
<a name="l00640"></a>00640       (*elem_it)-&gt;getRadElemG_Vector(elem_G_vec);
<a name="l00641"></a>00641       
<a name="l00642"></a>00642       matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#ae18d819dc1f95b6b8f157055b2d9c27c">setRow</a>(elem_dof, fe_node_ID_vec, elem_G_vec);
<a name="l00643"></a>00643     }
<a name="l00644"></a>00644   
<a name="l00645"></a>00645   <span class="keywordflow">if</span> (sensitivity) <span class="comment">// implies shape sensitivity is being sought</span>
<a name="l00646"></a>00646     {
<a name="l00647"></a>00647       <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> matrix_base(n_elems, n_nodes); 
<a name="l00648"></a>00648       this-&gt;getMatrixQuantity(matrix_base, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaddba04b27f5a8c99ae4edac90bdf939">RadiationCavityAnalysis::G_MATRIX</a>);
<a name="l00649"></a>00649       matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a5cf620d20826ab76f11656a9e73acaaa">add</a>(-1.0, matrix_base, <span class="keyword">true</span>);
<a name="l00650"></a>00650       matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a1974a31b7aae6c6ff305dc612dc5113b">scale</a>(1.0/perturbation);
<a name="l00651"></a>00651     }
<a name="l00652"></a>00652   
<a name="l00653"></a>00653   this-&gt;fesystem_controller.performance_logging-&gt;unsetEvent
<a name="l00654"></a>00654   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateG_Matrix()&quot;</span>,
<a name="l00655"></a>00655    this-&gt;performance_logging_header);
<a name="l00656"></a>00656   
<a name="l00657"></a>00657 }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a2225147650551e23cfff7ed0e9dcdc4c">RadiationCavityAnalysis::calculateA_InverseMatrix</a>
<a name="l00661"></a><a class="code" href="class_radiation_cavity_analysis.html#a2225147650551e23cfff7ed0e9dcdc4c">00661</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>* matrix_ptr)
<a name="l00662"></a>00662 {
<a name="l00663"></a>00663   this-&gt;fesystem_controller.performance_logging-&gt;setEvent
<a name="l00664"></a>00664   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateA_InverseMatrix()&quot;</span>,
<a name="l00665"></a>00665    this-&gt;performance_logging_header);
<a name="l00666"></a>00666   
<a name="l00667"></a>00667   <span class="comment">//  std::cout&lt;&lt; &quot;asked for A_inv&quot; &lt;&lt; std::endl;</span>
<a name="l00668"></a>00668   
<a name="l00669"></a>00669   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; A_inverse_matrix = *matrix_ptr;
<a name="l00670"></a>00670   
<a name="l00671"></a>00671   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();
<a name="l00672"></a>00672   <span class="keywordflow">if</span> (A_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() != n_elems || A_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a6cd62edc363882589e4d9520f2c3f566">n</a>() != n_elems)
<a name="l00673"></a>00673     A_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#a5acdf5297d21c760dfe0dda54f4d66ca" title="resize the matrix to the given dimensions">resize</a>(n_elems, n_elems);
<a name="l00674"></a>00674   A_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a7f4e4f7b27462324d6c89aa908c3cb6c">zero</a>();
<a name="l00675"></a>00675   
<a name="l00676"></a>00676   <span class="comment">// get the A_matrix </span>
<a name="l00677"></a>00677   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> A_matrix(n_elems, n_elems); 
<a name="l00678"></a>00678   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> tmp_vector(n_elems), sol_vector(n_elems);
<a name="l00679"></a>00679   this-&gt;getMatrixQuantity(A_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaebaf5b8a62e34552ead17659e9d0415">RadiationCavityAnalysis::A_MATRIX</a>);
<a name="l00680"></a>00680   A_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#adbf89f7947378034e9f5ff67898981c9" title="method to perform a final assembly of the matrix">finalAssemble</a>();
<a name="l00681"></a>00681   tmp_vector.zero();
<a name="l00682"></a>00682   
<a name="l00683"></a>00683   <span class="comment">// create a petsc mat and set its values to the B matrix.</span>
<a name="l00684"></a>00684   Mat matrix = A_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a73251b033aaa5845cc318163239eac5d" title="returns the Petsc matrix data structure">getMat</a>();
<a name="l00685"></a>00685   
<a name="l00686"></a>00686   <span class="comment">// create a PC context and create the LU factorization</span>
<a name="l00687"></a>00687   PC petsc_pc;
<a name="l00688"></a>00688   
<a name="l00689"></a>00689   PCCreate(PETSC_COMM_SELF, &amp;petsc_pc);
<a name="l00690"></a>00690   PCSetType(petsc_pc , PCLU);
<a name="l00691"></a>00691   PCFactorSetUseInPlace(petsc_pc);
<a name="l00692"></a>00692   PCSetOperators(petsc_pc, matrix, matrix, SAME_NONZERO_PATTERN);
<a name="l00693"></a>00693   PCSetUp(petsc_pc);
<a name="l00694"></a>00694   
<a name="l00695"></a>00695   Mat lu_mat;
<a name="l00696"></a>00696         MatStructure str;
<a name="l00697"></a>00697   PCGetOperators(petsc_pc, PETSC_NULL, &amp;lu_mat, &amp;str);
<a name="l00698"></a>00698   
<a name="l00699"></a>00699   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; n_elems; i++)
<a name="l00700"></a>00700     {
<a name="l00701"></a>00701       tmp_vector.set(i,1.0);
<a name="l00702"></a>00702       tmp_vector.assemble();
<a name="l00703"></a>00703       sol_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l00704"></a>00704       MatSolve(lu_mat, tmp_vector.getVec(), sol_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a805d72fe99d9faf92f7adc389fcdd349" title="returns the Petsc matrix data structure">getVec</a>());
<a name="l00705"></a>00705       tmp_vector.set(i,0.0);
<a name="l00706"></a>00706       
<a name="l00707"></a>00707       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;n_elems; j++)
<a name="l00708"></a>00708         A_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a029417d563ab83a4825b417682e9ce38">set</a>(j,i,sol_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a98c553254ecd51c3ece2b86e52cd960e">el</a>(j));
<a name="l00709"></a>00709     }
<a name="l00710"></a>00710   
<a name="l00711"></a>00711   PCDestroy(petsc_pc);
<a name="l00712"></a>00712   
<a name="l00713"></a>00713   this-&gt;fesystem_controller.performance_logging-&gt;unsetEvent
<a name="l00714"></a>00714   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateA_InverseMatrix()&quot;</span>,
<a name="l00715"></a>00715    this-&gt;performance_logging_header);
<a name="l00716"></a>00716 }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 
<a name="l00720"></a>00720 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a03d86d48b9c5d0cd54a43f34a16326b6">RadiationCavityAnalysis::calculateB_InverseMatrix</a>
<a name="l00721"></a><a class="code" href="class_radiation_cavity_analysis.html#a03d86d48b9c5d0cd54a43f34a16326b6">00721</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>* matrix_ptr)
<a name="l00722"></a>00722 {
<a name="l00723"></a>00723   this-&gt;fesystem_controller.performance_logging-&gt;setEvent
<a name="l00724"></a>00724   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateB_InverseMatrix()&quot;</span>,
<a name="l00725"></a>00725    this-&gt;performance_logging_header);
<a name="l00726"></a>00726   
<a name="l00727"></a>00727   <span class="comment">//  std::cout&lt;&lt; &quot;asked for B_inv&quot; &lt;&lt; std::endl;</span>
<a name="l00728"></a>00728   
<a name="l00729"></a>00729   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; B_inverse_matrix = *matrix_ptr;
<a name="l00730"></a>00730   
<a name="l00731"></a>00731   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();
<a name="l00732"></a>00732   <span class="keywordflow">if</span> (B_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() != n_elems || B_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a6cd62edc363882589e4d9520f2c3f566">n</a>() != n_elems)
<a name="l00733"></a>00733     B_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#a5acdf5297d21c760dfe0dda54f4d66ca" title="resize the matrix to the given dimensions">resize</a>(n_elems, n_elems);
<a name="l00734"></a>00734   B_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a7f4e4f7b27462324d6c89aa908c3cb6c">zero</a>();
<a name="l00735"></a>00735   
<a name="l00736"></a>00736   <span class="comment">// get the B_matrix and the B_inverse matrices.</span>
<a name="l00737"></a>00737   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> B_matrix(n_elems, n_elems); 
<a name="l00738"></a>00738   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> tmp_vector(n_elems), sol_vector(n_elems);
<a name="l00739"></a>00739   this-&gt;getMatrixQuantity(B_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9abe6a1b3373498e2afa348361975f9ee9">RadiationCavityAnalysis::B_MATRIX</a>);
<a name="l00740"></a>00740   B_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#adbf89f7947378034e9f5ff67898981c9" title="method to perform a final assembly of the matrix">finalAssemble</a>();
<a name="l00741"></a>00741   tmp_vector.zero();
<a name="l00742"></a>00742   
<a name="l00743"></a>00743   <span class="comment">// create a petsc mat and set its values to the B matrix.</span>
<a name="l00744"></a>00744   Mat matrix = B_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a73251b033aaa5845cc318163239eac5d" title="returns the Petsc matrix data structure">getMat</a>();
<a name="l00745"></a>00745   
<a name="l00746"></a>00746   <span class="comment">// create a PC context and create the LU factorization</span>
<a name="l00747"></a>00747   PC petsc_pc;
<a name="l00748"></a>00748   
<a name="l00749"></a>00749   PCCreate(PETSC_COMM_SELF, &amp;petsc_pc);
<a name="l00750"></a>00750   PCSetType(petsc_pc , PCLU);
<a name="l00751"></a>00751   PCFactorSetUseInPlace(petsc_pc);
<a name="l00752"></a>00752   PCSetOperators(petsc_pc, matrix, matrix, SAME_NONZERO_PATTERN);
<a name="l00753"></a>00753   PCSetUp(petsc_pc);
<a name="l00754"></a>00754   
<a name="l00755"></a>00755   Mat lu_mat;
<a name="l00756"></a>00756   MatStructure str;
<a name="l00757"></a>00757   PCGetOperators(petsc_pc, PETSC_NULL, &amp;lu_mat, &amp;str);
<a name="l00758"></a>00758   
<a name="l00759"></a>00759   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; n_elems; i++)
<a name="l00760"></a>00760     {
<a name="l00761"></a>00761       tmp_vector.set(i,1.0);
<a name="l00762"></a>00762       tmp_vector.assemble();
<a name="l00763"></a>00763       sol_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l00764"></a>00764       MatSolve(lu_mat, tmp_vector.getVec(), sol_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a805d72fe99d9faf92f7adc389fcdd349" title="returns the Petsc matrix data structure">getVec</a>());
<a name="l00765"></a>00765       tmp_vector.set(i,0.0);
<a name="l00766"></a>00766       
<a name="l00767"></a>00767       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;n_elems; j++)
<a name="l00768"></a>00768         B_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a029417d563ab83a4825b417682e9ce38">set</a>(j,i,sol_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a98c553254ecd51c3ece2b86e52cd960e">el</a>(j));
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770   
<a name="l00771"></a>00771   PCDestroy(petsc_pc);
<a name="l00772"></a>00772   
<a name="l00773"></a>00773   this-&gt;fesystem_controller.performance_logging-&gt;unsetEvent
<a name="l00774"></a>00774   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateB_InverseMatrix()&quot;</span>,
<a name="l00775"></a>00775    this-&gt;performance_logging_header);
<a name="l00776"></a>00776 }
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 
<a name="l00781"></a>00781 
<a name="l00782"></a>00782 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a4d8daf804dae432452faf1334b5ee457" title="calculates the vector of emissivities for the current temperature of the cavity">RadiationCavityAnalysis::calculateEmissivityVector</a>
<a name="l00783"></a><a class="code" href="class_radiation_cavity_analysis.html#a4d8daf804dae432452faf1334b5ee457">00783</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>* vector_ptr)
<a name="l00784"></a>00784 {
<a name="l00785"></a>00785   this-&gt;fesystem_controller.performance_logging-&gt;setEvent
<a name="l00786"></a>00786   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateEmissivityVector()&quot;</span>,
<a name="l00787"></a>00787    this-&gt;performance_logging_header);
<a name="l00788"></a>00788   
<a name="l00789"></a>00789   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; eps_vec = *vector_ptr;
<a name="l00790"></a>00790   
<a name="l00791"></a>00791   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();
<a name="l00792"></a>00792   <span class="keywordflow">if</span> (eps_vec.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>() != n_elems)
<a name="l00793"></a>00793     eps_vec.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html#a734ca8b60d564df1539ae11e9fd5f867" title="resize the matrix to the given dimensions">resize</a>(n_elems);
<a name="l00794"></a>00794   eps_vec.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l00795"></a>00795   
<a name="l00796"></a>00796   
<a name="l00797"></a>00797   <a class="code" href="class_property_1_1_property_database.html">Property::PropertyDatabase</a>&amp; property_database = 
<a name="l00798"></a>00798   *(this-&gt;fesystem_controller.property_database.get());
<a name="l00799"></a>00799   <a class="code" href="class_mesh_d_s_1_1_f_e_mesh_data.html">MeshDS::FEMeshData</a>&amp; mesh_data = *(this-&gt;radiation_cavity.getMeshData());
<a name="l00800"></a>00800   
<a name="l00801"></a>00801   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fe_elem_ID = 0,  property_ID = 0;
<a name="l00802"></a>00802   <span class="keywordtype">double</span>  factor1 = 0.0;
<a name="l00803"></a>00803   
<a name="l00804"></a>00804   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; n_elems; i++)
<a name="l00805"></a>00805     {
<a name="l00806"></a>00806       <span class="comment">// get the ID of the finite elem, get the property card for this elem</span>
<a name="l00807"></a>00807       fe_elem_ID = this-&gt;radiation_cavity.getElemFromID(i).FeElementID();
<a name="l00808"></a>00808       <span class="keyword">const</span> Elem* elem = mesh_data.<a class="code" href="class_mesh_d_s_1_1_f_e_mesh_data.html#ad0a5644dd5120fb02d602cae62a5a330">getElemFromForeignID</a>(fe_elem_ID);
<a name="l00809"></a>00809       property_ID = mesh_data.<a class="code" href="class_mesh_d_s_1_1_f_e_mesh_data.html#ae50bb83a080c0f9d30cb6a7b9458af54">getElemPropertyID</a>(elem);
<a name="l00810"></a>00810       <a class="code" href="class_elem_data_card.html">ElemDataCard</a>&amp; elem_data_card = property_database.<a class="code" href="class_property_1_1_property_database.html#a4120ff84d49bd7d1b547507759f2d27f" title="returns the element property card for this ID">getElemDataCardFromID</a>(property_ID);
<a name="l00811"></a>00811       
<a name="l00812"></a>00812       <span class="comment">// if the property is temperature dependent, then initialize the property card </span>
<a name="l00813"></a>00813       <span class="comment">// at the average temperature of the finite element to which this radiation </span>
<a name="l00814"></a>00814       <span class="comment">// element belongs</span>
<a name="l00815"></a>00815       this-&gt;initializePropertyCardAtElementTemperature(elem_data_card, i);
<a name="l00816"></a>00816       
<a name="l00817"></a>00817       elem_data_card.<a class="code" href="class_elem_data_card.html#a6668a99eca477724cd612fa8c4bd7409" title="returns value from material card">getPropertyValueFromMaterialCard</a>(<a class="code" href="class_e_m_i_s_s_i_v_i_t_y.html#a06efa255fa8f614eed83ae956748e9e6">EMISSIVITY::num</a>(), factor1);
<a name="l00818"></a>00818       <span class="keywordflow">if</span> (factor1 &gt; 1.0)
<a name="l00819"></a>00819         std::cout &lt;&lt; <span class="stringliteral">&quot;emissivity greater than 1, value : &quot;</span> &lt;&lt; factor1 &lt;&lt; std::endl;
<a name="l00820"></a>00820       
<a name="l00821"></a>00821       
<a name="l00822"></a>00822       eps_vec.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a9fe9c425efb52cefc5b552cdf3295328">set</a>(i, factor1);
<a name="l00823"></a>00823       
<a name="l00824"></a>00824       this-&gt;clearPropertyCardInitialization(elem_data_card);
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826   
<a name="l00827"></a>00827   
<a name="l00828"></a>00828   this-&gt;fesystem_controller.performance_logging-&gt;unsetEvent
<a name="l00829"></a>00829   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateEmissivityVector()&quot;</span>,
<a name="l00830"></a>00830    this-&gt;performance_logging_header);
<a name="l00831"></a>00831   
<a name="l00832"></a>00832 }
<a name="l00833"></a>00833 
<a name="l00834"></a>00834 
<a name="l00835"></a>00835 
<a name="l00836"></a>00836 <span class="keywordtype">void</span> 
<a name="l00837"></a>00837 <a class="code" href="class_radiation_cavity_analysis.html#a9b773a18ce7531728bf76b2b6905723b">RadiationCavityAnalysis::calculateABInvFactorMatrix</a>
<a name="l00838"></a><a class="code" href="class_radiation_cavity_analysis.html#a9b773a18ce7531728bf76b2b6905723b">00838</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>* matrix_ptr)
<a name="l00839"></a>00839 {
<a name="l00840"></a>00840   this-&gt;fesystem_controller.performance_logging-&gt;setEvent
<a name="l00841"></a>00841   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateABInvFactorMatrix()&quot;</span>,
<a name="l00842"></a>00842    this-&gt;performance_logging_header);
<a name="l00843"></a>00843   
<a name="l00844"></a>00844   <span class="comment">// this is now being limited only to cases with temperature &quot;dependent&quot; </span>
<a name="l00845"></a>00845   <span class="comment">// material properties</span>
<a name="l00846"></a>00846   Assert(this-&gt;thermal_discipline.checkPropertyDependenceOnTemperature(),
<a name="l00847"></a>00847          ExcInternalError());
<a name="l00848"></a>00848   
<a name="l00849"></a>00849   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; factor_matrix = *matrix_ptr;
<a name="l00850"></a>00850   
<a name="l00851"></a>00851   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();
<a name="l00852"></a>00852   factor_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a7f4e4f7b27462324d6c89aa908c3cb6c">zero</a>();
<a name="l00853"></a>00853   
<a name="l00854"></a>00854   <span class="keywordtype">bool</span> recalculate = <span class="keyword">true</span>;
<a name="l00855"></a>00855   <span class="keywordtype">bool</span> store_base = <span class="keyword">false</span>;
<a name="l00856"></a>00856   
<a name="l00857"></a>00857   <span class="keywordflow">if</span> (!this-&gt;thermal_discipline.checkPropertyDependenceOnTemperature())
<a name="l00858"></a>00858     {
<a name="l00859"></a>00859       recalculate = <span class="keyword">true</span>;
<a name="l00860"></a>00860       store_base = <span class="keyword">false</span>;
<a name="l00861"></a>00861     }
<a name="l00862"></a>00862   <span class="keywordflow">else</span>
<a name="l00863"></a>00863     {
<a name="l00864"></a>00864       <span class="keywordflow">if</span>(!this-&gt;radiation_cavity.ifApproximateABInvFactor())
<a name="l00865"></a>00865         {
<a name="l00866"></a>00866           recalculate = <span class="keyword">true</span>;
<a name="l00867"></a>00867           store_base = <span class="keyword">false</span>;
<a name="l00868"></a>00868         }
<a name="l00869"></a>00869       <span class="keywordflow">else</span>
<a name="l00870"></a>00870         {
<a name="l00871"></a>00871           <span class="keywordflow">if</span> (fmod(1.0*this-&gt;n_ABinv_calculations, 
<a name="l00872"></a>00872                    1.0*this-&gt;radiation_cavity.getNItertionsToRecalculateABInv()) == 0.0)
<a name="l00873"></a>00873             {
<a name="l00874"></a>00874               recalculate = <span class="keyword">true</span>;
<a name="l00875"></a>00875               store_base = <span class="keyword">true</span>;
<a name="l00876"></a>00876             }
<a name="l00877"></a>00877           <span class="keywordflow">else</span> 
<a name="l00878"></a>00878             {
<a name="l00879"></a>00879               
<a name="l00880"></a>00880               recalculate = <span class="keyword">false</span>;
<a name="l00881"></a>00881               store_base = <span class="keyword">false</span>;
<a name="l00882"></a>00882             }
<a name="l00883"></a>00883         }
<a name="l00884"></a>00884     }
<a name="l00885"></a>00885   
<a name="l00886"></a>00886   <span class="comment">//  std::cout &lt;&lt; &quot;if approx  &quot; &lt;&lt; this-&gt;radiation_cavity.ifApproximateABInvFactor() &lt;&lt; std::endl;</span>
<a name="l00887"></a>00887   <span class="comment">//  std::cout &lt;&lt; &quot;n_AB_inv,n_iter_to_recalc = &quot; &lt;&lt; this-&gt;n_ABinv_calculations &lt;&lt; &quot; &quot; </span>
<a name="l00888"></a>00888   <span class="comment">//    &lt;&lt; this-&gt;radiation_cavity.getNItertionsToRecalculateABInv() &lt;&lt; std::endl;</span>
<a name="l00889"></a>00889   <span class="comment">//  std::cout &lt;&lt; &quot;fmod =&quot; &lt;&lt; fmod(1.0*this-&gt;n_ABinv_calculations, </span>
<a name="l00890"></a>00890   <span class="comment">//                    1.0*this-&gt;radiation_cavity.getNItertionsToRecalculateABInv()) &lt;&lt; std::endl;</span>
<a name="l00891"></a>00891   
<a name="l00892"></a>00892   <span class="keywordflow">if</span> (recalculate)
<a name="l00893"></a>00893     {
<a name="l00894"></a>00894       <span class="comment">// simply calculate</span>
<a name="l00895"></a>00895       this-&gt;getMatrixQuantity(factor_matrix, 
<a name="l00896"></a>00896                               <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a82a5786d2a5fc2125c69c3b0c4b25795">RadiationCavityAnalysis::B_INVERSE_MATRIX</a>);
<a name="l00897"></a>00897       <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> matrix1(n_elems, n_elems);
<a name="l00898"></a>00898       
<a name="l00899"></a>00899       this-&gt;getMatrixQuantity(matrix1, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaebaf5b8a62e34552ead17659e9d0415">RadiationCavityAnalysis::A_MATRIX</a>);
<a name="l00900"></a>00900       
<a name="l00901"></a>00901       factor_matrix.leftMultiply(matrix1);
<a name="l00902"></a>00902       
<a name="l00903"></a>00903       std::cout&lt;&lt; <span class="stringliteral">&quot;recalculating AB_inv&quot;</span> &lt;&lt; std::endl;
<a name="l00904"></a>00904       
<a name="l00905"></a>00905       <span class="keywordflow">if</span> (store_base)
<a name="l00906"></a>00906         {
<a name="l00907"></a>00907           std::string name;
<a name="l00908"></a>00908           std::ostringstream cavity_id;
<a name="l00909"></a>00909           cavity_id &lt;&lt; this-&gt;radiation_cavity.getCavityID();
<a name="l00910"></a>00910           
<a name="l00911"></a>00911           name.clear(); 
<a name="l00912"></a>00912           name = <span class="stringliteral">&quot;BaseEpsilonVector&quot;</span>;
<a name="l00913"></a>00913           name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l00914"></a>00914           name += cavity_id.str();
<a name="l00915"></a>00915           
<a name="l00916"></a>00916           <span class="comment">// calculate the epsilon vector and store it</span>
<a name="l00917"></a>00917           <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> vec1(n_elems);
<a name="l00918"></a>00918           this-&gt;calculateEmissivityVector(&amp;vec1);
<a name="l00919"></a>00919           <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a> time_independent_data_info;
<a name="l00920"></a>00920           time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#ac1115d95573153291185f76a1540f0e1" title="sets the discipline enum ID">setDisciplineEnumID</a>(Discipline::RADIATION_DISCIPLINE::num());
<a name="l00921"></a>00921           time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a700ae1ec3358b497305c2099fbf1cfea" title="sets the load case value, and also sets to true the boolean value of if_load_case_dependent">setLoadCase</a>(this-&gt;thermal_discipline.getAnalysisDriver().
<a name="l00922"></a>00922                                                  getCurrentLoadCase());
<a name="l00923"></a>00923           time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a117399f629d87ea1b646333d91dee39f" title="sets the name of the quantity">setName</a>(name);
<a name="l00924"></a>00924           
<a name="l00925"></a>00925           this-&gt;fesystem_controller.global_data_storage-&gt;storeVector(time_independent_data_info,
<a name="l00926"></a>00926                                                                      vec1);
<a name="l00927"></a>00927           
<a name="l00928"></a>00928           <span class="comment">// create a name for storing the matrix</span>
<a name="l00929"></a>00929           std::ostringstream num;
<a name="l00930"></a>00930           name.clear();
<a name="l00931"></a>00931           name = <span class="stringliteral">&quot;BaseABInvMatrix&quot;</span>;
<a name="l00932"></a>00932           name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l00933"></a>00933           name += cavity_id.str();
<a name="l00934"></a>00934           
<a name="l00935"></a>00935           time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#ab5cbefc863791bda1b4962a22598e9e0" title="clears the data structures of this object">clear</a>();
<a name="l00936"></a>00936           time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#ac1115d95573153291185f76a1540f0e1" title="sets the discipline enum ID">setDisciplineEnumID</a>(Discipline::RADIATION_DISCIPLINE::num());
<a name="l00937"></a>00937           time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a700ae1ec3358b497305c2099fbf1cfea" title="sets the load case value, and also sets to true the boolean value of if_load_case_dependent">setLoadCase</a>(this-&gt;thermal_discipline.getAnalysisDriver().
<a name="l00938"></a>00938                                                  getCurrentLoadCase());
<a name="l00939"></a>00939           time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a117399f629d87ea1b646333d91dee39f" title="sets the name of the quantity">setName</a>(name);
<a name="l00940"></a>00940           
<a name="l00941"></a>00941           this-&gt;fesystem_controller.global_data_storage-&gt;storeMatrix(time_independent_data_info, 
<a name="l00942"></a>00942                                                                      factor_matrix);
<a name="l00943"></a>00943         }
<a name="l00944"></a>00944     }
<a name="l00945"></a>00945   <span class="keywordflow">else</span>
<a name="l00946"></a>00946     {
<a name="l00947"></a>00947       std::cout&lt;&lt; <span class="stringliteral">&quot;returning base AB_inv&quot;</span> &lt;&lt; std::endl;
<a name="l00948"></a>00948       
<a name="l00949"></a>00949       <span class="comment">// create a name for storing the matrix</span>
<a name="l00950"></a>00950       std::string name;
<a name="l00951"></a>00951       std::ostringstream cavity_id;
<a name="l00952"></a>00952       cavity_id &lt;&lt; this-&gt;radiation_cavity.getCavityID();
<a name="l00953"></a>00953       std::ostringstream num;
<a name="l00954"></a>00954       name.clear();
<a name="l00955"></a>00955       name = <span class="stringliteral">&quot;BaseABInvMatrix&quot;</span>;
<a name="l00956"></a>00956       name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l00957"></a>00957       name += cavity_id.str();
<a name="l00958"></a>00958       
<a name="l00959"></a>00959       <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a> time_independent_data_info;
<a name="l00960"></a>00960       time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#ab5cbefc863791bda1b4962a22598e9e0" title="clears the data structures of this object">clear</a>();
<a name="l00961"></a>00961       time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#ac1115d95573153291185f76a1540f0e1" title="sets the discipline enum ID">setDisciplineEnumID</a>(Discipline::RADIATION_DISCIPLINE::num());
<a name="l00962"></a>00962       time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a700ae1ec3358b497305c2099fbf1cfea" title="sets the load case value, and also sets to true the boolean value of if_load_case_dependent">setLoadCase</a>(this-&gt;thermal_discipline.getAnalysisDriver().
<a name="l00963"></a>00963                                              getCurrentLoadCase());
<a name="l00964"></a>00964       time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a117399f629d87ea1b646333d91dee39f" title="sets the name of the quantity">setName</a>(name);
<a name="l00965"></a>00965       
<a name="l00966"></a>00966       this-&gt;fesystem_controller.global_data_storage-&gt;fillMatrix(time_independent_data_info, 
<a name="l00967"></a>00967                                                                 factor_matrix);
<a name="l00968"></a>00968     }
<a name="l00969"></a>00969 
<a name="l00970"></a>00970   <span class="comment">// now increment the counter</span>
<a name="l00971"></a>00971   this-&gt;n_ABinv_calculations++;
<a name="l00972"></a>00972   
<a name="l00973"></a>00973   this-&gt;fesystem_controller.performance_logging-&gt;unsetEvent
<a name="l00974"></a>00974   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateABInvFactorMatrix()&quot;</span>,
<a name="l00975"></a>00975    this-&gt;performance_logging_header);
<a name="l00976"></a>00976   
<a name="l00977"></a>00977 }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979 
<a name="l00980"></a>00980 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a84a9916a1b0228f22ffe72f5b035396b">RadiationCavityAnalysis::getBaseEpsilonVector</a>
<a name="l00981"></a><a class="code" href="class_radiation_cavity_analysis.html#a84a9916a1b0228f22ffe72f5b035396b">00981</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; vec)
<a name="l00982"></a>00982 {
<a name="l00983"></a>00983   std::string name;
<a name="l00984"></a>00984   std::ostringstream cavity_id;
<a name="l00985"></a>00985   cavity_id &lt;&lt; this-&gt;radiation_cavity.getCavityID();
<a name="l00986"></a>00986   
<a name="l00987"></a>00987   name.clear(); 
<a name="l00988"></a>00988   name = <span class="stringliteral">&quot;BaseEpsilonVector&quot;</span>;
<a name="l00989"></a>00989   name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l00990"></a>00990   name += cavity_id.str();
<a name="l00991"></a>00991   
<a name="l00992"></a>00992   <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a> time_independent_data_info;
<a name="l00993"></a>00993   time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#ac1115d95573153291185f76a1540f0e1" title="sets the discipline enum ID">setDisciplineEnumID</a>(Discipline::RADIATION_DISCIPLINE::num());
<a name="l00994"></a>00994   time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a700ae1ec3358b497305c2099fbf1cfea" title="sets the load case value, and also sets to true the boolean value of if_load_case_dependent">setLoadCase</a>(this-&gt;thermal_discipline.getAnalysisDriver().
<a name="l00995"></a>00995                                          getCurrentLoadCase());
<a name="l00996"></a>00996   time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a117399f629d87ea1b646333d91dee39f" title="sets the name of the quantity">setName</a>(name);
<a name="l00997"></a>00997   
<a name="l00998"></a>00998   this-&gt;fesystem_controller.global_data_storage-&gt;fillVector(time_independent_data_info,
<a name="l00999"></a>00999                                                             vec);  
<a name="l01000"></a>01000 }
<a name="l01001"></a>01001 
<a name="l01002"></a>01002 
<a name="l01003"></a>01003 
<a name="l01004"></a>01004 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a2efa1a2121b55ef46dd5d57fca123d7c">RadiationCavityAnalysis::calculateFactorMatrix</a>
<a name="l01005"></a><a class="code" href="class_radiation_cavity_analysis.html#a2efa1a2121b55ef46dd5d57fca123d7c">01005</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>* matrix_ptr)
<a name="l01006"></a>01006 {
<a name="l01007"></a>01007   this-&gt;fesystem_controller.performance_logging-&gt;setEvent
<a name="l01008"></a>01008   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateFactorMatrix()&quot;</span>,
<a name="l01009"></a>01009    this-&gt;performance_logging_header);
<a name="l01010"></a>01010   
<a name="l01011"></a>01011   <span class="comment">// this is now being limited only to cases with temperature &quot;independent&quot; </span>
<a name="l01012"></a>01012   <span class="comment">// material properties</span>
<a name="l01013"></a>01013   Assert(!this-&gt;thermal_discipline.checkPropertyDependenceOnTemperature(),
<a name="l01014"></a>01014          ExcInternalError());
<a name="l01015"></a>01015   
<a name="l01016"></a>01016   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; factor_matrix = *matrix_ptr;
<a name="l01017"></a>01017   
<a name="l01018"></a>01018   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();
<a name="l01019"></a>01019   factor_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a7f4e4f7b27462324d6c89aa908c3cb6c">zero</a>();
<a name="l01020"></a>01020   
<a name="l01021"></a>01021   <span class="comment">// get references to the A and G matrices</span>
<a name="l01022"></a>01022   <span class="comment">// the factor matrix will be calculated using the expression </span>
<a name="l01023"></a>01023   <span class="comment">// factor = [G]^T  [A] [B]^(-1)</span>
<a name="l01024"></a>01024   this-&gt;getMatrixQuantity(factor_matrix, 
<a name="l01025"></a>01025                           <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a82a5786d2a5fc2125c69c3b0c4b25795">RadiationCavityAnalysis::B_INVERSE_MATRIX</a>);
<a name="l01026"></a>01026   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> matrix1(n_elems, n_elems);
<a name="l01027"></a>01027   
<a name="l01028"></a>01028   this-&gt;getMatrixQuantity(matrix1, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaebaf5b8a62e34552ead17659e9d0415">RadiationCavityAnalysis::A_MATRIX</a>);
<a name="l01029"></a>01029   
<a name="l01030"></a>01030   factor_matrix.leftMultiply(matrix1);
<a name="l01031"></a>01031   
<a name="l01032"></a>01032   this-&gt;getMatrixQuantity(matrix1, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaddba04b27f5a8c99ae4edac90bdf939">RadiationCavityAnalysis::G_MATRIX</a>);
<a name="l01033"></a>01033   
<a name="l01034"></a>01034   factor_matrix.leftMultiplyTranspose(matrix1);
<a name="l01035"></a>01035   
<a name="l01036"></a>01036   this-&gt;fesystem_controller.performance_logging-&gt;unsetEvent
<a name="l01037"></a>01037   (<span class="stringliteral">&quot;RadiationCavityAnalysis::calculateFactorMatrix()&quot;</span>,
<a name="l01038"></a>01038    this-&gt;performance_logging_header);
<a name="l01039"></a>01039   
<a name="l01040"></a>01040 }
<a name="l01041"></a>01041 
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 
<a name="l01044"></a>01044 
<a name="l01045"></a><a class="code" href="class_radiation_cavity_analysis.html#a38932efef014877857e9cd643b69bf73">01045</a> <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a38932efef014877857e9cd643b69bf73">RadiationCavityAnalysis::getFENodalDofIDs</a>(std::vector&lt;unsigned int&gt;&amp; vector)
<a name="l01046"></a>01046 {
<a name="l01047"></a>01047   <span class="comment">// get the vector of FE nodes from the cavity</span>
<a name="l01048"></a>01048   <span class="keyword">const</span> std::vector&lt;Node*&gt;&amp; node_vector = 
<a name="l01049"></a>01049   this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1f138bfc5a3a6de6219d5893bfb79ec0" title="cavity for this analysis">radiation_cavity</a>.<a class="code" href="class_radiation_cavity.html#a8018aadd0171d514477ada7314cbbc1b">getFENodes</a>();
<a name="l01050"></a>01050   
<a name="l01051"></a>01051   std::vector&lt;Node*&gt;::const_iterator it, end;
<a name="l01052"></a>01052   it = node_vector.begin();
<a name="l01053"></a>01053   end = node_vector.end();
<a name="l01054"></a>01054   
<a name="l01055"></a>01055   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof_ID = 0;
<a name="l01056"></a>01056   
<a name="l01057"></a>01057   <span class="comment">// clear the vector, and then insert the nodes in it</span>
<a name="l01058"></a>01058   vector.clear();
<a name="l01059"></a>01059   <span class="keywordflow">for</span> (; it != end; it++)
<a name="l01060"></a>01060     {
<a name="l01061"></a>01061       dof_ID = (*it)-&gt;dof_number(0,0,0);
<a name="l01062"></a>01062       vector.push_back(dof_ID);
<a name="l01063"></a>01063     }
<a name="l01064"></a>01064 }
<a name="l01065"></a>01065 
<a name="l01066"></a>01066 
<a name="l01067"></a>01067 
<a name="l01068"></a>01068 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#aef377bb5ffe6811cf1c27448ddfc0365">RadiationCavityAnalysis::calculateRadElemTempVector</a>
<a name="l01069"></a><a class="code" href="class_radiation_cavity_analysis.html#aef377bb5ffe6811cf1c27448ddfc0365">01069</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>* rad_temp_vector_ptr,
<a name="l01070"></a>01070  <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; nodal_temp_vector,
<a name="l01071"></a>01071  <span class="keyword">const</span> <span class="keywordtype">bool</span> reduce_power_by_four,
<a name="l01072"></a>01072  <span class="keyword">const</span> <span class="keywordtype">bool</span> sensitivity)
<a name="l01073"></a>01073 {
<a name="l01074"></a>01074   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; rad_temp_vector = *rad_temp_vector_ptr;
<a name="l01075"></a>01075   
<a name="l01076"></a>01076   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();
<a name="l01077"></a>01077   <span class="keywordflow">if</span> (rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>() != n_elems)
<a name="l01078"></a>01078     rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html#a734ca8b60d564df1539ae11e9fd5f867" title="resize the matrix to the given dimensions">resize</a>(n_elems);
<a name="l01079"></a>01079   rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01080"></a>01080   
<a name="l01081"></a>01081   <span class="comment">// get the value of absolute temperature </span>
<a name="l01082"></a>01082   <span class="keyword">const</span> <span class="keywordtype">double</span> temp_abs = 
<a name="l01083"></a>01083   this-&gt;fesystem_controller.analysis_case-&gt;getRealParameter(<span class="stringliteral">&quot;ABSOLUTE_TEMP&quot;</span>);
<a name="l01084"></a>01084   
<a name="l01085"></a>01085   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> DV_ID = 0;
<a name="l01086"></a>01086   <span class="keywordtype">double</span> perturbation = 0.0;
<a name="l01087"></a>01087   <span class="keywordflow">if</span> (sensitivity)
<a name="l01088"></a>01088     {
<a name="l01089"></a>01089       <span class="comment">// for a Property DV, the sensitivity of this quantity is zero</span>
<a name="l01090"></a>01090       <span class="keyword">const</span> <a class="code" href="class_design_data_1_1_design_parameter.html" title="this class forms the base class for all design parameters.">DesignData::DesignParameter</a>&amp; dparam = 
<a name="l01091"></a>01091       this-&gt;thermal_discipline.getAnalysisDriver().getCurrentDesignParameter();
<a name="l01092"></a>01092       <span class="keywordflow">if</span> (dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#ada780fbd596a879cb3d57cb44376a702">getParameterTypeEnumID</a>() == DesignData::PROPERTY_PARAMETER::num())
<a name="l01093"></a>01093         <span class="keywordflow">return</span>;
<a name="l01094"></a>01094       <span class="keywordflow">else</span> 
<a name="l01095"></a>01095         {
<a name="l01096"></a>01096           DV_ID = dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#ab0cb6d6c10206acebbc06d2be204c2e7">getID</a>();
<a name="l01097"></a>01097           perturbation = dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#a0eb8202d84916cb7562fa2429e3bf7f8">getPerturbationStepSize</a>();
<a name="l01098"></a>01098         }
<a name="l01099"></a>01099     }
<a name="l01100"></a>01100   
<a name="l01101"></a>01101   <span class="comment">// first calculate the temperatures for the radiation elements</span>
<a name="l01102"></a>01102   <span class="comment">// this is done using the expression</span>
<a name="l01103"></a>01103   <span class="comment">// T_rad^4 = 1/A * int_A (N^T Temp)^4 dA</span>
<a name="l01104"></a>01104   
<a name="l01105"></a>01105   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> elem_dof = 0;
<a name="l01106"></a>01106   
<a name="l01107"></a>01107   std::vector&lt;Point&gt; points;
<a name="l01108"></a>01108   <span class="keywordtype">double</span> qp_value = 0.0, value = 0.0;
<a name="l01109"></a>01109   std::vector&lt;unsigned int&gt; fe_node_ID_vec;
<a name="l01110"></a>01110   
<a name="l01111"></a>01111   std::auto_ptr&lt;QBase&gt; quadrature(<span class="keyword">new</span> QGauss(2,FIFTH));
<a name="l01112"></a>01112   std::auto_ptr&lt;FEBase&gt; fe_rad(<span class="keyword">new</span> FE&lt;2, LAGRANGE&gt;(FEType()));
<a name="l01113"></a>01113   std::auto_ptr&lt;FEBase&gt; global_fe(<span class="keyword">new</span> FE&lt;2,LAGRANGE&gt;(FEType()));
<a name="l01114"></a>01114   
<a name="l01115"></a>01115   fe_rad-&gt;attach_quadrature_rule(quadrature.get());
<a name="l01116"></a>01116   
<a name="l01117"></a>01117   <a class="code" href="_radiation_cavity_8h.html#a95a54ed90e810eea01d0a99c2d9fdfe4">RadiationElemConstIterator</a> elem_it, elem_end;
<a name="l01118"></a>01118   elem_it = this-&gt;radiation_cavity.getElemBeginIterator(DV_ID);
<a name="l01119"></a>01119   elem_end = this-&gt;radiation_cavity.getElemEndIterator(DV_ID);
<a name="l01120"></a>01120   
<a name="l01121"></a>01121   
<a name="l01122"></a>01122   <span class="keywordflow">for</span> (; elem_it != elem_end; elem_it++)
<a name="l01123"></a>01123     {
<a name="l01124"></a>01124       elem_dof = (*elem_it)-&gt;ID();
<a name="l01125"></a>01125       
<a name="l01126"></a>01126       fe_node_ID_vec.clear();
<a name="l01127"></a>01127       
<a name="l01128"></a>01128       <span class="comment">// get the vector of internal node IDs</span>
<a name="l01129"></a>01129       this-&gt;radiation_cavity.getInternalNodeIDForRadElem
<a name="l01130"></a>01130       (elem_dof, fe_node_ID_vec);
<a name="l01131"></a>01131       
<a name="l01132"></a>01132       <span class="comment">// get the local elem and the nodes in the local coordinates</span>
<a name="l01133"></a>01133       Elem* local_rad_elem = 
<a name="l01134"></a>01134       (*elem_it)-&gt;getLocalRadiationGeometricElem();
<a name="l01135"></a>01135       <span class="keyword">const</span> std::vector&lt;Node*&gt; local_nodes = 
<a name="l01136"></a>01136       (*elem_it)-&gt;getLocalCoordinateNodes();
<a name="l01137"></a>01137       
<a name="l01138"></a>01138       fe_rad-&gt;reinit(local_rad_elem);
<a name="l01139"></a>01139       
<a name="l01140"></a>01140       <span class="comment">// now obtain the value of the shape function for </span>
<a name="l01141"></a>01141       <span class="comment">// the associated FE</span>
<a name="l01142"></a>01142       <span class="keyword">const</span> std::vector&lt;std::vector&lt;Real&gt; &gt;&amp; phi_rad = fe_rad-&gt;get_phi();
<a name="l01143"></a>01143       <span class="keyword">const</span> std::vector&lt;Real&gt;&amp; JxW_rad = fe_rad-&gt;get_JxW();
<a name="l01144"></a>01144       
<a name="l01145"></a>01145       points.clear();
<a name="l01146"></a>01146       
<a name="l01147"></a>01147       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qp = 0; qp &lt; phi_rad[0].size(); qp++)
<a name="l01148"></a>01148         {
<a name="l01149"></a>01149           Point pt;
<a name="l01150"></a>01150           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; phi_rad.size(); i++)
<a name="l01151"></a>01151             {
<a name="l01152"></a>01152               Node&amp; node = *(local_nodes[i]);
<a name="l01153"></a>01153               pt(0) += phi_rad[i][qp] * node(0);
<a name="l01154"></a>01154               pt(1) += phi_rad[i][qp] * node(1);
<a name="l01155"></a>01155             }
<a name="l01156"></a>01156           points.push_back(pt);
<a name="l01157"></a>01157         }
<a name="l01158"></a>01158       
<a name="l01159"></a>01159       <span class="comment">// next, get the values of the shape function for the global </span>
<a name="l01160"></a>01160       <span class="comment">// FE at the quad points for the local rad elem</span>
<a name="l01161"></a>01161       global_fe-&gt;reinit(local_rad_elem, &amp;points);
<a name="l01162"></a>01162       <span class="keyword">const</span> std::vector&lt;std::vector&lt;Real&gt; &gt;&amp; phi_global = global_fe-&gt;get_phi();
<a name="l01163"></a>01163       
<a name="l01164"></a>01164       <span class="comment">// now, calculate the G_vector</span>
<a name="l01165"></a>01165       value = 0.0;
<a name="l01166"></a>01166       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qp=0; qp &lt; JxW_rad.size(); qp++)
<a name="l01167"></a>01167         {
<a name="l01168"></a>01168           qp_value = 0.0;
<a name="l01169"></a>01169           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; phi_global.size(); i++)
<a name="l01170"></a>01170             qp_value += phi_global[i][qp] * 
<a name="l01171"></a>01171             (nodal_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a98c553254ecd51c3ece2b86e52cd960e">el</a>(fe_node_ID_vec[i]) + temp_abs);
<a name="l01172"></a>01172           
<a name="l01173"></a>01173           value += pow(qp_value,4) * JxW_rad[qp];
<a name="l01174"></a>01174         }
<a name="l01175"></a>01175       
<a name="l01176"></a>01176       rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a9fe9c425efb52cefc5b552cdf3295328">set</a>(elem_dof, value / (*elem_it)-&gt;getArea());
<a name="l01177"></a>01177     }
<a name="l01178"></a>01178   
<a name="l01179"></a>01179   <span class="keywordflow">if</span> (reduce_power_by_four)
<a name="l01180"></a>01180     rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a78a2fdc3d899fdde5c43a8d6133ccd83" title="raises each element of the vector by the given power">power</a>(0.25);
<a name="l01181"></a>01181   
<a name="l01182"></a>01182   <span class="keywordflow">if</span> (sensitivity) <span class="comment">// shape sensitivity is calculated using finite differences</span>
<a name="l01183"></a>01183     {
<a name="l01184"></a>01184       <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> rad_temp_vector_base(n_elems);
<a name="l01185"></a>01185       this-&gt;calculateRadElemTempVector(&amp;rad_temp_vector_base, 
<a name="l01186"></a>01186                                        nodal_temp_vector,
<a name="l01187"></a>01187                                        reduce_power_by_four,
<a name="l01188"></a>01188                                        <span class="keyword">false</span>);
<a name="l01189"></a>01189       rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a8d29fa33d3f981456e6bfa26a1fac17f">add</a>(-1.0, rad_temp_vector_base);
<a name="l01190"></a>01190       rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a67cddf9b9ceb614362da1519af23b3d3">scale</a>(1.0/perturbation);
<a name="l01191"></a>01191     }
<a name="l01192"></a>01192 }
<a name="l01193"></a>01193 
<a name="l01194"></a>01194 
<a name="l01195"></a>01195 
<a name="l01196"></a>01196 
<a name="l01197"></a>01197 
<a name="l01198"></a>01198 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a13405f2f110d5d759287f93310a92efd">RadiationCavityAnalysis::getFENodalLoadVector</a>
<a name="l01199"></a><a class="code" href="class_radiation_cavity_analysis.html#a13405f2f110d5d759287f93310a92efd">01199</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; nodal_temp_vector,
<a name="l01200"></a>01200  <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; nodal_load_vector)
<a name="l01201"></a>01201 {
<a name="l01202"></a>01202   this-&gt;fesystem_controller.performance_logging-&gt;setEvent
<a name="l01203"></a>01203   (<span class="stringliteral">&quot;RadiationCavityAnalysis::getFENodalLoadVector()&quot;</span>,
<a name="l01204"></a>01204    this-&gt;performance_logging_header);
<a name="l01205"></a>01205  
<a name="l01206"></a>01206   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();  
<a name="l01207"></a>01207   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_nodes = this-&gt;radiation_cavity.getFENodes().size();
<a name="l01208"></a>01208   
<a name="l01209"></a>01209   Assert(nodal_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>() == n_nodes, ExcInternalError());
<a name="l01210"></a>01210   Assert(nodal_load_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>() == n_nodes, ExcInternalError());
<a name="l01211"></a>01211   
<a name="l01212"></a>01212   <span class="comment">// first set the pointer to the nodal load vector</span>
<a name="l01213"></a>01213   this-&gt;fe_nodal_temp_vector = &amp;(nodal_temp_vector);
<a name="l01214"></a>01214   
<a name="l01215"></a>01215   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> rad_temp_vector(n_elems);
<a name="l01216"></a>01216   rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01217"></a>01217   this-&gt;calculateRadElemTempVector(&amp;rad_temp_vector, nodal_temp_vector,
<a name="l01218"></a>01218                                    <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l01219"></a>01219   
<a name="l01220"></a>01220   <span class="comment">// get the factor_matrix, multiply to get the nodal load vector and return </span>
<a name="l01221"></a>01221   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> factor_matrix(n_elems, n_nodes); 
<a name="l01222"></a>01222   nodal_load_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01223"></a>01223   
<a name="l01224"></a>01224   <span class="keywordflow">if</span> (!this-&gt;thermal_discipline.checkPropertyDependenceOnTemperature())
<a name="l01225"></a>01225     {
<a name="l01226"></a>01226       this-&gt;getMatrixQuantity(factor_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a706dd25ad60743b308702c7c244fc998">RadiationCavityAnalysis::FACTOR_MATRIX</a>);
<a name="l01227"></a>01227       factor_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a89fe3f3f5841376aa58fe144278c707c">rightMultiplyVector</a>(rad_temp_vector,
<a name="l01228"></a>01228                                         nodal_load_vector);
<a name="l01229"></a>01229     }
<a name="l01230"></a>01230   <span class="keywordflow">else</span>
<a name="l01231"></a>01231     {
<a name="l01232"></a>01232       this-&gt;getMatrixQuantity(factor_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaddba04b27f5a8c99ae4edac90bdf939">RadiationCavityAnalysis::G_MATRIX</a>);
<a name="l01233"></a>01233       <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> mat1(rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>(),
<a name="l01234"></a>01234                                                          rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>());
<a name="l01235"></a>01235       
<a name="l01236"></a>01236       this-&gt;getMatrixQuantity(mat1, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ada425f7476e4534bd9684e2d4fab9ce0">RadiationCavityAnalysis::AB_INV_MATRIX</a>);
<a name="l01237"></a>01237       <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> 
<a name="l01238"></a>01238       vector1(n_elems), vector2(n_elems), vector3(n_elems);
<a name="l01239"></a>01239       mat1.rightMultiplyVector(rad_temp_vector, vector1);
<a name="l01240"></a>01240       
<a name="l01241"></a>01241       <span class="keywordflow">if</span>(this-&gt;radiation_cavity.ifApproximateABInvFactor())
<a name="l01242"></a>01242         {
<a name="l01243"></a>01243           this-&gt;getTemperatureDependentFluxCorrectionVector(vector2, mat1);
<a name="l01244"></a>01244           vector2.pointwiseMultiply(vector1);
<a name="l01245"></a>01245           mat1.rightMultiplyVector(vector2, vector3);
<a name="l01246"></a>01246           vector1.add(1.0, vector3);
<a name="l01247"></a>01247         }
<a name="l01248"></a>01248 
<a name="l01249"></a>01249       factor_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#adee2257f7d4a1e65682a6ad595036d02">leftMultiplyVector</a>(vector1, nodal_load_vector);
<a name="l01250"></a>01250     }
<a name="l01251"></a>01251   
<a name="l01252"></a>01252   
<a name="l01253"></a>01253   <span class="comment">// now clear the pointer</span>
<a name="l01254"></a>01254   this-&gt;fe_nodal_temp_vector = NULL;
<a name="l01255"></a>01255   
<a name="l01256"></a>01256   this-&gt;fesystem_controller.performance_logging-&gt;unsetEvent
<a name="l01257"></a>01257   (<span class="stringliteral">&quot;RadiationCavityAnalysis::getFENodalLoadVector()&quot;</span>,
<a name="l01258"></a>01258    this-&gt;performance_logging_header);
<a name="l01259"></a>01259 }
<a name="l01260"></a>01260 
<a name="l01261"></a>01261 
<a name="l01262"></a>01262 
<a name="l01263"></a>01263 
<a name="l01264"></a>01264 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#a61471a6ba45557144aabdef1ddc94562">RadiationCavityAnalysis::getFENodalLoadVectorSensitivity</a>
<a name="l01265"></a><a class="code" href="class_radiation_cavity_analysis.html#a61471a6ba45557144aabdef1ddc94562">01265</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; nodal_temp_vector,
<a name="l01266"></a>01266  <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; nodal_load_vector_sens)
<a name="l01267"></a>01267 {
<a name="l01268"></a>01268   this-&gt;fesystem_controller.performance_logging-&gt;setEvent
<a name="l01269"></a>01269   (<span class="stringliteral">&quot;RadiationCavityAnalysis::getFENodalLoadVectorSensitivity()&quot;</span>,
<a name="l01270"></a>01270    this-&gt;performance_logging_header);
<a name="l01271"></a>01271   
<a name="l01272"></a>01272   
<a name="l01273"></a>01273   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();  
<a name="l01274"></a>01274   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_nodes = this-&gt;radiation_cavity.getFENodes().size();
<a name="l01275"></a>01275   
<a name="l01276"></a>01276   Assert(nodal_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>() == n_nodes, ExcInternalError());
<a name="l01277"></a>01277   Assert(nodal_load_vector_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>() == n_nodes, ExcInternalError());
<a name="l01278"></a>01278   
<a name="l01279"></a>01279   <span class="comment">// first set the pointer to the nodal load vector</span>
<a name="l01280"></a>01280   this-&gt;fe_nodal_temp_vector = &amp;(nodal_temp_vector);
<a name="l01281"></a>01281   nodal_load_vector_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01282"></a>01282   
<a name="l01283"></a>01283   <span class="comment">// calculate T_rad and d(T_rad)/d(Alpha)</span>
<a name="l01284"></a>01284   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> rad_temp_vector(n_elems);
<a name="l01285"></a>01285   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> rad_temp_vector_sens(n_elems);
<a name="l01286"></a>01286   
<a name="l01287"></a>01287   rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01288"></a>01288   rad_temp_vector_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01289"></a>01289   
<a name="l01290"></a>01290   this-&gt;calculateRadElemTempVector(&amp;rad_temp_vector,
<a name="l01291"></a>01291                                    nodal_temp_vector,
<a name="l01292"></a>01292                                    <span class="keyword">false</span>,
<a name="l01293"></a>01293                                    <span class="keyword">false</span>);
<a name="l01294"></a>01294   
<a name="l01295"></a>01295   <span class="keyword">const</span> <a class="code" href="class_design_data_1_1_design_parameter.html" title="this class forms the base class for all design parameters.">DesignData::DesignParameter</a>&amp; dparam = 
<a name="l01296"></a>01296   this-&gt;thermal_discipline.getAnalysisDriver().getCurrentDesignParameter();
<a name="l01297"></a>01297   <span class="keywordflow">if</span> (dparam.<a class="code" href="class_design_data_1_1_design_parameter.html#ada780fbd596a879cb3d57cb44376a702">getParameterTypeEnumID</a>() == DesignData::SHAPE_PARAMETER::num())
<a name="l01298"></a>01298     this-&gt;calculateRadElemTempVector(&amp;rad_temp_vector_sens,
<a name="l01299"></a>01299                                      nodal_temp_vector,
<a name="l01300"></a>01300                                      <span class="keyword">false</span>,
<a name="l01301"></a>01301                                      <span class="keyword">true</span>);
<a name="l01302"></a>01302   
<a name="l01303"></a>01303   
<a name="l01304"></a>01304   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> G_matrix(n_elems, n_nodes);
<a name="l01305"></a>01305   this-&gt;getMatrixQuantity(G_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaddba04b27f5a8c99ae4edac90bdf939">RadiationCavityAnalysis::G_MATRIX</a>);
<a name="l01306"></a>01306   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> G_matrix_sens(n_elems, n_nodes);
<a name="l01307"></a>01307   this-&gt;getMatrixQuantity(G_matrix_sens, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ab3e00964c9ce893d80049b2b2daf4967">RadiationCavityAnalysis::G_MATRIX_SENSITIVITY</a>);
<a name="l01308"></a>01308   
<a name="l01309"></a>01309   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> A_matrix(n_elems, n_elems); 
<a name="l01310"></a>01310   this-&gt;getMatrixQuantity(A_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaebaf5b8a62e34552ead17659e9d0415">RadiationCavityAnalysis::A_MATRIX</a>);
<a name="l01311"></a>01311   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> A_matrix_sens(n_elems, n_elems);
<a name="l01312"></a>01312   this-&gt;getMatrixQuantity(A_matrix_sens, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9afc5da26c57bb9e45d36e0b65db2e061b">RadiationCavityAnalysis::A_MATRIX_SENSITIVITY</a>);
<a name="l01313"></a>01313   
<a name="l01314"></a>01314   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> B_matrix_sens(n_elems, n_elems);
<a name="l01315"></a>01315   this-&gt;getMatrixQuantity(B_matrix_sens, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aa8e253c18366682e146778d7d9c6d09e">RadiationCavityAnalysis::B_MATRIX_SENSITIVITY</a>);
<a name="l01316"></a>01316   
<a name="l01317"></a>01317   <span class="comment">// out of these vectors, vector4 has size n_nodes, hence, result of any vector multiplied by </span>
<a name="l01318"></a>01318   <span class="comment">// G matrix will go into this vector </span>
<a name="l01319"></a>01319   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> vector1(n_elems), vector2(n_elems), vector3(n_elems),
<a name="l01320"></a>01320   vector4(n_nodes);
<a name="l01321"></a>01321   vector1.zero(); vector2.zero(); vector3.zero(); vector4.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01322"></a>01322   
<a name="l01323"></a>01323   std::auto_ptr&lt;FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt; &gt; AB_inv, A_inv, factor_matrix;
<a name="l01324"></a>01324   
<a name="l01325"></a>01325   <span class="keywordflow">if</span> (!this-&gt;thermal_discipline.checkPropertyDependenceOnTemperature())
<a name="l01326"></a>01326     {
<a name="l01327"></a>01327       factor_matrix.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>(n_nodes, n_elems)); 
<a name="l01328"></a>01328       this-&gt;getMatrixQuantity(*factor_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a706dd25ad60743b308702c7c244fc998">RadiationCavityAnalysis::FACTOR_MATRIX</a>);
<a name="l01329"></a>01329       <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> B_inverse_matrix(n_elems, n_elems);
<a name="l01330"></a>01330       this-&gt;getMatrixQuantity(B_inverse_matrix,
<a name="l01331"></a>01331                               <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a82a5786d2a5fc2125c69c3b0c4b25795">RadiationCavityAnalysis::B_INVERSE_MATRIX</a>);
<a name="l01332"></a>01332       B_inverse_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a89fe3f3f5841376aa58fe144278c707c">rightMultiplyVector</a>(rad_temp_vector,
<a name="l01333"></a>01333                                            vector1);
<a name="l01334"></a>01334     }
<a name="l01335"></a>01335   <span class="keywordflow">else</span>
<a name="l01336"></a>01336     {
<a name="l01337"></a>01337       AB_inv.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>(n_elems, n_elems)); 
<a name="l01338"></a>01338       A_inv.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>(n_elems, n_elems)); 
<a name="l01339"></a>01339       this-&gt;getMatrixQuantity(*AB_inv, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ada425f7476e4534bd9684e2d4fab9ce0">RadiationCavityAnalysis::AB_INV_MATRIX</a>);
<a name="l01340"></a>01340       this-&gt;getMatrixQuantity(*A_inv, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ae8bc4b7f41e205e9e6fe14a31a551ef0">RadiationCavityAnalysis::A_INVERSE_MATRIX</a>);
<a name="l01341"></a>01341       
<a name="l01342"></a>01342       AB_inv-&gt;rightMultiplyVector(rad_temp_vector, vector1);
<a name="l01343"></a>01343       A_inv-&gt;rightMultiplyVector(vector1, vector2);
<a name="l01344"></a>01344     }
<a name="l01345"></a>01345   
<a name="l01346"></a>01346   <span class="comment">// calculate the first term</span>
<a name="l01347"></a>01347   <span class="keywordflow">if</span> (!this-&gt;thermal_discipline.checkPropertyDependenceOnTemperature())
<a name="l01348"></a>01348     {
<a name="l01349"></a>01349       vector3.zero();
<a name="l01350"></a>01350       A_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a89fe3f3f5841376aa58fe144278c707c">rightMultiplyVector</a>(vector1, vector3);
<a name="l01351"></a>01351       G_matrix_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#adee2257f7d4a1e65682a6ad595036d02">leftMultiplyVector</a>(vector3, nodal_load_vector_sens);
<a name="l01352"></a>01352     }
<a name="l01353"></a>01353   <span class="keywordflow">else</span>
<a name="l01354"></a>01354     G_matrix_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#adee2257f7d4a1e65682a6ad595036d02">leftMultiplyVector</a>(vector1, nodal_load_vector_sens);
<a name="l01355"></a>01355   
<a name="l01356"></a>01356   <span class="comment">// second term</span>
<a name="l01357"></a>01357   vector3.zero();
<a name="l01358"></a>01358   <span class="keywordflow">if</span> (!this-&gt;thermal_discipline.checkPropertyDependenceOnTemperature())
<a name="l01359"></a>01359     A_matrix_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a89fe3f3f5841376aa58fe144278c707c">rightMultiplyVector</a>(vector1, vector3);
<a name="l01360"></a>01360   <span class="keywordflow">else</span>
<a name="l01361"></a>01361     A_matrix_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a89fe3f3f5841376aa58fe144278c707c">rightMultiplyVector</a>(vector2, vector3);
<a name="l01362"></a>01362   G_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#adee2257f7d4a1e65682a6ad595036d02">leftMultiplyVector</a>(vector3, vector4);
<a name="l01363"></a>01363   nodal_load_vector_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a8d29fa33d3f981456e6bfa26a1fac17f">add</a>(1.0, vector4);
<a name="l01364"></a>01364   
<a name="l01365"></a>01365   <span class="comment">// third term</span>
<a name="l01366"></a>01366   <span class="keywordflow">if</span> (!this-&gt;thermal_discipline.checkPropertyDependenceOnTemperature())
<a name="l01367"></a>01367     {
<a name="l01368"></a>01368       B_matrix_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a89fe3f3f5841376aa58fe144278c707c">rightMultiplyVector</a>(vector1, vector3);
<a name="l01369"></a>01369       rad_temp_vector_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a8d29fa33d3f981456e6bfa26a1fac17f">add</a>(-1.0, vector3);
<a name="l01370"></a>01370       factor_matrix-&gt;rightMultiplyVector(rad_temp_vector_sens, vector4);
<a name="l01371"></a>01371     }
<a name="l01372"></a>01372   <span class="keywordflow">else</span>
<a name="l01373"></a>01373     {
<a name="l01374"></a>01374       B_matrix_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a89fe3f3f5841376aa58fe144278c707c">rightMultiplyVector</a>(vector2, vector3);
<a name="l01375"></a>01375       rad_temp_vector_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a8d29fa33d3f981456e6bfa26a1fac17f">add</a>(-1.0, vector3);
<a name="l01376"></a>01376       AB_inv-&gt;rightMultiplyVector(rad_temp_vector_sens, vector3);
<a name="l01377"></a>01377       G_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#adee2257f7d4a1e65682a6ad595036d02">leftMultiplyVector</a>(vector3, vector4);
<a name="l01378"></a>01378     }
<a name="l01379"></a>01379   
<a name="l01380"></a>01380   nodal_load_vector_sens.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a8d29fa33d3f981456e6bfa26a1fac17f">add</a>(1.0, vector4);
<a name="l01381"></a>01381   
<a name="l01382"></a>01382   <span class="comment">// clear the nodal load vector pointer</span>
<a name="l01383"></a>01383   this-&gt;fe_nodal_temp_vector = NULL;
<a name="l01384"></a>01384   
<a name="l01385"></a>01385   this-&gt;fesystem_controller.performance_logging-&gt;unsetEvent
<a name="l01386"></a>01386   (<span class="stringliteral">&quot;RadiationCavityAnalysis::getFENodalLoadVectorSensitivity()&quot;</span>,
<a name="l01387"></a>01387    this-&gt;performance_logging_header);
<a name="l01388"></a>01388 }
<a name="l01389"></a>01389 
<a name="l01390"></a>01390 
<a name="l01391"></a>01391 
<a name="l01392"></a>01392 
<a name="l01393"></a>01393 
<a name="l01394"></a>01394 <span class="keywordtype">void</span> <a class="code" href="class_radiation_cavity_analysis.html#ae155657b1fa03cee3b09bc02eea7c140">RadiationCavityAnalysis::getFEJacobianMatrix</a>
<a name="l01395"></a><a class="code" href="class_radiation_cavity_analysis.html#ae155657b1fa03cee3b09bc02eea7c140">01395</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; nodal_temp_val,
<a name="l01396"></a>01396  <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; jacobian)
<a name="l01397"></a>01397 {
<a name="l01398"></a>01398   this-&gt;fesystem_controller.performance_logging-&gt;setEvent
<a name="l01399"></a>01399   (<span class="stringliteral">&quot;RadiationCavityAnalysis::getFEJacobianMatrix()&quot;</span>,
<a name="l01400"></a>01400    this-&gt;performance_logging_header);
<a name="l01401"></a>01401   
<a name="l01402"></a>01402   <span class="comment">// first set the pointer to the nodal load vector</span>
<a name="l01403"></a>01403   this-&gt;fe_nodal_temp_vector = &amp;(nodal_temp_val);
<a name="l01404"></a>01404   
<a name="l01405"></a>01405   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> elem_dof = 0,
<a name="l01406"></a>01406   n_elems = this-&gt;radiation_cavity.nRadiationElems(),
<a name="l01407"></a>01407   n_nodes = this-&gt;radiation_cavity.getFENodes().size();
<a name="l01408"></a>01408   
<a name="l01409"></a>01409   <span class="comment">// get the factor_matrix, multiply it with the nodal load vector and return </span>
<a name="l01410"></a>01410   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> factor_matrix(n_nodes, n_elems);
<a name="l01411"></a>01411   
<a name="l01412"></a>01412   assert (jacobian.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() == jacobian.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a6cd62edc363882589e4d9520f2c3f566">n</a>());
<a name="l01413"></a>01413   assert (jacobian.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() == factor_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>());
<a name="l01414"></a>01414   assert (jacobian.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() == nodal_temp_val.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>());
<a name="l01415"></a>01415   jacobian.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a7f4e4f7b27462324d6c89aa908c3cb6c">zero</a>();
<a name="l01416"></a>01416   
<a name="l01417"></a>01417   
<a name="l01418"></a>01418   <span class="comment">// get the value of absolute temperature </span>
<a name="l01419"></a>01419   <span class="keyword">const</span> <span class="keywordtype">double</span> temp_abs = 
<a name="l01420"></a>01420   this-&gt;fesystem_controller.analysis_case-&gt;getRealParameter(<span class="stringliteral">&quot;ABSOLUTE_TEMP&quot;</span>);
<a name="l01421"></a>01421   
<a name="l01422"></a>01422   <span class="comment">// create some temporary set of values for the procedure below</span>
<a name="l01423"></a>01423   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> elem_temp_matrix(n_elems, n_nodes);
<a name="l01424"></a>01424   elem_temp_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a7f4e4f7b27462324d6c89aa908c3cb6c">zero</a>();
<a name="l01425"></a>01425   
<a name="l01426"></a>01426   std::vector&lt;Point&gt; points;
<a name="l01427"></a>01427   <span class="keywordtype">double</span> qp_value = 0.0;
<a name="l01428"></a>01428   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> value;
<a name="l01429"></a>01429   std::vector&lt;unsigned int&gt; fe_node_ID_vec;
<a name="l01430"></a>01430   
<a name="l01431"></a>01431   std::auto_ptr&lt;QBase&gt; quadrature(<span class="keyword">new</span> QGauss(2,FIFTH));
<a name="l01432"></a>01432   std::auto_ptr&lt;FEBase&gt; fe_rad(<span class="keyword">new</span> FE&lt;2, LAGRANGE&gt;(FEType()));
<a name="l01433"></a>01433   std::auto_ptr&lt;FEBase&gt; global_fe(<span class="keyword">new</span> FE&lt;2,LAGRANGE&gt;(FEType()));
<a name="l01434"></a>01434   
<a name="l01435"></a>01435   fe_rad-&gt;attach_quadrature_rule(quadrature.get());
<a name="l01436"></a>01436   
<a name="l01437"></a>01437   <a class="code" href="_radiation_cavity_8h.html#a95a54ed90e810eea01d0a99c2d9fdfe4">RadiationElemConstIterator</a> elem_it, elem_end;
<a name="l01438"></a>01438   elem_it = this-&gt;radiation_cavity.getElemBeginIterator();
<a name="l01439"></a>01439   elem_end = this-&gt;radiation_cavity.getElemEndIterator();
<a name="l01440"></a>01440   
<a name="l01441"></a>01441   
<a name="l01442"></a>01442   <span class="comment">// this for loop calculates and stores in elem_temp_matrix the following quantity </span>
<a name="l01443"></a>01443   <span class="comment">// [d T_R^4 / d T_FE] = [int_Omega 4 ({N}^T {T_FE}+T_abs)^3 {N}^T d Omega]</span>
<a name="l01444"></a>01444   <span class="keywordflow">for</span> (; elem_it != elem_end; elem_it++)
<a name="l01445"></a>01445     {
<a name="l01446"></a>01446       elem_dof = (*elem_it)-&gt;ID();
<a name="l01447"></a>01447       
<a name="l01448"></a>01448       fe_node_ID_vec.clear();
<a name="l01449"></a>01449       
<a name="l01450"></a>01450       <span class="comment">// get the vector of internal node IDs</span>
<a name="l01451"></a>01451       this-&gt;radiation_cavity.getInternalNodeIDForRadElem
<a name="l01452"></a>01452       (elem_dof, fe_node_ID_vec);
<a name="l01453"></a>01453       
<a name="l01454"></a>01454       <span class="comment">// get the local elem and the nodes in the local coordinates</span>
<a name="l01455"></a>01455       Elem* local_rad_elem = 
<a name="l01456"></a>01456       (*elem_it)-&gt;getLocalRadiationGeometricElem();
<a name="l01457"></a>01457       <span class="keyword">const</span> std::vector&lt;Node*&gt; local_nodes = 
<a name="l01458"></a>01458       (*elem_it)-&gt;getLocalCoordinateNodes();
<a name="l01459"></a>01459       
<a name="l01460"></a>01460       fe_rad-&gt;reinit(local_rad_elem);
<a name="l01461"></a>01461       
<a name="l01462"></a>01462       <span class="comment">// now obtain the value of the shape function for </span>
<a name="l01463"></a>01463       <span class="comment">// the associated FE</span>
<a name="l01464"></a>01464       <span class="keyword">const</span> std::vector&lt;std::vector&lt;Real&gt; &gt;&amp; phi_rad = fe_rad-&gt;get_phi();
<a name="l01465"></a>01465       <span class="keyword">const</span> std::vector&lt;Real&gt;&amp; JxW_rad = fe_rad-&gt;get_JxW();
<a name="l01466"></a>01466       
<a name="l01467"></a>01467       points.clear();
<a name="l01468"></a>01468       
<a name="l01469"></a>01469       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qp = 0; qp &lt; phi_rad[0].size(); qp++)
<a name="l01470"></a>01470         {
<a name="l01471"></a>01471           Point pt;
<a name="l01472"></a>01472           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; phi_rad.size(); i++)
<a name="l01473"></a>01473             {
<a name="l01474"></a>01474               Node&amp; node = *(local_nodes[i]);
<a name="l01475"></a>01475               pt(0) += phi_rad[i][qp] * node(0);
<a name="l01476"></a>01476               pt(1) += phi_rad[i][qp] * node(1);
<a name="l01477"></a>01477             }
<a name="l01478"></a>01478           points.push_back(pt);
<a name="l01479"></a>01479         }
<a name="l01480"></a>01480       
<a name="l01481"></a>01481       <span class="comment">// next, get the values of the shape function for the global </span>
<a name="l01482"></a>01482       <span class="comment">// FE at the quad points for the local rad elem</span>
<a name="l01483"></a>01483       global_fe-&gt;reinit(local_rad_elem, &amp;points);
<a name="l01484"></a>01484       <span class="keyword">const</span> std::vector&lt;std::vector&lt;Real&gt; &gt;&amp; phi_global = global_fe-&gt;get_phi();
<a name="l01485"></a>01485       
<a name="l01486"></a>01486       <span class="keywordflow">if</span> (value.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>() != phi_global.size())
<a name="l01487"></a>01487         value.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html#a734ca8b60d564df1539ae11e9fd5f867" title="resize the matrix to the given dimensions">resize</a>(phi_global.size());
<a name="l01488"></a>01488       
<a name="l01489"></a>01489       <span class="comment">// now, calculate the G_vector</span>
<a name="l01490"></a>01490       value.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01491"></a>01491       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qp=0; qp &lt; JxW_rad.size(); qp++)
<a name="l01492"></a>01492         {
<a name="l01493"></a>01493           <span class="comment">// calculate the temperaure at the quadrature point first</span>
<a name="l01494"></a>01494           qp_value = 0.0;
<a name="l01495"></a>01495           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; phi_global.size(); i++)
<a name="l01496"></a>01496             qp_value += phi_global[i][qp] * 
<a name="l01497"></a>01497             (nodal_temp_val.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a98c553254ecd51c3ece2b86e52cd960e">el</a>(fe_node_ID_vec[i]) + temp_abs);
<a name="l01498"></a>01498           
<a name="l01499"></a>01499           qp_value = pow(qp_value, 3);
<a name="l01500"></a>01500           <span class="comment">// next, add this to the vector </span>
<a name="l01501"></a>01501           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; phi_global.size(); i++)
<a name="l01502"></a>01502             value.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a8d29fa33d3f981456e6bfa26a1fac17f">add</a>(i, 4 * phi_global[i][qp] * qp_value * JxW_rad[qp]);
<a name="l01503"></a>01503         }
<a name="l01504"></a>01504       
<a name="l01505"></a>01505       value.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a67cddf9b9ceb614362da1519af23b3d3">scale</a>(1.0 / (*elem_it)-&gt;getArea());
<a name="l01506"></a>01506       <span class="comment">// now insert the value in the elem matrix</span>
<a name="l01507"></a>01507       elem_temp_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#ae18d819dc1f95b6b8f157055b2d9c27c">setRow</a>(elem_dof, fe_node_ID_vec, value);
<a name="l01508"></a>01508     }
<a name="l01509"></a>01509   
<a name="l01510"></a>01510   
<a name="l01511"></a>01511   
<a name="l01512"></a>01512   <span class="comment">// now multiply the factor matrix and the elem_temp_matrix</span>
<a name="l01513"></a>01513   <span class="comment">// together to get the jacobian</span>
<a name="l01514"></a>01514   <span class="keywordflow">if</span> (!this-&gt;thermal_discipline.checkPropertyDependenceOnTemperature())
<a name="l01515"></a>01515     {
<a name="l01516"></a>01516       <span class="comment">// for temp independent case, we have [d T_R^4 / d T_FE] in the elem temp matrix</span>
<a name="l01517"></a>01517       <span class="comment">// this only needs to be multiplied with the factor matrix G^T A B^{-1} on the left</span>
<a name="l01518"></a>01518       this-&gt;getMatrixQuantity(factor_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a706dd25ad60743b308702c7c244fc998">RadiationCavityAnalysis::FACTOR_MATRIX</a>);
<a name="l01519"></a>01519       elem_temp_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#a63f0f418eefb914bea8c3cf8ed47bc9f">leftMultiply</a>(factor_matrix);
<a name="l01520"></a>01520       jacobian.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#abda25b62b46fd71c1e1870a3c95f4d17">copy</a>(elem_temp_matrix);
<a name="l01521"></a>01521     }
<a name="l01522"></a>01522   <span class="keywordflow">else</span>  
<a name="l01523"></a>01523     {
<a name="l01524"></a>01524       <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>
<a name="l01525"></a>01525       A_inv(n_elems, n_elems), AB_inv(n_elems, n_elems), G_mat(n_elems, n_nodes);
<a name="l01526"></a>01526       this-&gt;getMatrixQuantity(G_mat, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaddba04b27f5a8c99ae4edac90bdf939">RadiationCavityAnalysis::G_MATRIX</a>);
<a name="l01527"></a>01527       this-&gt;getMatrixQuantity(A_inv, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ae8bc4b7f41e205e9e6fe14a31a551ef0">RadiationCavityAnalysis::A_INVERSE_MATRIX</a>);
<a name="l01528"></a>01528       this-&gt;getMatrixQuantity(AB_inv, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ada425f7476e4534bd9684e2d4fab9ce0">RadiationCavityAnalysis::AB_INV_MATRIX</a>);
<a name="l01529"></a>01529       factor_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#abda25b62b46fd71c1e1870a3c95f4d17">copy</a>(AB_inv);
<a name="l01530"></a>01530       factor_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#a4e686c59ee1ffbc455c0a330613d63b7">leftMultiplyTranspose</a>(G_mat);
<a name="l01531"></a>01531       
<a name="l01532"></a>01532       <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> temp_dep_vector(n_elems), rad_temp_vector;
<a name="l01533"></a>01533       temp_dep_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01534"></a>01534       rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01535"></a>01535       this-&gt;calculateRadElemTempVector(&amp;rad_temp_vector, nodal_temp_val,
<a name="l01536"></a>01536                                        <span class="keyword">false</span>, <span class="comment">// false for reduce power by 4 </span>
<a name="l01537"></a>01537                                        <span class="keyword">false</span>); <span class="comment">// false for sensitivity </span>
<a name="l01538"></a>01538       
<a name="l01539"></a>01539       <span class="comment">// get the contribution matrix due to temperature dependent properties</span>
<a name="l01540"></a>01540       <span class="comment">// this willl return the term [\frac{\partial B_{ij}}{\partial T_{R_k}}\psi_j]_diag</span>
<a name="l01541"></a>01541       this-&gt;calculateB_TemperatureDependentJacobianContribution(temp_dep_vector, rad_temp_vector,
<a name="l01542"></a>01542                                                                 A_inv, AB_inv);
<a name="l01543"></a>01543       
<a name="l01544"></a>01544       <span class="comment">// multiply it with the sensitivity of the radiation temperatures, with respect to the</span>
<a name="l01545"></a>01545       <span class="comment">// FE temperatures</span>
<a name="l01546"></a>01546       <span class="comment">// [d {T_rad} / d {T_fe}] = (1/4) * diag([(T_rad + T_a)^3])^(-1) * [elem_temp_matrix]</span>
<a name="l01547"></a>01547       
<a name="l01548"></a>01548       <span class="comment">// to perform this calculation, first obtain the temperature vector raised to 3rd power</span>
<a name="l01549"></a>01549       rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a78a2fdc3d899fdde5c43a8d6133ccd83" title="raises each element of the vector by the given power">power</a>(0.75);
<a name="l01550"></a>01550       rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a67cddf9b9ceb614362da1519af23b3d3">scale</a>(-4.0); <span class="comment">// -4.0 to take care of the -1.0 of this term</span>
<a name="l01551"></a>01551       rad_temp_vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab1d853d64dbf0700c202da505f914946" title="sets each element of the vector to its reciprocal">invertValues</a>();
<a name="l01552"></a>01552       
<a name="l01553"></a>01553       <span class="comment">// this pointwise multiplication operation gives the vector </span>
<a name="l01554"></a>01554       <span class="comment">// -1.0 * [\frac{\partial B_{ij}}{\partial T_{R_k}}\psi_j]_diag * [(1/4) * (T_rad + T_a)^-3]_diag </span>
<a name="l01555"></a>01555       temp_dep_vector.pointwiseMultiply(rad_temp_vector);
<a name="l01556"></a>01556       <span class="comment">// this shift operation takes care of the [d((T_{rad}+T_{abs})^4)/d T_{rad}]</span>
<a name="l01557"></a>01557       temp_dep_vector.shift(1.0);
<a name="l01558"></a>01558       
<a name="l01559"></a>01559       <span class="comment">// now use this to calculate the following term using the approximation</span>
<a name="l01560"></a>01560       <span class="comment">// [G]^T [A] [B]^{-1} [lambda] [dT_R^4/dT_{FE}]</span>
<a name="l01561"></a>01561       <span class="keywordflow">if</span>(!this-&gt;radiation_cavity.ifApproximateABInvFactor())
<a name="l01562"></a>01562         {
<a name="l01563"></a>01563           elem_temp_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aa6a1ff5036f446d56c04ebc418ff2e2d">leftDiagonalScale</a>(temp_dep_vector);
<a name="l01564"></a>01564           elem_temp_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#a63f0f418eefb914bea8c3cf8ed47bc9f">leftMultiply</a>(factor_matrix);
<a name="l01565"></a>01565         }
<a name="l01566"></a>01566       <span class="keywordflow">else</span>
<a name="l01567"></a>01567         {
<a name="l01568"></a>01568           <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> vector1(n_elems), vector2(n_elems);
<a name="l01569"></a>01569           this-&gt;getTemperatureDependentFluxCorrectionVector(vector2, AB_inv);
<a name="l01570"></a>01570           AB_inv.getDiagonal(vector1);
<a name="l01571"></a>01571           vector2.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a1f96ef209ad5edcaf49aaf150ad789b6" title="sets (*this)[i] = (*this)[i] * vec[i]">pointwiseMultiply</a>(vector1);
<a name="l01572"></a>01572           vector2.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a1f96ef209ad5edcaf49aaf150ad789b6" title="sets (*this)[i] = (*this)[i] * vec[i]">pointwiseMultiply</a>(temp_dep_vector);
<a name="l01573"></a>01573           vector2.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a8d29fa33d3f981456e6bfa26a1fac17f">add</a>(1.0, temp_dep_vector);
<a name="l01574"></a>01574           AB_inv.rightDiagonalScale(temp_dep_vector);
<a name="l01575"></a>01575           
<a name="l01576"></a>01576           AB_inv.leftMultiplyTranspose(G_mat);
<a name="l01577"></a>01577           elem_temp_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#a63f0f418eefb914bea8c3cf8ed47bc9f">leftMultiply</a>(AB_inv);
<a name="l01578"></a>01578         }
<a name="l01579"></a>01579       
<a name="l01580"></a>01580       jacobian.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html#abda25b62b46fd71c1e1870a3c95f4d17">copy</a>(elem_temp_matrix);
<a name="l01581"></a>01581     }
<a name="l01582"></a>01582   
<a name="l01583"></a>01583   this-&gt;fesystem_controller.performance_logging-&gt;unsetEvent
<a name="l01584"></a>01584   (<span class="stringliteral">&quot;RadiationCavityAnalysis::getFEJacobianMatrix()&quot;</span>,
<a name="l01585"></a>01585    this-&gt;performance_logging_header);
<a name="l01586"></a>01586 }
<a name="l01587"></a>01587 
<a name="l01588"></a>01588 
<a name="l01589"></a>01589 
<a name="l01590"></a>01590 <span class="keywordtype">void</span>
<a name="l01591"></a>01591 <a class="code" href="class_radiation_cavity_analysis.html#a92c0ccdda2e26fb12ef85ee8013cc314">RadiationCavityAnalysis::getTemperatureDependentFluxCorrectionVector</a>
<a name="l01592"></a><a class="code" href="class_radiation_cavity_analysis.html#a92c0ccdda2e26fb12ef85ee8013cc314">01592</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; correction_vec,
<a name="l01593"></a>01593  <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; AB_inv_mat)
<a name="l01594"></a>01594 {
<a name="l01595"></a>01595   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_elems = this-&gt;radiation_cavity.nRadiationElems();
<a name="l01596"></a>01596   
<a name="l01597"></a>01597   Assert(correction_vec.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>() == n_elems, ExcInternalError());
<a name="l01598"></a>01598   Assert(AB_inv_mat.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() == n_elems, ExcInternalError());
<a name="l01599"></a>01599   Assert(AB_inv_mat.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a6cd62edc363882589e4d9520f2c3f566">n</a>() == n_elems, ExcInternalError());
<a name="l01600"></a>01600   
<a name="l01601"></a>01601   correction_vec.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01602"></a>01602   
<a name="l01603"></a>01603   <span class="comment">// calculate the epsilon vector and store it</span>
<a name="l01604"></a>01604   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> vec1(n_elems), vec2(n_elems);
<a name="l01605"></a>01605   
<a name="l01606"></a>01606   std::string name;
<a name="l01607"></a>01607   std::ostringstream cavity_id;
<a name="l01608"></a>01608   cavity_id &lt;&lt; this-&gt;radiation_cavity.getCavityID();
<a name="l01609"></a>01609   
<a name="l01610"></a>01610   name.clear(); 
<a name="l01611"></a>01611   name = <span class="stringliteral">&quot;BaseEpsilonVector&quot;</span>;
<a name="l01612"></a>01612   name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l01613"></a>01613   name += cavity_id.str();
<a name="l01614"></a>01614   
<a name="l01615"></a>01615   <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a> time_independent_data_info;
<a name="l01616"></a>01616   time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#ac1115d95573153291185f76a1540f0e1" title="sets the discipline enum ID">setDisciplineEnumID</a>(Discipline::RADIATION_DISCIPLINE::num());
<a name="l01617"></a>01617   time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a700ae1ec3358b497305c2099fbf1cfea" title="sets the load case value, and also sets to true the boolean value of if_load_case_dependent">setLoadCase</a>(this-&gt;thermal_discipline.getAnalysisDriver().
<a name="l01618"></a>01618                                          getCurrentLoadCase());
<a name="l01619"></a>01619   time_independent_data_info.<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a117399f629d87ea1b646333d91dee39f" title="sets the name of the quantity">setName</a>(name);
<a name="l01620"></a>01620   
<a name="l01621"></a>01621   this-&gt;fesystem_controller.global_data_storage-&gt;fillVector(time_independent_data_info,
<a name="l01622"></a>01622                                                             vec1);
<a name="l01623"></a>01623   this-&gt;calculateEmissivityVector(&amp;vec2);
<a name="l01624"></a>01624   
<a name="l01625"></a>01625   <span class="comment">// next, calculate the gamma vector</span>
<a name="l01626"></a>01626   vec2.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a8d29fa33d3f981456e6bfa26a1fac17f">add</a>(-1.0, vec1);
<a name="l01627"></a>01627   <span class="keywordtype">double</span> base_eps = 0.0, delta_eps = 0.0, val = 0.0;
<a name="l01628"></a>01628   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;n_elems; i++)
<a name="l01629"></a>01629     {
<a name="l01630"></a>01630       base_eps = vec1.el(i);
<a name="l01631"></a>01631       delta_eps = vec2.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a98c553254ecd51c3ece2b86e52cd960e">el</a>(i);
<a name="l01632"></a>01632       
<a name="l01633"></a>01633       val = -delta_eps/base_eps/(base_eps + delta_eps);
<a name="l01634"></a>01634       vec2.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a9fe9c425efb52cefc5b552cdf3295328">set</a>(i, val);
<a name="l01635"></a>01635     }
<a name="l01636"></a>01636   <span class="keywordtype">double</span> <a class="code" href="_arpack_eigen_solver_8h.html#ac687728cb5722b5730ca1b1197128920">sigma</a> = 
<a name="l01637"></a>01637   this-&gt;fesystem_controller.analysis_case-&gt;getRealParameter(<span class="stringliteral">&quot;S_B_CONSTANT&quot;</span>);
<a name="l01638"></a>01638   <span class="comment">// store a copy of vec2 for future use</span>
<a name="l01639"></a>01639   vec2.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a67cddf9b9ceb614362da1519af23b3d3">scale</a>(1.0/sigma);
<a name="l01640"></a>01640 
<a name="l01641"></a>01641     
<a name="l01642"></a>01642   AB_inv_mat.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a41de6854277687999d2d13fa124307b2" title="returns the diagonal of the matrix in the given vector">getDiagonal</a>(vec1);
<a name="l01643"></a>01643 
<a name="l01644"></a>01644   <span class="comment">// get the number of terms to use in the taylors series for approximation</span>
<a name="l01645"></a>01645   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_taylor_terms = 
<a name="l01646"></a>01646   this-&gt;radiation_cavity.getNTaylorTermsForABInvApproximation();
<a name="l01647"></a>01647 
<a name="l01648"></a>01648   <span class="comment">// now iterate over the terms, and calculate the correction vector</span>
<a name="l01649"></a>01649   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; n_taylor_terms; i++)
<a name="l01650"></a>01650     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;n_elems; j++)
<a name="l01651"></a>01651       {
<a name="l01652"></a>01652         val = pow(-vec2.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a98c553254ecd51c3ece2b86e52cd960e">el</a>(j)*vec1.el(j),i+1) / vec1.el(j);
<a name="l01653"></a>01653         correction_vec.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a8d29fa33d3f981456e6bfa26a1fac17f">add</a>(j,val);
<a name="l01654"></a>01654       }
<a name="l01655"></a>01655 }
<a name="l01656"></a>01656 
<a name="l01657"></a>01657 
<a name="l01658"></a>01658 
<a name="l01659"></a>01659 <span class="keywordtype">void</span>
<a name="l01660"></a>01660 <a class="code" href="class_radiation_cavity_analysis.html#a6d92ac9dce49cfcd2627adc86e09f58c" title="calculate the matrix ">RadiationCavityAnalysis::calculateB_TemperatureDependentJacobianContribution</a>
<a name="l01661"></a><a class="code" href="class_radiation_cavity_analysis.html#a6d92ac9dce49cfcd2627adc86e09f58c">01661</a> (<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; vector, 
<a name="l01662"></a>01662  <span class="keyword">const</span> <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a>&amp; rad_temp_vector,
<a name="l01663"></a>01663  <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; A_inv_mat,
<a name="l01664"></a>01664  <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a>&amp; AB_inv_mat)
<a name="l01665"></a>01665 {
<a name="l01666"></a>01666   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  n_elems = this-&gt;radiation_cavity.nRadiationElems();
<a name="l01667"></a>01667   
<a name="l01668"></a>01668   <span class="comment">// create some temporary set of values for the procedure below</span>
<a name="l01669"></a>01669   <span class="keywordflow">if</span> (vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#ab13ec4f05aad80c7e4060c45cf83caac">size</a>() != n_elems)
<a name="l01670"></a>01670     vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html#a734ca8b60d564df1539ae11e9fd5f867" title="resize the matrix to the given dimensions">resize</a>(n_elems);
<a name="l01671"></a>01671   Assert(A_inv_mat.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() == n_elems &amp;&amp; 
<a name="l01672"></a>01672          A_inv_mat.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a6cd62edc363882589e4d9520f2c3f566">n</a>() == n_elems, ExcInternalError());
<a name="l01673"></a>01673   Assert(AB_inv_mat.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#aef539c1770a3365a9b70dd8be0097c91">m</a>() == n_elems &amp;&amp; 
<a name="l01674"></a>01674          AB_inv_mat.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a6cd62edc363882589e4d9520f2c3f566">n</a>() == n_elems, ExcInternalError());
<a name="l01675"></a>01675   
<a name="l01676"></a>01676   vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01677"></a>01677   
<a name="l01678"></a>01678   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_vector.html">FESystemNumerics::PetscSeqVector&lt;double&gt;</a> vector1(n_elems), vector2(n_elems), vector3(n_elems);
<a name="l01679"></a>01679   vector1.zero(); vector2.zero(); vector3.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a0404391bf1618ac71ab199e730c39d49">zero</a>();
<a name="l01680"></a>01680   
<a name="l01681"></a>01681   <a class="code" href="class_f_e_system_numerics_1_1_petsc_seq_dense_matrix.html">FESystemNumerics::PetscSeqDenseMatrix&lt;double&gt;</a> F_matrix(n_elems, n_elems);
<a name="l01682"></a>01682   this-&gt;getMatrixQuantity(F_matrix, <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a710db01b9ba0d3806327e466cf5b6607">RadiationCavityAnalysis::F_MATRIX</a>);
<a name="l01683"></a>01683   
<a name="l01684"></a>01684   <span class="comment">// first, get a vector for [B]^(-1) * {(T_rad + T_a)^4}</span>
<a name="l01685"></a>01685   AB_inv_mat.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a89fe3f3f5841376aa58fe144278c707c">rightMultiplyVector</a>(rad_temp_vector, vector2);
<a name="l01686"></a>01686   
<a name="l01687"></a>01687   <span class="comment">// if the cavity AB_inv matrix is being approximated, then calculated </span>
<a name="l01688"></a>01688   <span class="comment">// vector needs to be corrected</span>
<a name="l01689"></a>01689   <span class="keywordflow">if</span>(this-&gt;radiation_cavity.ifApproximateABInvFactor())
<a name="l01690"></a>01690     {
<a name="l01691"></a>01691       this-&gt;getTemperatureDependentFluxCorrectionVector(vector1, AB_inv_mat);
<a name="l01692"></a>01692       vector1.pointwiseMultiply(vector2);
<a name="l01693"></a>01693       AB_inv_mat.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a89fe3f3f5841376aa58fe144278c707c">rightMultiplyVector</a>(vector1, vector3);
<a name="l01694"></a>01694       vector2.add(1.0, vector3);
<a name="l01695"></a>01695     }
<a name="l01696"></a>01696   
<a name="l01697"></a>01697   A_inv_mat.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a89fe3f3f5841376aa58fe144278c707c">rightMultiplyVector</a>(vector2, vector1);
<a name="l01698"></a>01698   
<a name="l01699"></a>01699   
<a name="l01700"></a>01700   <a class="code" href="class_property_1_1_property_database.html">Property::PropertyDatabase</a>&amp; property_database = 
<a name="l01701"></a>01701   *(this-&gt;fesystem_controller.property_database.get());
<a name="l01702"></a>01702   <a class="code" href="class_mesh_d_s_1_1_f_e_mesh_data.html">MeshDS::FEMeshData</a>&amp; mesh_data = *(this-&gt;radiation_cavity.getMeshData());
<a name="l01703"></a>01703   
<a name="l01704"></a>01704   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fe_elem_ID, property_ID;
<a name="l01705"></a>01705   <span class="keywordtype">double</span> factor;
<a name="l01706"></a>01706   
<a name="l01707"></a>01707   <span class="comment">// iterate over each radiation element, and calculate the contribution</span>
<a name="l01708"></a>01708   <span class="comment">// this loop calculates the term [\frac{\partial B_{ij}}{\partial T_{R_k}}\psi_j]_diag</span>
<a name="l01709"></a>01709   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; n_elems; i++)
<a name="l01710"></a>01710     {
<a name="l01711"></a>01711       <span class="comment">// get the ID of the finite elem, get the property card for this elem</span>
<a name="l01712"></a>01712       fe_elem_ID = this-&gt;radiation_cavity.getElemFromID(i).FeElementID();
<a name="l01713"></a>01713       <span class="keyword">const</span> Elem* elem = mesh_data.<a class="code" href="class_mesh_d_s_1_1_f_e_mesh_data.html#ad0a5644dd5120fb02d602cae62a5a330">getElemFromForeignID</a>(fe_elem_ID);
<a name="l01714"></a>01714       property_ID = mesh_data.<a class="code" href="class_mesh_d_s_1_1_f_e_mesh_data.html#ae50bb83a080c0f9d30cb6a7b9458af54">getElemPropertyID</a>(elem);
<a name="l01715"></a>01715       <a class="code" href="class_elem_data_card.html">ElemDataCard</a>&amp; elem_data_card = property_database.<a class="code" href="class_property_1_1_property_database.html#a4120ff84d49bd7d1b547507759f2d27f" title="returns the element property card for this ID">getElemDataCardFromID</a>(property_ID);
<a name="l01716"></a>01716       
<a name="l01717"></a>01717       <span class="comment">// if the property is temperature dependent, then initialize the property card </span>
<a name="l01718"></a>01718       <span class="comment">// at the average temperature of the finite element to which this radiation </span>
<a name="l01719"></a>01719       <span class="comment">// element belongs</span>
<a name="l01720"></a>01720       this-&gt;initializePropertyCardAtElementTemperature(elem_data_card, i);
<a name="l01721"></a>01721       
<a name="l01722"></a>01722       <span class="comment">// this is the term (\frac{-1}{epsilon^2_{R_i}} </span>
<a name="l01723"></a>01723       <span class="comment">//  \frac{\partial \epsilon_{R_i}(T_{R_i})}{\partial T_{R_k}} \delta_{ij} \delta_{ik})</span>
<a name="l01724"></a>01724       <span class="comment">// sensitivities for both factor1 and factor2 are the same, hence, only one is</span>
<a name="l01725"></a>01725       <span class="comment">// obtained</span>
<a name="l01726"></a>01726       elem_data_card.<a class="code" href="class_elem_data_card.html#a1afbbbdd7610f00fd43e7ddfba50ca55">getFactorSensitivityForLocalParameter</a>(factor, 
<a name="l01727"></a>01727                                                            RADIATION_EPSILON_FACTOR_1::num(),
<a name="l01728"></a>01728                                                            Property::TEMPERATURE::num());      
<a name="l01729"></a>01729       
<a name="l01730"></a>01730       F_matrix.<a class="code" href="class_f_e_system_numerics_1_1_petsc_matrix_base.html#a440da4d6191d314453b25d39aa879cbe" title="returns the i th row of the matrix in the given vector">getRow</a>(i, vector2);
<a name="l01731"></a>01731       vector2.scale(-factor);
<a name="l01732"></a>01732       vector2.add(i, factor);
<a name="l01733"></a>01733       vector.<a class="code" href="class_f_e_system_numerics_1_1_petsc_vector_base.html#a9fe9c425efb52cefc5b552cdf3295328">set</a>(i, vector1.dot(vector2));
<a name="l01734"></a>01734       
<a name="l01735"></a>01735       
<a name="l01736"></a>01736       <span class="comment">// once this card has been used, clear the initialization</span>
<a name="l01737"></a>01737       this-&gt;clearPropertyCardInitialization(elem_data_card);
<a name="l01738"></a>01738     }
<a name="l01739"></a>01739   
<a name="l01740"></a>01740 }
<a name="l01741"></a>01741 
<a name="l01742"></a>01742 
<a name="l01743"></a>01743 
<a name="l01744"></a>01744 
<a name="l01745"></a>01745 <span class="keywordtype">bool</span>
<a name="l01746"></a><a class="code" href="class_radiation_cavity_analysis.html#a6f756b8d67e57b6d605c102fb3209e97">01746</a> <a class="code" href="class_radiation_cavity_analysis.html#a6f756b8d67e57b6d605c102fb3209e97">RadiationCavityAnalysis::checkIfTemperatureDependent</a>(<a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9" title="enum for the matrix names for this analysis">RadiationQty</a> quantity)
<a name="l01747"></a>01747 {
<a name="l01748"></a>01748   <span class="keywordflow">switch</span> (quantity)
<a name="l01749"></a>01749   {
<a name="l01750"></a>01750     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a710db01b9ba0d3806327e466cf5b6607">RadiationCavityAnalysis::F_MATRIX</a>:
<a name="l01751"></a>01751     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a01aacfc6d2b8119467903e4413350d70">RadiationCavityAnalysis::F_MATRIX_SENSITIVITY</a>:
<a name="l01752"></a>01752       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01753"></a>01753       <span class="keywordflow">break</span>;
<a name="l01754"></a>01754                         
<a name="l01755"></a>01755     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaebaf5b8a62e34552ead17659e9d0415">RadiationCavityAnalysis::A_MATRIX</a>:
<a name="l01756"></a>01756     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9afc5da26c57bb9e45d36e0b65db2e061b">RadiationCavityAnalysis::A_MATRIX_SENSITIVITY</a>:
<a name="l01757"></a>01757       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01758"></a>01758       <span class="keywordflow">break</span>;
<a name="l01759"></a>01759                         
<a name="l01760"></a>01760     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ae8bc4b7f41e205e9e6fe14a31a551ef0">RadiationCavityAnalysis::A_INVERSE_MATRIX</a>:
<a name="l01761"></a>01761       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01762"></a>01762       <span class="keywordflow">break</span>;
<a name="l01763"></a>01763       
<a name="l01764"></a>01764     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaddba04b27f5a8c99ae4edac90bdf939">RadiationCavityAnalysis::G_MATRIX</a>:
<a name="l01765"></a>01765     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ab3e00964c9ce893d80049b2b2daf4967">RadiationCavityAnalysis::G_MATRIX_SENSITIVITY</a>:
<a name="l01766"></a>01766       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01767"></a>01767       <span class="keywordflow">break</span>;
<a name="l01768"></a>01768       
<a name="l01769"></a>01769     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9abe6a1b3373498e2afa348361975f9ee9">RadiationCavityAnalysis::B_MATRIX</a>:
<a name="l01770"></a>01770     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aa8e253c18366682e146778d7d9c6d09e">RadiationCavityAnalysis::B_MATRIX_SENSITIVITY</a>:
<a name="l01771"></a>01771       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01772"></a>01772       <span class="keywordflow">break</span>;
<a name="l01773"></a>01773                         
<a name="l01774"></a>01774     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a82a5786d2a5fc2125c69c3b0c4b25795">RadiationCavityAnalysis::B_INVERSE_MATRIX</a>:
<a name="l01775"></a>01775       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01776"></a>01776       <span class="keywordflow">break</span>;
<a name="l01777"></a>01777                         
<a name="l01778"></a>01778     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a706dd25ad60743b308702c7c244fc998">RadiationCavityAnalysis::FACTOR_MATRIX</a>:
<a name="l01779"></a>01779       <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// false, since it is now defined only for temperature independent cases</span>
<a name="l01780"></a>01780       <span class="keywordflow">break</span>;
<a name="l01781"></a>01781       
<a name="l01782"></a>01782     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ada425f7476e4534bd9684e2d4fab9ce0">RadiationCavityAnalysis::AB_INV_MATRIX</a>:
<a name="l01783"></a>01783       <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// this is defined only for temperature dependent cases</span>
<a name="l01784"></a>01784       <span class="keywordflow">break</span>;
<a name="l01785"></a>01785       
<a name="l01786"></a>01786     <span class="keywordflow">default</span>:
<a name="l01787"></a>01787       abort();
<a name="l01788"></a>01788       <span class="keywordflow">break</span>;
<a name="l01789"></a>01789   }
<a name="l01790"></a>01790   
<a name="l01791"></a>01791   <span class="comment">// should never get here.</span>
<a name="l01792"></a>01792   Assert(<span class="keyword">false</span>, ExcInternalError());
<a name="l01793"></a>01793   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01794"></a>01794 }
<a name="l01795"></a>01795 
<a name="l01796"></a>01796 
<a name="l01797"></a>01797 
<a name="l01798"></a>01798 std::auto_ptr&lt;FESystemDatabase::DataInfoBase&gt;
<a name="l01799"></a><a class="code" href="class_radiation_cavity_analysis.html#a15c6ef55ace32a38f7b37339187abc95">01799</a> <a class="code" href="class_radiation_cavity_analysis.html#a15c6ef55ace32a38f7b37339187abc95">RadiationCavityAnalysis::getDataInfoForQty</a>(<a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9" title="enum for the matrix names for this analysis">RadiationQty</a> quantity)                                          
<a name="l01800"></a>01800 {
<a name="l01801"></a>01801   std::auto_ptr&lt;FESystemDatabase::DataInfoBase&gt; data_info(NULL);
<a name="l01802"></a>01802   std::ostringstream rad_num;
<a name="l01803"></a>01803   rad_num &lt;&lt; this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a1f138bfc5a3a6de6219d5893bfb79ec0" title="cavity for this analysis">radiation_cavity</a>.<a class="code" href="class_radiation_cavity.html#aa7fc38a25e02d4d38d20c16720124ef4" title="returns the cavity ID">getCavityID</a>();
<a name="l01804"></a>01804   std::string name;
<a name="l01805"></a>01805   
<a name="l01806"></a>01806   <span class="keywordflow">switch</span> (quantity)
<a name="l01807"></a>01807   {
<a name="l01808"></a>01808     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a710db01b9ba0d3806327e466cf5b6607">RadiationCavityAnalysis::F_MATRIX</a>:
<a name="l01809"></a>01809     {
<a name="l01810"></a>01810       name = <span class="stringliteral">&quot;F_matrix&quot;</span>;
<a name="l01811"></a>01811       name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l01812"></a>01812       name += rad_num.str();
<a name="l01813"></a>01813       name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l01814"></a>01814       data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a>);
<a name="l01815"></a>01815       data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l01816"></a>01816       data_info-&gt;setName(name);
<a name="l01817"></a>01817     }
<a name="l01818"></a>01818       <span class="keywordflow">break</span>;
<a name="l01819"></a>01819                         
<a name="l01820"></a>01820     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a01aacfc6d2b8119467903e4413350d70">RadiationCavityAnalysis::F_MATRIX_SENSITIVITY</a>:
<a name="l01821"></a>01821     {
<a name="l01822"></a>01822       data_info.reset(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a15c6ef55ace32a38f7b37339187abc95">getDataInfoForQty</a>(<a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a710db01b9ba0d3806327e466cf5b6607">RadiationCavityAnalysis::F_MATRIX</a>).release());
<a name="l01823"></a>01823       data_info-&gt;setDVID(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>().<a class="code" href="class_driver_1_1_analysis_driver.html#ac258e74334cc629c3961bde90f9e5fd9" title="returns the current design variable">getCurrentDesignParameter</a>().<a class="code" href="class_design_data_1_1_design_parameter.html#ab0cb6d6c10206acebbc06d2be204c2e7">getID</a>());
<a name="l01824"></a>01824     }
<a name="l01825"></a>01825       <span class="keywordflow">break</span>;
<a name="l01826"></a>01826       
<a name="l01827"></a>01827     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaebaf5b8a62e34552ead17659e9d0415">RadiationCavityAnalysis::A_MATRIX</a>:
<a name="l01828"></a>01828     {
<a name="l01829"></a>01829       name = <span class="stringliteral">&quot;A_matrix&quot;</span>;
<a name="l01830"></a>01830       name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l01831"></a>01831       name += rad_num.str();
<a name="l01832"></a>01832       name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l01833"></a>01833       data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a>);
<a name="l01834"></a>01834       data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l01835"></a>01835       data_info-&gt;setName(name);
<a name="l01836"></a>01836     }
<a name="l01837"></a>01837       <span class="keywordflow">break</span>;
<a name="l01838"></a>01838       
<a name="l01839"></a>01839     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ae8bc4b7f41e205e9e6fe14a31a551ef0">RadiationCavityAnalysis::A_INVERSE_MATRIX</a>:
<a name="l01840"></a>01840     {
<a name="l01841"></a>01841       name = <span class="stringliteral">&quot;A_Inverse_matrix&quot;</span>;
<a name="l01842"></a>01842       name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l01843"></a>01843       name += rad_num.str();
<a name="l01844"></a>01844       name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l01845"></a>01845       data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a>);
<a name="l01846"></a>01846       data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l01847"></a>01847       data_info-&gt;setName(name);
<a name="l01848"></a>01848     }
<a name="l01849"></a>01849       <span class="keywordflow">break</span>;
<a name="l01850"></a>01850       
<a name="l01851"></a>01851     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9afc5da26c57bb9e45d36e0b65db2e061b">RadiationCavityAnalysis::A_MATRIX_SENSITIVITY</a>:
<a name="l01852"></a>01852     {
<a name="l01853"></a>01853       data_info.reset(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a15c6ef55ace32a38f7b37339187abc95">getDataInfoForQty</a>(<a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaebaf5b8a62e34552ead17659e9d0415">RadiationCavityAnalysis::A_MATRIX</a>).release());
<a name="l01854"></a>01854       data_info-&gt;setDVID(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>().<a class="code" href="class_driver_1_1_analysis_driver.html#ac258e74334cc629c3961bde90f9e5fd9" title="returns the current design variable">getCurrentDesignParameter</a>().<a class="code" href="class_design_data_1_1_design_parameter.html#ab0cb6d6c10206acebbc06d2be204c2e7">getID</a>());
<a name="l01855"></a>01855     }
<a name="l01856"></a>01856       <span class="keywordflow">break</span>;
<a name="l01857"></a>01857       
<a name="l01858"></a>01858     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaddba04b27f5a8c99ae4edac90bdf939">RadiationCavityAnalysis::G_MATRIX</a>:
<a name="l01859"></a>01859     {
<a name="l01860"></a>01860       name = <span class="stringliteral">&quot;G_matrix&quot;</span>;
<a name="l01861"></a>01861       name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l01862"></a>01862       name += rad_num.str();
<a name="l01863"></a>01863       name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l01864"></a>01864       data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a>);
<a name="l01865"></a>01865       data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l01866"></a>01866       data_info-&gt;setName(name);
<a name="l01867"></a>01867     }
<a name="l01868"></a>01868       <span class="keywordflow">break</span>;
<a name="l01869"></a>01869       
<a name="l01870"></a>01870     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ab3e00964c9ce893d80049b2b2daf4967">RadiationCavityAnalysis::G_MATRIX_SENSITIVITY</a>:
<a name="l01871"></a>01871     {
<a name="l01872"></a>01872       data_info.reset(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a15c6ef55ace32a38f7b37339187abc95">getDataInfoForQty</a>(<a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aaddba04b27f5a8c99ae4edac90bdf939">RadiationCavityAnalysis::G_MATRIX</a>).release());
<a name="l01873"></a>01873       data_info-&gt;setDVID(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>().<a class="code" href="class_driver_1_1_analysis_driver.html#ac258e74334cc629c3961bde90f9e5fd9" title="returns the current design variable">getCurrentDesignParameter</a>().<a class="code" href="class_design_data_1_1_design_parameter.html#ab0cb6d6c10206acebbc06d2be204c2e7">getID</a>());
<a name="l01874"></a>01874     }
<a name="l01875"></a>01875       <span class="keywordflow">break</span>;
<a name="l01876"></a>01876       
<a name="l01877"></a>01877     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9abe6a1b3373498e2afa348361975f9ee9">RadiationCavityAnalysis::B_MATRIX</a>:
<a name="l01878"></a>01878     {
<a name="l01879"></a>01879       <span class="keywordflow">switch</span>(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#aaa6666781d3c78e003c9f8002aaeff16">getSolution</a>().<a class="code" href="class_solution_1_1_solution_base.html#a73528968dadb7365a70b0503032ef7c6">getDisciplineTransientNatureEnumID</a>
<a name="l01880"></a>01880              (Discipline::THERMAL_DISCIPLINE::num()))
<a name="l01881"></a>01881       {
<a name="l01882"></a>01882         <span class="keywordflow">case</span> <a class="code" href="_analysis_discipline_base_8h.html#ace90dda1960bb960e206bd0dbcc0c977">STEADY_STATE_SOLUTION_ENUM_ID</a>:
<a name="l01883"></a>01883         {
<a name="l01884"></a>01884           name = <span class="stringliteral">&quot;B_matrix&quot;</span>;
<a name="l01885"></a>01885           name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l01886"></a>01886           name += rad_num.str();
<a name="l01887"></a>01887           name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l01888"></a>01888           data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a>);
<a name="l01889"></a>01889           data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l01890"></a>01890           data_info-&gt;setLoadCase(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>().
<a name="l01891"></a>01891                                  getCurrentLoadCase());
<a name="l01892"></a>01892           data_info-&gt;setName(name);
<a name="l01893"></a>01893         }
<a name="l01894"></a>01894           <span class="keywordflow">break</span>;
<a name="l01895"></a>01895           
<a name="l01896"></a>01896         <span class="keywordflow">case</span> <a class="code" href="_analysis_discipline_base_8h.html#a742dfba20e2381d7d5389fc91a94c740">TRANSIENT_SOLUTION_ENUM_ID</a>:
<a name="l01897"></a>01897         {
<a name="l01898"></a>01898           name = <span class="stringliteral">&quot;B_matrix&quot;</span>;
<a name="l01899"></a>01899           name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l01900"></a>01900           name += rad_num.str();
<a name="l01901"></a>01901           name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l01902"></a>01902           <a class="code" href="class_driver_1_1_transient_analysis_driver.html" title="this forms the basis of all transient analysis drivers.">Driver::TransientAnalysisDriver</a>&amp; transient_driver = 
<a name="l01903"></a>01903           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_driver_1_1_transient_analysis_driver.html" title="this forms the basis of all transient analysis drivers.">Driver::TransientAnalysisDriver</a>&amp;<span class="keyword">&gt;</span>
<a name="l01904"></a>01904           (this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>());
<a name="l01905"></a>01905           
<a name="l01906"></a>01906           data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>);
<a name="l01907"></a>01907           data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l01908"></a>01908           data_info-&gt;setLoadCase(transient_driver.<a class="code" href="class_driver_1_1_analysis_driver.html#ad9f4c9e39727b9b9ba9fcbe7353e9c7f" title="returns the current load case number">getCurrentLoadCase</a>());
<a name="l01909"></a>01909           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>*<span class="keyword">&gt;</span>
<a name="l01910"></a>01910           (data_info.get())-&gt;setTransientIterationInfo(transient_driver.<a class="code" href="class_driver_1_1_transient_analysis_driver.html#ab9622f4ee33604c4d864d63f8cc93ef6">getCurrentIterationNumber</a>(),
<a name="l01911"></a>01911                                                        transient_driver.<a class="code" href="class_driver_1_1_transient_analysis_driver.html#aeb9ad9e6f71bacc09f168141428af9d5">getCurrentAnalysisTime</a>());
<a name="l01912"></a>01912           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>*<span class="keyword">&gt;</span>(data_info.get())-&gt;setOrder(0);
<a name="l01913"></a>01913           data_info-&gt;<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a117399f629d87ea1b646333d91dee39f" title="sets the name of the quantity">setName</a>(name);
<a name="l01914"></a>01914         }
<a name="l01915"></a>01915           <span class="keywordflow">break</span>;
<a name="l01916"></a>01916           
<a name="l01917"></a>01917         <span class="keywordflow">default</span>:
<a name="l01918"></a>01918           Assert(<span class="keyword">false</span>, ExcInternalError());
<a name="l01919"></a>01919           <span class="keywordflow">break</span>;
<a name="l01920"></a>01920       }
<a name="l01921"></a>01921     }
<a name="l01922"></a>01922       <span class="keywordflow">break</span>;
<a name="l01923"></a>01923       
<a name="l01924"></a>01924     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9aa8e253c18366682e146778d7d9c6d09e">RadiationCavityAnalysis::B_MATRIX_SENSITIVITY</a>:
<a name="l01925"></a>01925     {
<a name="l01926"></a>01926       data_info.reset(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#a15c6ef55ace32a38f7b37339187abc95">getDataInfoForQty</a>(<a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9abe6a1b3373498e2afa348361975f9ee9">RadiationCavityAnalysis::B_MATRIX</a>).release());
<a name="l01927"></a>01927       data_info-&gt;setDVID(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>().<a class="code" href="class_driver_1_1_analysis_driver.html#ac258e74334cc629c3961bde90f9e5fd9" title="returns the current design variable">getCurrentDesignParameter</a>().<a class="code" href="class_design_data_1_1_design_parameter.html#ab0cb6d6c10206acebbc06d2be204c2e7">getID</a>());
<a name="l01928"></a>01928     }
<a name="l01929"></a>01929       <span class="keywordflow">break</span>;
<a name="l01930"></a>01930       
<a name="l01931"></a>01931     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a82a5786d2a5fc2125c69c3b0c4b25795">RadiationCavityAnalysis::B_INVERSE_MATRIX</a>:
<a name="l01932"></a>01932     {
<a name="l01933"></a>01933       <span class="keywordflow">switch</span>(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#aaa6666781d3c78e003c9f8002aaeff16">getSolution</a>().<a class="code" href="class_solution_1_1_solution_base.html#a73528968dadb7365a70b0503032ef7c6">getDisciplineTransientNatureEnumID</a>
<a name="l01934"></a>01934              (Discipline::THERMAL_DISCIPLINE::num()))
<a name="l01935"></a>01935       {
<a name="l01936"></a>01936         <span class="keywordflow">case</span> <a class="code" href="_analysis_discipline_base_8h.html#ace90dda1960bb960e206bd0dbcc0c977">STEADY_STATE_SOLUTION_ENUM_ID</a>:
<a name="l01937"></a>01937         {
<a name="l01938"></a>01938           name = <span class="stringliteral">&quot;B_Inverse_Matrix&quot;</span>;
<a name="l01939"></a>01939           name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l01940"></a>01940           name += rad_num.str();
<a name="l01941"></a>01941           name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l01942"></a>01942           data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a>);
<a name="l01943"></a>01943           data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l01944"></a>01944           data_info-&gt;setLoadCase(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>().
<a name="l01945"></a>01945                                  getCurrentLoadCase());
<a name="l01946"></a>01946           data_info-&gt;setName(name);
<a name="l01947"></a>01947         }
<a name="l01948"></a>01948           <span class="keywordflow">break</span>;
<a name="l01949"></a>01949           
<a name="l01950"></a>01950         <span class="keywordflow">case</span> <a class="code" href="_analysis_discipline_base_8h.html#a742dfba20e2381d7d5389fc91a94c740">TRANSIENT_SOLUTION_ENUM_ID</a>:
<a name="l01951"></a>01951         {
<a name="l01952"></a>01952           name = <span class="stringliteral">&quot;B_Inverse_Matrix&quot;</span>;
<a name="l01953"></a>01953           name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l01954"></a>01954           name += rad_num.str();
<a name="l01955"></a>01955           name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l01956"></a>01956           <a class="code" href="class_driver_1_1_transient_analysis_driver.html" title="this forms the basis of all transient analysis drivers.">Driver::TransientAnalysisDriver</a>&amp; transient_driver = 
<a name="l01957"></a>01957           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_driver_1_1_transient_analysis_driver.html" title="this forms the basis of all transient analysis drivers.">Driver::TransientAnalysisDriver</a>&amp;<span class="keyword">&gt;</span>
<a name="l01958"></a>01958           (this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>());
<a name="l01959"></a>01959           
<a name="l01960"></a>01960           data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>);
<a name="l01961"></a>01961           data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l01962"></a>01962           data_info-&gt;setLoadCase(transient_driver.<a class="code" href="class_driver_1_1_analysis_driver.html#ad9f4c9e39727b9b9ba9fcbe7353e9c7f" title="returns the current load case number">getCurrentLoadCase</a>());
<a name="l01963"></a>01963           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>*<span class="keyword">&gt;</span>
<a name="l01964"></a>01964           (data_info.get())-&gt;setTransientIterationInfo(transient_driver.<a class="code" href="class_driver_1_1_transient_analysis_driver.html#ab9622f4ee33604c4d864d63f8cc93ef6">getCurrentIterationNumber</a>(),
<a name="l01965"></a>01965                                                        transient_driver.<a class="code" href="class_driver_1_1_transient_analysis_driver.html#aeb9ad9e6f71bacc09f168141428af9d5">getCurrentAnalysisTime</a>());
<a name="l01966"></a>01966           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>*<span class="keyword">&gt;</span>(data_info.get())-&gt;setOrder(0);
<a name="l01967"></a>01967           data_info-&gt;<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a117399f629d87ea1b646333d91dee39f" title="sets the name of the quantity">setName</a>(name);
<a name="l01968"></a>01968         }
<a name="l01969"></a>01969           <span class="keywordflow">break</span>;
<a name="l01970"></a>01970           
<a name="l01971"></a>01971         <span class="keywordflow">default</span>:
<a name="l01972"></a>01972           Assert(<span class="keyword">false</span>, ExcInternalError());
<a name="l01973"></a>01973           <span class="keywordflow">break</span>;
<a name="l01974"></a>01974       }
<a name="l01975"></a>01975     }
<a name="l01976"></a>01976       <span class="keywordflow">break</span>;
<a name="l01977"></a>01977                         
<a name="l01978"></a>01978     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9a706dd25ad60743b308702c7c244fc998">RadiationCavityAnalysis::FACTOR_MATRIX</a>:
<a name="l01979"></a>01979     {
<a name="l01980"></a>01980       <span class="keywordflow">switch</span>(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#aaa6666781d3c78e003c9f8002aaeff16">getSolution</a>().<a class="code" href="class_solution_1_1_solution_base.html#a73528968dadb7365a70b0503032ef7c6">getDisciplineTransientNatureEnumID</a>
<a name="l01981"></a>01981              (Discipline::THERMAL_DISCIPLINE::num()))
<a name="l01982"></a>01982       {
<a name="l01983"></a>01983         <span class="keywordflow">case</span> <a class="code" href="_analysis_discipline_base_8h.html#ace90dda1960bb960e206bd0dbcc0c977">STEADY_STATE_SOLUTION_ENUM_ID</a>:
<a name="l01984"></a>01984         {
<a name="l01985"></a>01985           name = <span class="stringliteral">&quot;Factor_matrix&quot;</span>;
<a name="l01986"></a>01986           name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l01987"></a>01987           name += rad_num.str();
<a name="l01988"></a>01988           name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l01989"></a>01989           data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a>);
<a name="l01990"></a>01990           data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l01991"></a>01991           data_info-&gt;setLoadCase(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>().
<a name="l01992"></a>01992                                  getCurrentLoadCase());
<a name="l01993"></a>01993           data_info-&gt;setName(name);
<a name="l01994"></a>01994         }
<a name="l01995"></a>01995           <span class="keywordflow">break</span>;
<a name="l01996"></a>01996           
<a name="l01997"></a>01997         <span class="keywordflow">case</span> <a class="code" href="_analysis_discipline_base_8h.html#a742dfba20e2381d7d5389fc91a94c740">TRANSIENT_SOLUTION_ENUM_ID</a>:
<a name="l01998"></a>01998         {
<a name="l01999"></a>01999           <a class="code" href="class_driver_1_1_transient_analysis_driver.html" title="this forms the basis of all transient analysis drivers.">Driver::TransientAnalysisDriver</a>&amp; transient_driver = 
<a name="l02000"></a>02000           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_driver_1_1_transient_analysis_driver.html" title="this forms the basis of all transient analysis drivers.">Driver::TransientAnalysisDriver</a>&amp;<span class="keyword">&gt;</span>
<a name="l02001"></a>02001           (this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>());
<a name="l02002"></a>02002           
<a name="l02003"></a>02003           name = <span class="stringliteral">&quot;Factor_matrix&quot;</span>;
<a name="l02004"></a>02004           name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l02005"></a>02005           name += rad_num.str();
<a name="l02006"></a>02006           name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l02007"></a>02007           data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>);
<a name="l02008"></a>02008           data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l02009"></a>02009           data_info-&gt;setLoadCase(transient_driver.<a class="code" href="class_driver_1_1_analysis_driver.html#ad9f4c9e39727b9b9ba9fcbe7353e9c7f" title="returns the current load case number">getCurrentLoadCase</a>());
<a name="l02010"></a>02010           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>*<span class="keyword">&gt;</span>
<a name="l02011"></a>02011           (data_info.get())-&gt;setTransientIterationInfo(transient_driver.<a class="code" href="class_driver_1_1_transient_analysis_driver.html#ab9622f4ee33604c4d864d63f8cc93ef6">getCurrentIterationNumber</a>(),
<a name="l02012"></a>02012                                                        transient_driver.<a class="code" href="class_driver_1_1_transient_analysis_driver.html#aeb9ad9e6f71bacc09f168141428af9d5">getCurrentAnalysisTime</a>());
<a name="l02013"></a>02013           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>*<span class="keyword">&gt;</span>(data_info.get())-&gt;setOrder(0);
<a name="l02014"></a>02014           data_info-&gt;<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a117399f629d87ea1b646333d91dee39f" title="sets the name of the quantity">setName</a>(name);
<a name="l02015"></a>02015         }
<a name="l02016"></a>02016           <span class="keywordflow">break</span>;
<a name="l02017"></a>02017           
<a name="l02018"></a>02018         <span class="keywordflow">default</span>:
<a name="l02019"></a>02019           Assert(<span class="keyword">false</span>, ExcInternalError());
<a name="l02020"></a>02020           <span class="keywordflow">break</span>;
<a name="l02021"></a>02021       }
<a name="l02022"></a>02022     }
<a name="l02023"></a>02023       <span class="keywordflow">break</span>;
<a name="l02024"></a>02024       
<a name="l02025"></a>02025     <span class="keywordflow">case</span>  <a class="code" href="class_radiation_cavity_analysis.html#aa6d260d026c174d590d65b920d0cd6e9ada425f7476e4534bd9684e2d4fab9ce0">RadiationCavityAnalysis::AB_INV_MATRIX</a>:
<a name="l02026"></a>02026     {
<a name="l02027"></a>02027       <span class="keywordflow">switch</span>(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#aaa6666781d3c78e003c9f8002aaeff16">getSolution</a>().<a class="code" href="class_solution_1_1_solution_base.html#a73528968dadb7365a70b0503032ef7c6">getDisciplineTransientNatureEnumID</a>
<a name="l02028"></a>02028              (Discipline::THERMAL_DISCIPLINE::num()))
<a name="l02029"></a>02029       {
<a name="l02030"></a>02030         <span class="keywordflow">case</span> <a class="code" href="_analysis_discipline_base_8h.html#ace90dda1960bb960e206bd0dbcc0c977">STEADY_STATE_SOLUTION_ENUM_ID</a>:
<a name="l02031"></a>02031         {
<a name="l02032"></a>02032           name = <span class="stringliteral">&quot;AB_Inv_matrix&quot;</span>;
<a name="l02033"></a>02033           name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l02034"></a>02034           name += rad_num.str();
<a name="l02035"></a>02035           name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l02036"></a>02036           data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_independent_data_info.html" title="this defines a time independent quantity">FESystemDatabase::TimeIndependentDataInfo</a>);
<a name="l02037"></a>02037           data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l02038"></a>02038           data_info-&gt;setLoadCase(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>().
<a name="l02039"></a>02039                                  getCurrentLoadCase());
<a name="l02040"></a>02040           data_info-&gt;setName(name);
<a name="l02041"></a>02041         }
<a name="l02042"></a>02042           <span class="keywordflow">break</span>;
<a name="l02043"></a>02043           
<a name="l02044"></a>02044         <span class="keywordflow">case</span> <a class="code" href="_analysis_discipline_base_8h.html#a742dfba20e2381d7d5389fc91a94c740">TRANSIENT_SOLUTION_ENUM_ID</a>:
<a name="l02045"></a>02045         {
<a name="l02046"></a>02046           <a class="code" href="class_driver_1_1_transient_analysis_driver.html" title="this forms the basis of all transient analysis drivers.">Driver::TransientAnalysisDriver</a>&amp; transient_driver = 
<a name="l02047"></a>02047           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_driver_1_1_transient_analysis_driver.html" title="this forms the basis of all transient analysis drivers.">Driver::TransientAnalysisDriver</a>&amp;<span class="keyword">&gt;</span>
<a name="l02048"></a>02048           (this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a2f9cc3c81e1363d685cb65aeb6e91d80">getAnalysisDriver</a>());
<a name="l02049"></a>02049           
<a name="l02050"></a>02050           name = <span class="stringliteral">&quot;AB_Inv_matrix&quot;</span>;
<a name="l02051"></a>02051           name += <span class="stringliteral">&quot;_Cavity_&quot;</span>;
<a name="l02052"></a>02052           name += rad_num.str();
<a name="l02053"></a>02053           name += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l02054"></a>02054           data_info.reset(<span class="keyword">new</span> <a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>);
<a name="l02055"></a>02055           data_info-&gt;setDisciplineEnumID(Discipline::RADIATION_DISCIPLINE::num());
<a name="l02056"></a>02056           data_info-&gt;setLoadCase(transient_driver.<a class="code" href="class_driver_1_1_analysis_driver.html#ad9f4c9e39727b9b9ba9fcbe7353e9c7f" title="returns the current load case number">getCurrentLoadCase</a>());
<a name="l02057"></a>02057           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>*<span class="keyword">&gt;</span>
<a name="l02058"></a>02058           (data_info.get())-&gt;setTransientIterationInfo(transient_driver.<a class="code" href="class_driver_1_1_transient_analysis_driver.html#ab9622f4ee33604c4d864d63f8cc93ef6">getCurrentIterationNumber</a>(),
<a name="l02059"></a>02059                                                        transient_driver.<a class="code" href="class_driver_1_1_transient_analysis_driver.html#aeb9ad9e6f71bacc09f168141428af9d5">getCurrentAnalysisTime</a>());
<a name="l02060"></a>02060           <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_f_e_system_database_1_1_time_dependent_data_info.html" title="this defines a time dependent quantity">FESystemDatabase::TimeDependentDataInfo</a>*<span class="keyword">&gt;</span>(data_info.get())-&gt;setOrder(0);
<a name="l02061"></a>02061           data_info-&gt;<a class="code" href="class_f_e_system_database_1_1_generic_data_info_base.html#a117399f629d87ea1b646333d91dee39f" title="sets the name of the quantity">setName</a>(name);
<a name="l02062"></a>02062         }
<a name="l02063"></a>02063           <span class="keywordflow">break</span>;
<a name="l02064"></a>02064           
<a name="l02065"></a>02065         <span class="keywordflow">default</span>:
<a name="l02066"></a>02066           Assert(<span class="keyword">false</span>, ExcInternalError());
<a name="l02067"></a>02067           <span class="keywordflow">break</span>;
<a name="l02068"></a>02068       }
<a name="l02069"></a>02069     }
<a name="l02070"></a>02070       <span class="keywordflow">break</span>;
<a name="l02071"></a>02071       
<a name="l02072"></a>02072       
<a name="l02073"></a>02073     <span class="keywordflow">default</span>:
<a name="l02074"></a>02074       Assert(<span class="keyword">false</span>, ExcInternalError());
<a name="l02075"></a>02075       <span class="keywordflow">break</span>;
<a name="l02076"></a>02076   }
<a name="l02077"></a>02077   
<a name="l02078"></a>02078   <span class="keywordflow">return</span> data_info;
<a name="l02079"></a>02079 }
<a name="l02080"></a>02080 
<a name="l02081"></a>02081 
<a name="l02082"></a>02082 
<a name="l02083"></a>02083 
<a name="l02084"></a>02084 
<a name="l02085"></a>02085 <span class="keywordtype">void</span>
<a name="l02086"></a>02086 <a class="code" href="class_radiation_cavity_analysis.html#a3db1f2f4043524354d149fe910fd72df" title="initializes the property card at the specified temperature">RadiationCavityAnalysis::initializePropertyCardAtElementTemperature</a>
<a name="l02087"></a><a class="code" href="class_radiation_cavity_analysis.html#a3db1f2f4043524354d149fe910fd72df">02087</a> (<a class="code" href="class_elem_data_card.html">ElemDataCard</a>&amp; elem_data_card, 
<a name="l02088"></a>02088  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rad_elem_ID)
<a name="l02089"></a>02089 {
<a name="l02090"></a>02090   <span class="comment">// now initialize the property card at the specified value.</span>
<a name="l02091"></a>02091   <span class="comment">// if the properties are temperature dependent, then initialize the</span>
<a name="l02092"></a>02092   <span class="comment">// element property cards at the element average temperature</span>
<a name="l02093"></a>02093   <span class="keywordflow">if</span> (this-&gt;thermal_discipline.checkPropertyDependenceOnTemperature())
<a name="l02094"></a>02094     {
<a name="l02095"></a>02095       Assert(this-&gt;fe_nodal_temp_vector != NULL, ExcEmptyObject());
<a name="l02096"></a>02096       
<a name="l02097"></a>02097       <span class="comment">// calculate the average of the nodal temperature of the finite element </span>
<a name="l02098"></a>02098       <span class="comment">// to which the specified radiation element belongs.</span>
<a name="l02099"></a>02099       <span class="keyword">static</span> std::vector&lt;unsigned int&gt; fe_node_ID_vec;
<a name="l02100"></a>02100       fe_node_ID_vec.clear();
<a name="l02101"></a>02101       
<a name="l02102"></a>02102       <span class="comment">// get the vector of internal node IDs</span>
<a name="l02103"></a>02103       this-&gt;radiation_cavity.getInternalNodeIDForRadElem
<a name="l02104"></a>02104       (rad_elem_ID, fe_node_ID_vec);
<a name="l02105"></a>02105       
<a name="l02106"></a>02106       <span class="keywordtype">double</span> value = 0.0;
<a name="l02107"></a>02107       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; fe_node_ID_vec.size(); i++)
<a name="l02108"></a>02108         value += this-&gt;fe_nodal_temp_vector-&gt;el(fe_node_ID_vec[i]);
<a name="l02109"></a>02109       
<a name="l02110"></a>02110       value /= (1.0 * fe_node_ID_vec.size());
<a name="l02111"></a>02111       
<a name="l02112"></a>02112       <span class="keyword">static</span> std::map&lt;unsigned int, double&gt; local_param_map;    
<a name="l02113"></a>02113       
<a name="l02114"></a>02114       local_param_map[Property::TEMPERATURE::num()] = value; 
<a name="l02115"></a>02115       elem_data_card.<a class="code" href="class_elem_data_card.html#a7c638e4644afb12563e60ca3235c1eba" title="initializes the card and the material card for the given local parameters">reinitElemAndMaterialCardForLocalParameters</a>(&amp;local_param_map);
<a name="l02116"></a>02116     }
<a name="l02117"></a>02117   <span class="keywordflow">else</span>
<a name="l02118"></a>02118     {
<a name="l02119"></a>02119       elem_data_card.<a class="code" href="class_elem_data_card.html#a7c638e4644afb12563e60ca3235c1eba" title="initializes the card and the material card for the given local parameters">reinitElemAndMaterialCardForLocalParameters</a>();
<a name="l02120"></a>02120     }
<a name="l02121"></a>02121   
<a name="l02122"></a>02122 }
<a name="l02123"></a>02123 
<a name="l02124"></a>02124 
<a name="l02125"></a>02125 <span class="keywordtype">void</span>
<a name="l02126"></a><a class="code" href="class_radiation_cavity_analysis.html#af707b1f733c9f12a5d791d18c74efc47">02126</a> <a class="code" href="class_radiation_cavity_analysis.html#af707b1f733c9f12a5d791d18c74efc47" title="clears the property card initialization">RadiationCavityAnalysis::clearPropertyCardInitialization</a>(<a class="code" href="class_elem_data_card.html">ElemDataCard</a>&amp; elem_data_card)
<a name="l02127"></a>02127 {
<a name="l02128"></a>02128   <span class="keyword">static</span> std::vector&lt;unsigned int&gt; param_vec;
<a name="l02129"></a>02129   <span class="keyword">static</span> std::vector&lt;unsigned int&gt; no_param_vec;
<a name="l02130"></a>02130   
<a name="l02131"></a>02131   <span class="keywordflow">if</span> (param_vec.size() == 0)
<a name="l02132"></a>02132     param_vec.push_back(Property::TEMPERATURE::num());
<a name="l02133"></a>02133   
<a name="l02134"></a>02134   <span class="comment">// if the properties are temperature dependent, then initialize the</span>
<a name="l02135"></a>02135   <span class="comment">// element property cards at the element average temperature</span>
<a name="l02136"></a>02136   <span class="keywordflow">if</span>(this-&gt;<a class="code" href="class_radiation_cavity_analysis.html#af3c8a31a3265b0251b89b5e7773c2d29" title="reference to the thermal analysis discipline that owns this object">thermal_discipline</a>.<a class="code" href="class_discipline_1_1_analysis_discipline_base.html#a6dc9ef38729f861b96bf31634e24b5d0" title="checks if the analysis is dependent on temperature">checkPropertyDependenceOnTemperature</a>())
<a name="l02137"></a>02137     elem_data_card.<a class="code" href="class_elem_data_card.html#ab50a2a6c9317349ae278ad3859c103b5">partialClearElemAndMaterialCardLocalParameterInitialization</a>
<a name="l02138"></a>02138     (param_vec);
<a name="l02139"></a>02139   <span class="keywordflow">else</span>
<a name="l02140"></a>02140     elem_data_card.<a class="code" href="class_elem_data_card.html#ab50a2a6c9317349ae278ad3859c103b5">partialClearElemAndMaterialCardLocalParameterInitialization</a>
<a name="l02141"></a>02141     (no_param_vec);
<a name="l02142"></a>02142 }
<a name="l02143"></a>02143 
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 12 2012 18:06:17 for fesystem by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
