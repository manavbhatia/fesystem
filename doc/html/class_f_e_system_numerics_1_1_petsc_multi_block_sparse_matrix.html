<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>fesystem: FESystemNumerics::PetscMultiBlockSparseMatrix&lt; T &gt; Class Template Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">fesystem
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespace_f_e_system_numerics.html">FESystemNumerics</a>      </li>
      <li class="navelem"><a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html">PetscMultiBlockSparseMatrix</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">FESystemNumerics::PetscMultiBlockSparseMatrix&lt; T &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="FESystemNumerics::PetscMultiBlockSparseMatrix" --><!-- doxytag: inherits="FESystemNumerics::MultiBlockSparseMatrix" -->
<p>this class works with Petsc matrices to create a compound matrix  
 <a href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_multi_block_sparse_matrix_8h_source.html">MultiBlockSparseMatrix.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for FESystemNumerics::PetscMultiBlockSparseMatrix&lt; T &gt;:</div>
<div class="dyncontent">
<div class="center"><img src="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix__inherit__graph.gif" border="0" usemap="#_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix_3_01_t_01_4_inherit__map" alt="Inheritance graph"/></div>
<map name="_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix_3_01_t_01_4_inherit__map" id="_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix_3_01_t_01_4_inherit__map">
<area shape="rect" id="node2" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html" title="FESystemNumerics::MultiBlockSparseMatrix\&lt; T \&gt;" alt="" coords="22,6,337,34"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for FESystemNumerics::PetscMultiBlockSparseMatrix&lt; T &gt;:</div>
<div class="dyncontent">
<div class="center"><img src="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix__coll__graph.gif" border="0" usemap="#_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix_3_01_t_01_4_coll__map" alt="Collaboration graph"/></div>
<map name="_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix_3_01_t_01_4_coll__map" id="_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix_3_01_t_01_4_coll__map">
<area shape="rect" id="node2" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html" title="FESystemNumerics::MultiBlockSparseMatrix\&lt; T \&gt;" alt="" coords="22,6,337,34"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#af8fcac65a6ee8ddf149900a9b745d331">PetscMultiBlockSparseMatrix</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">constructor  <a href="#af8fcac65a6ee8ddf149900a9b745d331"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a66f5e3817b62ddd5ae45f6ffca7b099b">~PetscMultiBlockSparseMatrix</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">destructor  <a href="#a66f5e3817b62ddd5ae45f6ffca7b099b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a67a56da519a6397556ac17a634b86e72">update</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">updates the matrix from its original submatrices  <a href="#a67a56da519a6397556ac17a634b86e72"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#ac3013d48d208d9bee69c057f59a9a968">initRightVector</a> (NumericVector&lt; T &gt; &amp;vec)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#adc08804b1cd44c4f673e892a9b5417a0">extractFromRightMultiblockVector</a> (unsigned int col_block_num, NumericVector&lt; T &gt; &amp;in_v, NumericVector&lt; T &gt; &amp;out_v)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">extract the vector from the multiblock vector. The right vector is assumed here  <a href="#adc08804b1cd44c4f673e892a9b5417a0"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#af79af69d6732891ee5a9e9815627f220">finalizeSparsity</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">finalize sparsity so that only value changes are allowed after this  <a href="#af79af69d6732891ee5a9e9815627f220"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">Mat&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a0c4bcf9f1062be658b4b7033ae1ac628">petsc_mat</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">petsc matrix object for this matrix  <a href="#a0c4bcf9f1062be658b4b7033ae1ac628"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><h3>template&lt;typename T&gt;<br/>
class FESystemNumerics::PetscMultiBlockSparseMatrix&lt; T &gt;</h3>

<p>this class works with Petsc matrices to create a compound matrix </p>

<p>Definition at line <a class="el" href="_multi_block_sparse_matrix_8h_source.html#l00117">117</a> of file <a class="el" href="_multi_block_sparse_matrix_8h_source.html">MultiBlockSparseMatrix.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="af8fcac65a6ee8ddf149900a9b745d331"></a><!-- doxytag: member="FESystemNumerics::PetscMultiBlockSparseMatrix::PetscMultiBlockSparseMatrix" ref="af8fcac65a6ee8ddf149900a9b745d331" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html">FESystemNumerics::PetscMultiBlockSparseMatrix</a>&lt; T &gt;::<a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html">PetscMultiBlockSparseMatrix</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>constructor </p>

<p>Definition at line <a class="el" href="_multi_block_sparse_matrix_8_c_source.html#l00138">138</a> of file <a class="el" href="_multi_block_sparse_matrix_8_c_source.html">MultiBlockSparseMatrix.C</a>.</p>
<div class="fragment"><pre class="fragment">                                                                           :
MultiBlockSparseMatrix&lt;T&gt;()
{
  
}
</pre></div>
</div>
</div>
<a class="anchor" id="a66f5e3817b62ddd5ae45f6ffca7b099b"></a><!-- doxytag: member="FESystemNumerics::PetscMultiBlockSparseMatrix::~PetscMultiBlockSparseMatrix" ref="a66f5e3817b62ddd5ae45f6ffca7b099b" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html">FESystemNumerics::PetscMultiBlockSparseMatrix</a>&lt; T &gt;::~<a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html">PetscMultiBlockSparseMatrix</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>destructor </p>

<p>Definition at line <a class="el" href="_multi_block_sparse_matrix_8_c_source.html#l00148">148</a> of file <a class="el" href="_multi_block_sparse_matrix_8_c_source.html">MultiBlockSparseMatrix.C</a>.</p>
<div class="fragment"><pre class="fragment">{
  
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="adc08804b1cd44c4f673e892a9b5417a0"></a><!-- doxytag: member="FESystemNumerics::PetscMultiBlockSparseMatrix::extractFromRightMultiblockVector" ref="adc08804b1cd44c4f673e892a9b5417a0" args="(unsigned int col_block_num, NumericVector&lt; T &gt; &amp;in_v, NumericVector&lt; T &gt; &amp;out_v)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html">FESystemNumerics::PetscMultiBlockSparseMatrix</a>&lt; T &gt;::<a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#adc08804b1cd44c4f673e892a9b5417a0">extractFromRightMultiblockVector</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>col_block_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NumericVector&lt; T &gt; &amp;&#160;</td>
          <td class="paramname"><em>in_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NumericVector&lt; T &gt; &amp;&#160;</td>
          <td class="paramname"><em>out_v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>extract the vector from the multiblock vector. The right vector is assumed here </p>

<p>Implements <a class="el" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#a25937e01b436f87f0003d3d1455af118">FESystemNumerics::MultiBlockSparseMatrix&lt; T &gt;</a>.</p>

<p>Definition at line <a class="el" href="_multi_block_sparse_matrix_8_c_source.html#l00457">457</a> of file <a class="el" href="_multi_block_sparse_matrix_8_c_source.html">MultiBlockSparseMatrix.C</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">// it is assumed that the vectors have been correctly initialized with respect</span>
  <span class="comment">// to the global and the block matrices</span>
  
  Assert(this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac2cdf6e259e09022404e536714dbbc10" title="boolean indicating if sparsity pattern has been finalized">finalized_sparsity</a>, ExcInternalError());
  Assert(col_block_num &lt; this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#af85bcac802c30db9e282f5a3e0ebd255" title="number of sub-matrices in the row direction">row_dimension</a>, ExcInternalError());
  
  <span class="comment">// total number of rows and columns </span>
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> total_columns = 0, starting_id = 0; 
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#aaf49b71f7c259509917b7acb854c87a9" title="number of sub-matrices in the column direction">column_dimension</a>; i++) 
    {
      total_columns += this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[i]; 
      <span class="keywordflow">if</span> (i &lt; col_block_num) 
        starting_id += this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[i]; 
    }
  
  Assert(in_v.size() == total_columns, ExcInternalError());
  Assert(out_v.size() == this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[col_block_num],
         ExcInternalError());

  std::vector&lt;unsigned int&gt; ids(out_v.size());
  Utility::iota (ids.begin(), ids.end(), starting_id);
  
  in_v.create_subvector(out_v, ids);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af79af69d6732891ee5a9e9815627f220"></a><!-- doxytag: member="FESystemNumerics::PetscMultiBlockSparseMatrix::finalizeSparsity" ref="af79af69d6732891ee5a9e9815627f220" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html">FESystemNumerics::PetscMultiBlockSparseMatrix</a>&lt; T &gt;::<a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#af79af69d6732891ee5a9e9815627f220">finalizeSparsity</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>finalize sparsity so that only value changes are allowed after this </p>

<p>Implements <a class="el" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#a0765106e44a78ec78c9350985900d82e">FESystemNumerics::MultiBlockSparseMatrix&lt; T &gt;</a>.</p>

<p>Definition at line <a class="el" href="_multi_block_sparse_matrix_8_c_source.html#l00157">157</a> of file <a class="el" href="_multi_block_sparse_matrix_8_c_source.html">MultiBlockSparseMatrix.C</a>.</p>

<p>References <a class="el" href="_f_e_system_common_8h_source.html#l00013">FESystem::COMM_WORLD</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">// make sure that the sparsity has not been finalized. </span>
  Assert(this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac2cdf6e259e09022404e536714dbbc10" title="boolean indicating if sparsity pattern has been finalized">finalized_sparsity</a> == <span class="keyword">false</span>, ExcInternalError());
  
  <span class="comment">// get the dimensions of the finale matrix</span>
  this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad5f75ac654932a164ebc8c1af61fa025" title="stores the number of rows in each row-wise block">rows_per_row_wise_block</a>.resize(this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#af85bcac802c30db9e282f5a3e0ebd255" title="number of sub-matrices in the row direction">row_dimension</a>);
  this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>.resize(this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#aaf49b71f7c259509917b7acb854c87a9" title="number of sub-matrices in the column direction">column_dimension</a>);
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> total_n_rows = 0, total_n_columns = 0, elem_num = 0;
  
  <span class="comment">// fill the vector with zeros</span>
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#af85bcac802c30db9e282f5a3e0ebd255" title="number of sub-matrices in the row direction">row_dimension</a>; i++)
    this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad5f75ac654932a164ebc8c1af61fa025" title="stores the number of rows in each row-wise block">rows_per_row_wise_block</a>[i] = 0;
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#aaf49b71f7c259509917b7acb854c87a9" title="number of sub-matrices in the column direction">column_dimension</a>; i++)
    this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[i] = 0;
  
  <span class="comment">// iterate over all the submatrices and close them</span>
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad60655e7309b73dcb410d4b3459d05a7">sub_matrices</a>.size(); i++)
    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad60655e7309b73dcb410d4b3459d05a7">sub_matrices</a>[i] != NULL)
      this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad60655e7309b73dcb410d4b3459d05a7">sub_matrices</a>[i]-&gt;close();
  
  <span class="comment">// in the process, also make sure that the number of rows and columns of the matrices </span>
  <span class="comment">// consistent</span>
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#af85bcac802c30db9e282f5a3e0ebd255" title="number of sub-matrices in the row direction">row_dimension</a>; i++)
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j &lt; this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#aaf49b71f7c259509917b7acb854c87a9" title="number of sub-matrices in the column direction">column_dimension</a>; j++)
      {
        elem_num = i * this-&gt;column_dimension + j;
        SparseMatrix&lt;T&gt;* mat = this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad60655e7309b73dcb410d4b3459d05a7">sub_matrices</a>[elem_num];
        
        <span class="comment">// if the size is zero, check if you can set it. If it is non-zero, then </span>
        <span class="comment">// make sure the size is consistent</span>
        
        <span class="comment">// check for row size</span>
        <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad5f75ac654932a164ebc8c1af61fa025" title="stores the number of rows in each row-wise block">rows_per_row_wise_block</a>[i] == 0)
          {<span class="keywordflow">if</span> (mat != NULL) this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad5f75ac654932a164ebc8c1af61fa025" title="stores the number of rows in each row-wise block">rows_per_row_wise_block</a>[i] = mat-&gt;m();}
        <span class="keywordflow">else</span>
          {<span class="keywordflow">if</span> (mat != NULL) 
            Assert(this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad5f75ac654932a164ebc8c1af61fa025" title="stores the number of rows in each row-wise block">rows_per_row_wise_block</a>[i] == mat-&gt;m(), ExcInternalError());}

        <span class="comment">// check for column size</span>
        <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[j] == 0)
          {<span class="keywordflow">if</span> (mat != NULL) this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[j] = mat-&gt;n();}
        <span class="keywordflow">else</span>
          {<span class="keywordflow">if</span> (mat != NULL)
            Assert(this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[i] == mat-&gt;n(), ExcInternalError());}
      }
  
  <span class="comment">// calculate the dimensions</span>
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#af85bcac802c30db9e282f5a3e0ebd255" title="number of sub-matrices in the row direction">row_dimension</a>; i++)
    total_n_rows += this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad5f75ac654932a164ebc8c1af61fa025" title="stores the number of rows in each row-wise block">rows_per_row_wise_block</a>[i];
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#aaf49b71f7c259509917b7acb854c87a9" title="number of sub-matrices in the column direction">column_dimension</a>; i++)
    total_n_columns += this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[i];
  
  <span class="comment">// next calculate the number of non-zero columns per row</span>
  std::vector&lt;unsigned int&gt; nonzeros_per_row(total_n_rows);
  std::fill (nonzeros_per_row.begin(), nonzeros_per_row.end(), 0);

  <span class="keywordtype">int</span> starting_row_id = 0, starting_col_id=0, row_num = 0,
  n_rows =0, n_cols = 0, next_elem_in_id_vec = 0;
  PetscErrorCode ierr = 0;

  <span class="comment">// next, set the number of nonzero entries in the matrix </span>
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#af85bcac802c30db9e282f5a3e0ebd255" title="number of sub-matrices in the row direction">row_dimension</a>; i++)
    {
      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad5f75ac654932a164ebc8c1af61fa025" title="stores the number of rows in each row-wise block">rows_per_row_wise_block</a>[i]; k++)
        {
          <span class="comment">// iterate over each matrix for this row and get the values to fill </span>
          <span class="comment">// into the multiblock matrix</span>
          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#aaf49b71f7c259509917b7acb854c87a9" title="number of sub-matrices in the column direction">column_dimension</a>; j++)
            {
              elem_num = i * this-&gt;column_dimension + j;
              SparseMatrix&lt;T&gt;* mat = this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad60655e7309b73dcb410d4b3459d05a7">sub_matrices</a>[elem_num];
              <span class="keywordflow">if</span> (mat != NULL)
                {
                  Mat pmat = <span class="keyword">dynamic_cast&lt;</span>PetscMatrix&lt;T&gt;*<span class="keyword">&gt;</span> (mat)-&gt;mat();
                  <span class="comment">// get the row ij indices</span>
                  ierr = MatGetSize(pmat, &amp;n_rows, &amp;n_cols);
                  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>,ierr);
                  Assert(n_rows == this-&gt;rows_per_row_wise_block[i], ExcInternalError());
                  Assert(n_cols == this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[j], ExcInternalError());
                  
                  <span class="keyword">const</span> PetscInt *petsc_col_ids = PETSC_NULL;
                  <span class="keyword">const</span> PetscScalar *petsc_vals = PETSC_NULL;
                  <span class="comment">// iterate over the rows in this matrix</span>
                  <span class="keywordtype">int</span> n_cols_in_row = 0;
                  ierr = MatGetRow(pmat, k, &amp;n_cols_in_row, &amp;petsc_col_ids, &amp;petsc_vals);
                  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>,ierr);
                  
                  nonzeros_per_row[starting_row_id + k] += n_cols_in_row;
                  
                  <span class="comment">// now restore the matrix row</span>
                  ierr = MatRestoreRow(pmat, k, &amp;n_cols_in_row, &amp;petsc_col_ids, &amp;petsc_vals);
                  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>,ierr);
                }
              <span class="keywordflow">else</span>
                {
                  <span class="comment">// add the diagonal entry, since that will be necessary for the </span>
                  <span class="comment">// linear/eigen solvers </span>
                  nonzeros_per_row[starting_row_id + k] += 1; 
                }
            }
        }
      starting_row_id += this-&gt;rows_per_row_wise_block[i];
    }
  
  <span class="comment">// now that the sparsity pattern is available, set it for the matrix </span>
  ierr = MatCreateSeqAIJ(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, total_n_rows, total_n_columns,
                         PETSC_DEFAULT, (PetscInt*)&amp;(nonzeros_per_row[0]), &amp;(this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a0c4bcf9f1062be658b4b7033ae1ac628" title="petsc matrix object for this matrix">petsc_mat</a>));
  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>,ierr);
  
  <span class="comment">// now create the sparse matrix object</span>
  this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#a1d957ba8f88dd4cb4438163e5fb7c9ae" title="pointer to the sparse-matrix object that stores the actual matrix">matrix</a>.reset(<span class="keyword">new</span> PetscMatrix&lt;double&gt;(this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a0c4bcf9f1062be658b4b7033ae1ac628" title="petsc matrix object for this matrix">petsc_mat</a>));
  <span class="comment">//this-&gt;matrix-&gt;close();</span>

  <span class="comment">//</span>
  <span class="comment">// now that the matrix is created, we will update the sparsity pattern of the matrix</span>
  <span class="comment">//</span>
  
  <span class="comment">// this column is used to fill the values for each row. The size is kept constant</span>
  <span class="comment">// and all values are kept as 1.0. Once the sparsity is set, the matrix anyway will </span>
  <span class="comment">// be zeroes out. </span>
  std::vector&lt;double&gt; vals(total_n_columns);
  std::fill(vals.begin(), vals.end(), 1.0);
  <span class="comment">// this is the vector of column ids that will be used to store the matrix </span>
  std::vector&lt;int&gt; col_ids(total_n_columns);
  std::fill(col_ids.begin(), col_ids.end(), -1.0);
  
  starting_row_id = 0, starting_col_id=0, row_num = 0,
  n_rows =0, n_cols = 0, next_elem_in_id_vec = 0;
  
  <span class="comment">// next, set the values of the matrix entries</span>
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#af85bcac802c30db9e282f5a3e0ebd255" title="number of sub-matrices in the row direction">row_dimension</a>; i++)
    {
      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;this-&gt;rows_per_row_wise_block[i]; k++)
        {
          std::fill(col_ids.begin(), col_ids.end(), -1.0);
          <span class="comment">// iterate over each matrix for this row and get the values to fill </span>
          <span class="comment">// into the multiblock matrix</span>
          starting_col_id = 0;
          next_elem_in_id_vec = 0;
          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#aaf49b71f7c259509917b7acb854c87a9" title="number of sub-matrices in the column direction">column_dimension</a>; j++)
            {
              elem_num = i * this-&gt;column_dimension + j;
              SparseMatrix&lt;T&gt;* mat = this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad60655e7309b73dcb410d4b3459d05a7">sub_matrices</a>[elem_num];
              <span class="keywordflow">if</span> (mat != NULL)
                {
                  Mat pmat = <span class="keyword">dynamic_cast&lt;</span>PetscMatrix&lt;T&gt;*<span class="keyword">&gt;</span> (mat)-&gt;mat();
                  <span class="comment">// get the row ij indices</span>
                  ierr = MatGetSize(pmat, &amp;n_rows, &amp;n_cols);
                  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>,ierr);
                  Assert(n_rows == this-&gt;rows_per_row_wise_block[i], ExcInternalError());
                  Assert(n_cols == this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[j], ExcInternalError());
                  
                  <span class="keyword">const</span> PetscInt *petsc_col_ids = PETSC_NULL;
                  <span class="keyword">const</span> PetscScalar *petsc_vals = PETSC_NULL;
                  <span class="comment">// iterate over the rows in this matrix</span>
                  <span class="keywordtype">int</span> n_cols_in_row = 0;
                  ierr = MatGetRow(pmat, k, &amp;n_cols_in_row, &amp;petsc_col_ids, &amp;petsc_vals);
                  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>,ierr);
                  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l=0; l&lt;n_cols_in_row; l++)
                    col_ids[next_elem_in_id_vec+l] = starting_col_id + petsc_col_ids[l];
                  next_elem_in_id_vec += n_cols_in_row;
                  
                  <span class="comment">// now restore the matrix row</span>
                  ierr = MatRestoreRow(pmat, k, &amp;n_cols_in_row, &amp;petsc_col_ids, &amp;petsc_vals);
                  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>,ierr);
                }
              <span class="keywordflow">else</span>
                {
                  <span class="comment">// add the diagonal entry, since that will be necessary for the </span>
                  <span class="comment">// linear/eigen solvers </span>
                  col_ids[next_elem_in_id_vec] = starting_col_id + k; 
                  next_elem_in_id_vec += 1;
                }
              
              starting_col_id += this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[j];
            }

          row_num = starting_row_id + k;
          <span class="comment">// now tell the matrix to set the values for this row</span>
          ierr = MatSetValues (this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a0c4bcf9f1062be658b4b7033ae1ac628" title="petsc matrix object for this matrix">petsc_mat</a>,
                               1, (PetscInt*) &amp;(row_num),
                               (PetscInt) (nonzeros_per_row[starting_row_id + k]),
                               (PetscInt*) &amp;(col_ids[0]),
                               (PetscScalar*) &amp;(vals[0]), INSERT_VALUES);
          CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">libMesh::COMM_WORLD</a>,ierr);
          
        }
      starting_row_id += this-&gt;rows_per_row_wise_block[i];
    }
  
  ierr = MatSetOption (this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a0c4bcf9f1062be658b4b7033ae1ac628" title="petsc matrix object for this matrix">petsc_mat</a>, MAT_NEW_NONZERO_LOCATION_ERR, PETSC_TRUE);
  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">libMesh::COMM_WORLD</a>,ierr);
  
  ierr = MatSetOption (this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a0c4bcf9f1062be658b4b7033ae1ac628" title="petsc matrix object for this matrix">petsc_mat</a>, MAT_KEEP_ZEROED_ROWS, PETSC_TRUE);
  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">libMesh::COMM_WORLD</a>,ierr);

  this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#a1d957ba8f88dd4cb4438163e5fb7c9ae" title="pointer to the sparse-matrix object that stores the actual matrix">matrix</a>-&gt;close();
  this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#a1d957ba8f88dd4cb4438163e5fb7c9ae" title="pointer to the sparse-matrix object that stores the actual matrix">matrix</a>-&gt;zero();
  
  <span class="comment">// set the flag to true</span>
  this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac2cdf6e259e09022404e536714dbbc10" title="boolean indicating if sparsity pattern has been finalized">finalized_sparsity</a> = <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac3013d48d208d9bee69c057f59a9a968"></a><!-- doxytag: member="FESystemNumerics::PetscMultiBlockSparseMatrix::initRightVector" ref="ac3013d48d208d9bee69c057f59a9a968" args="(NumericVector&lt; T &gt; &amp;vec)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html">FESystemNumerics::PetscMultiBlockSparseMatrix</a>&lt; T &gt;::<a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#ac3013d48d208d9bee69c057f59a9a968">initRightVector</a> </td>
          <td>(</td>
          <td class="paramtype">NumericVector&lt; T &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>initializes the vector to the same parallel distribution as the matrix so that a matrix vector product could be carried out </p>

<p>Implements <a class="el" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#a1ecfed191dd8f8b175f4da1b9123f78f">FESystemNumerics::MultiBlockSparseMatrix&lt; T &gt;</a>.</p>

<p>Definition at line <a class="el" href="_multi_block_sparse_matrix_8_c_source.html#l00441">441</a> of file <a class="el" href="_multi_block_sparse_matrix_8_c_source.html">MultiBlockSparseMatrix.C</a>.</p>
<div class="fragment"><pre class="fragment">{
  Assert(this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac2cdf6e259e09022404e536714dbbc10" title="boolean indicating if sparsity pattern has been finalized">finalized_sparsity</a>, ExcInternalError());
  
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> total_columns = 0; 
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#aaf49b71f7c259509917b7acb854c87a9" title="number of sub-matrices in the column direction">column_dimension</a>; i++) 
    total_columns += this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[i]; 
      
  v.init(total_columns, <span class="keyword">false</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a67a56da519a6397556ac17a634b86e72"></a><!-- doxytag: member="FESystemNumerics::PetscMultiBlockSparseMatrix::update" ref="a67a56da519a6397556ac17a634b86e72" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html">FESystemNumerics::PetscMultiBlockSparseMatrix</a>&lt; T &gt;::<a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a67a56da519a6397556ac17a634b86e72">update</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>updates the matrix from its original submatrices </p>

<p>Implements <a class="el" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#aa7ef70ba0b9a510e0e39cc1077b5d252">FESystemNumerics::MultiBlockSparseMatrix&lt; T &gt;</a>.</p>

<p>Definition at line <a class="el" href="_multi_block_sparse_matrix_8_c_source.html#l00365">365</a> of file <a class="el" href="_multi_block_sparse_matrix_8_c_source.html">MultiBlockSparseMatrix.C</a>.</p>

<p>References <a class="el" href="_f_e_system_common_8h_source.html#l00013">FESystem::COMM_WORLD</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">// update the sparsity if it has not been done so far</span>
  <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac2cdf6e259e09022404e536714dbbc10" title="boolean indicating if sparsity pattern has been finalized">finalized_sparsity</a>) 
    this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#af79af69d6732891ee5a9e9815627f220" title="finalize sparsity so that only value changes are allowed after this">finalizeSparsity</a>();
 
  <span class="comment">// now set the values</span>
  <span class="keywordtype">int</span> elem_num = 0, starting_row_id = 0, starting_col_id = 0;
  <span class="keywordtype">int</span> n_rows =0, n_cols = 0, my_rows=0;
  std::vector&lt;int&gt; col_ids_vec(50); 
  PetscErrorCode ierr = 0;
  
  this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#a1d957ba8f88dd4cb4438163e5fb7c9ae" title="pointer to the sparse-matrix object that stores the actual matrix">matrix</a>-&gt;zero();
  this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#a1d957ba8f88dd4cb4438163e5fb7c9ae" title="pointer to the sparse-matrix object that stores the actual matrix">matrix</a>-&gt;close();
  
  <span class="comment">// next, set the values of the matrix entries</span>
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#af85bcac802c30db9e282f5a3e0ebd255" title="number of sub-matrices in the row direction">row_dimension</a>; i++)
    {
      <span class="comment">// the size is calculated based on the columns of each matrix in a block-row.</span>
      <span class="comment">// get the sparsity pattern for each row</span>
      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#aaf49b71f7c259509917b7acb854c87a9" title="number of sub-matrices in the column direction">column_dimension</a>; j++)
        {
          elem_num = i * this-&gt;column_dimension + j;
          SparseMatrix&lt;T&gt;* mat = this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad60655e7309b73dcb410d4b3459d05a7">sub_matrices</a>[elem_num];
          <span class="keywordflow">if</span> (mat != NULL)
            {
              mat-&gt;close();
              Mat pmat = <span class="keyword">dynamic_cast&lt;</span>PetscMatrix&lt;T&gt;*<span class="keyword">&gt;</span> (mat)-&gt;mat();
              <span class="comment">// get the row ij indices</span>
              ierr = MatGetSize(pmat, &amp;n_rows, &amp;n_cols);
              CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>,ierr);
              Assert(n_rows == this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad5f75ac654932a164ebc8c1af61fa025" title="stores the number of rows in each row-wise block">rows_per_row_wise_block</a>[i], ExcInternalError());
              Assert(n_cols == this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[j], ExcInternalError());

              <span class="keyword">const</span> PetscInt *col_ids = PETSC_NULL;
              <span class="keyword">const</span> PetscScalar *vals = PETSC_NULL;
              <span class="comment">// iterate over the rows in this matrix</span>
              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k &lt; n_rows; k++)
                {
                  <span class="keywordtype">int</span> n_cols_in_row = 0;
                  ierr = MatGetRow(pmat, k, &amp;n_cols_in_row, &amp;col_ids, &amp;vals);
                  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>,ierr);
                  
                  <span class="comment">// next, copy the values of the array into a vector and shift them by the </span>
                  <span class="comment">// appropriate value</span>
                  <span class="comment">// apply the actual shift to the row and column ids</span>
                  my_rows = k + starting_row_id;
                  <span class="keywordflow">if</span> (col_ids_vec.size() &lt; n_cols_in_row)
                    col_ids_vec.resize(n_cols_in_row);
                  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l=0; l &lt; n_cols_in_row; l++)
                    col_ids_vec[l] = col_ids[l] + starting_col_id;
                  <span class="comment">// now set the values in the matrix</span>
                  ierr = MatSetValues(this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a0c4bcf9f1062be658b4b7033ae1ac628" title="petsc matrix object for this matrix">petsc_mat</a>, 1, &amp;my_rows, 
                                      n_cols_in_row, &amp;(col_ids_vec[0]), vals, INSERT_VALUES);
                  
                  <span class="comment">// now restore the matrix row</span>
                  ierr = MatRestoreRow(pmat, k, &amp;n_cols_in_row, &amp;col_ids, &amp;vals);
                  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>,ierr);
                }
            }
          
          starting_col_id += this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ac253ce3b90a0435e136fd872a1f160f8" title="stores the number of columns in each column-wise block">columns_per_column_wise_block</a>[j];
        }
      starting_row_id += this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#ad5f75ac654932a164ebc8c1af61fa025" title="stores the number of rows in each row-wise block">rows_per_row_wise_block</a>[i];
      starting_col_id = 0;
    }
  
  
  <span class="comment">// not finalize the matrix</span>
  this-&gt;<a class="code" href="class_f_e_system_numerics_1_1_multi_block_sparse_matrix.html#a1d957ba8f88dd4cb4438163e5fb7c9ae" title="pointer to the sparse-matrix object that stores the actual matrix">matrix</a>-&gt;close();

}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a0c4bcf9f1062be658b4b7033ae1ac628"></a><!-- doxytag: member="FESystemNumerics::PetscMultiBlockSparseMatrix::petsc_mat" ref="a0c4bcf9f1062be658b4b7033ae1ac628" args="" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">Mat <a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html">FESystemNumerics::PetscMultiBlockSparseMatrix</a>&lt; T &gt;::<a class="el" href="class_f_e_system_numerics_1_1_petsc_multi_block_sparse_matrix.html#a0c4bcf9f1062be658b4b7033ae1ac628">petsc_mat</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>petsc matrix object for this matrix </p>

<p>Definition at line <a class="el" href="_multi_block_sparse_matrix_8h_source.html#l00143">143</a> of file <a class="el" href="_multi_block_sparse_matrix_8h_source.html">MultiBlockSparseMatrix.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/Users/manav/Documents/codes/FESystemOld/FESystem/src/Numerics/<a class="el" href="_multi_block_sparse_matrix_8h_source.html">MultiBlockSparseMatrix.h</a></li>
<li>/Users/manav/Documents/codes/FESystemOld/FESystem/src/Numerics/<a class="el" href="_multi_block_sparse_matrix_8_c_source.html">MultiBlockSparseMatrix.C</a></li>
</ul>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 12 2012 18:06:22 for fesystem by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
