<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>fesystem: Solver::NewtonNonlinearSolver Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">fesystem
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespace_solver.html">Solver</a>      </li>
      <li class="navelem"><a class="el" href="class_solver_1_1_newton_nonlinear_solver.html">NewtonNonlinearSolver</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">Solver::NewtonNonlinearSolver Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="Solver::NewtonNonlinearSolver" --><!-- doxytag: inherits="Solver::NonlinearSolver" -->
<p><code>#include &lt;<a class="el" href="_newton_nonlinear_solver_8h_source.html">NewtonNonlinearSolver.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Solver::NewtonNonlinearSolver:</div>
<div class="dyncontent">
<div class="center"><img src="class_solver_1_1_newton_nonlinear_solver__inherit__graph.gif" border="0" usemap="#_solver_1_1_newton_nonlinear_solver_inherit__map" alt="Inheritance graph"/></div>
<map name="_solver_1_1_newton_nonlinear_solver_inherit__map" id="_solver_1_1_newton_nonlinear_solver_inherit__map">
<area shape="rect" id="node2" href="class_solver_1_1_nonlinear_solver.html" title="Solver::NonlinearSolver" alt="" coords="27,83,188,111"/><area shape="rect" id="node4" href="class_solver_1_1_f_e_system_solver_base.html" title="Solver::FESystemSolverBase" alt="" coords="10,6,205,34"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for Solver::NewtonNonlinearSolver:</div>
<div class="dyncontent">
<div class="center"><img src="class_solver_1_1_newton_nonlinear_solver__coll__graph.gif" border="0" usemap="#_solver_1_1_newton_nonlinear_solver_coll__map" alt="Collaboration graph"/></div>
<map name="_solver_1_1_newton_nonlinear_solver_coll__map" id="_solver_1_1_newton_nonlinear_solver_coll__map">
<area shape="rect" id="node2" href="class_solver_1_1_nonlinear_solver.html" title="Solver::NonlinearSolver" alt="" coords="1027,53,1189,81"/><area shape="rect" id="node4" href="class_solver_1_1_f_e_system_solver_base.html" title="Solver::FESystemSolverBase" alt="" coords="561,194,757,222"/><area shape="rect" id="node6" href="class_driver_1_1_analysis_driver.html" title="Driver::AnalysisDriver" alt="" coords="1033,329,1183,357"/><area shape="rect" id="node27" href="class_solver_1_1_linear_solver.html" title="Solver::LinearSolver" alt="" coords="1037,105,1179,133"/><area shape="rect" id="node8" href="class_solution_1_1_solution_base.html" title="this class provides the base functionality for all solutions" alt="" coords="581,413,736,441"/><area shape="rect" id="node10" href="class_f_e_system_1_1_f_e_system_controller.html" title="FESystem::FESystemController" alt="" coords="19,374,229,402"/><area shape="rect" id="node13" href="class_f_e_system_utility_1_1_auto_ptr_vector.html" title="FESystemUtility::AutoPtrVector\&lt; NumericVector\&lt; double \&gt; \&gt;" alt="" coords="469,465,848,493"/><area shape="rect" id="node15" href="class_f_e_system_utility_1_1_auto_ptr_vector.html" title="FESystemUtility::AutoPtrVector\&lt; T \&gt;" alt="" coords="6,465,242,493"/><area shape="rect" id="node18" href="class_design_data_1_1_design_parameter.html" title="this class forms the base class for all design parameters." alt="" coords="558,295,760,323"/><area shape="rect" id="node20" href="class_solver_1_1_linear_solver_info.html" title="Solver::LinearSolverInfo" alt="" coords="577,58,740,86"/><area shape="rect" id="node22" href="class_solver_1_1_solver_info.html" title="Solver::SolverInfo" alt="" coords="61,33,187,61"/><area shape="rect" id="node24" href="class_solver_1_1_nonlinear_solver_info.html" title="this class stores the information for initialization of a nonlinear solver." alt="" coords="567,6,750,34"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="class_solver_1_1_newton_nonlinear_solver-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#aff8332846b8bd9ada52b6ba750ef1cac">NewtonNonlinearSolver</a> (const <a class="el" href="class_solver_1_1_nonlinear_solver_info.html">Solver::NonlinearSolverInfo</a> &amp;nonlinear_info, const <a class="el" href="class_solver_1_1_linear_solver_info.html">Solver::LinearSolverInfo</a> &amp;linear_info)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#a255478ce39c91a60f9a9cb58de17a745">~NewtonNonlinearSolver</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#a1bb91083ee56236b83138e4ea949f26b">clear</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#afbb6e11862cd7f9c5a606e7f4429cf33">solve</a> (NumericVector&lt; double &gt; &amp;solution)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#a965f84fb6609819f896ecb928a3a7bd9">getCurrentIterationNumber</a> () const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">this returns the itertion number of the solution process  <a href="#a965f84fb6609819f896ecb928a3a7bd9"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#ac2e9d9342d71a9ed51ca1048d88cf575">iteration_number</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">iteration number  <a href="#ac2e9d9342d71a9ed51ca1048d88cf575"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_solver_1_1_linear_solver.html">Solver::LinearSolver</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed">linear_solver</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">a linear solver is needed to solve the equations at each itertion  <a href="#a1456773a200034e2d0ae6bd39f5675ed"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_newton_nonlinear_solver_8h_source.html#l00036">36</a> of file <a class="el" href="_newton_nonlinear_solver_8h_source.html">NewtonNonlinearSolver.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aff8332846b8bd9ada52b6ba750ef1cac"></a><!-- doxytag: member="Solver::NewtonNonlinearSolver::NewtonNonlinearSolver" ref="aff8332846b8bd9ada52b6ba750ef1cac" args="(const Solver::NonlinearSolverInfo &amp;nonlinear_info, const Solver::LinearSolverInfo &amp;linear_info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#aff8332846b8bd9ada52b6ba750ef1cac">Solver::NewtonNonlinearSolver::NewtonNonlinearSolver</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_solver_1_1_nonlinear_solver_info.html">Solver::NonlinearSolverInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>nonlinear_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_solver_1_1_linear_solver_info.html">Solver::LinearSolverInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>linear_info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_newton_nonlinear_solver_8_c_source.html#l00017">17</a> of file <a class="el" href="_newton_nonlinear_solver_8_c_source.html">NewtonNonlinearSolver.C</a>.</p>

<p>References <a class="el" href="_f_e_system_solver_base_8_c_source.html#l00071">Solver::createLinearSolver()</a>.</p>
<div class="fragment"><pre class="fragment">                                           :
<a class="code" href="class_solver_1_1_nonlinear_solver.html#a984878dc5ab853d55c693def32737ea8" title="constructor">Solver::NonlinearSolver</a>(nonlinear_info, linear_info),
<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#ac2e9d9342d71a9ed51ca1048d88cf575" title="iteration number">iteration_number</a>(0),
<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed" title="a linear solver is needed to solve the equations at each itertion">linear_solver</a>(NULL)
{
  this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed" title="a linear solver is needed to solve the equations at each itertion">linear_solver</a> = 
  <a class="code" href="namespace_solver.html#afaa2e61fd8c5864396f9df6ae4ce0017">Solver::createLinearSolver</a>(linear_info).release();
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_solver_1_1_newton_nonlinear_solver_aff8332846b8bd9ada52b6ba750ef1cac_cgraph.gif" border="0" usemap="#class_solver_1_1_newton_nonlinear_solver_aff8332846b8bd9ada52b6ba750ef1cac_cgraph" alt=""/></div>
<map name="class_solver_1_1_newton_nonlinear_solver_aff8332846b8bd9ada52b6ba750ef1cac_cgraph" id="class_solver_1_1_newton_nonlinear_solver_aff8332846b8bd9ada52b6ba750ef1cac_cgraph">
<area shape="rect" id="node3" href="namespace_solver.html#afaa2e61fd8c5864396f9df6ae4ce0017" title="Solver::createLinearSolver" alt="" coords="408,5,587,33"/><area shape="rect" id="node5" href="class_solver_1_1_linear_solver_info.html#a1bae8eaeb2cbf0811b0d32d0e80b09a5" title="Solver::LinearSolverInfo::getLinearSolverEnumID" alt="" coords="634,5,947,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a255478ce39c91a60f9a9cb58de17a745"></a><!-- doxytag: member="Solver::NewtonNonlinearSolver::~NewtonNonlinearSolver" ref="a255478ce39c91a60f9a9cb58de17a745" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#a255478ce39c91a60f9a9cb58de17a745">Solver::NewtonNonlinearSolver::~NewtonNonlinearSolver</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_newton_nonlinear_solver_8_c_source.html#l00030">30</a> of file <a class="el" href="_newton_nonlinear_solver_8_c_source.html">NewtonNonlinearSolver.C</a>.</p>

<p>References <a class="el" href="_newton_nonlinear_solver_8h_source.html#l00064">linear_solver</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">delete</span> this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed" title="a linear solver is needed to solve the equations at each itertion">linear_solver</a>;
  this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed" title="a linear solver is needed to solve the equations at each itertion">linear_solver</a> = NULL;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a1bb91083ee56236b83138e4ea949f26b"></a><!-- doxytag: member="Solver::NewtonNonlinearSolver::clear" ref="a1bb91083ee56236b83138e4ea949f26b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#a1bb91083ee56236b83138e4ea949f26b">Solver::NewtonNonlinearSolver::clear</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>method to clear the data structures of this object. This should be called each time the user completes solution and does not need this object. </p>

<p>Reimplemented from <a class="el" href="class_solver_1_1_nonlinear_solver.html#a422f3547acce024d4de7a18840d29ca9">Solver::NonlinearSolver</a>.</p>

<p>Definition at line <a class="el" href="_newton_nonlinear_solver_8_c_source.html#l00039">39</a> of file <a class="el" href="_newton_nonlinear_solver_8_c_source.html">NewtonNonlinearSolver.C</a>.</p>

<p>References <a class="el" href="_nonlinear_solver_8_c_source.html#l00035">Solver::NonlinearSolver::clear()</a>, and <a class="el" href="_f_e_system_numbers_8h_source.html#l00010">FESystemNumbers::InvalidID</a>.</p>
<div class="fragment"><pre class="fragment">{
  this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#ac2e9d9342d71a9ed51ca1048d88cf575" title="iteration number">iteration_number</a> = <a class="code" href="namespace_f_e_system_numbers.html#a6247b3ec1c348e954beffbd2fabd2bef" title="an ID that will always be considered to be invalid in the code.">FESystemNumbers::InvalidID</a>;
  <a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#a1bb91083ee56236b83138e4ea949f26b">Solver::NonlinearSolver::clear</a>();
  this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed" title="a linear solver is needed to solve the equations at each itertion">linear_solver</a>-&gt;<a class="code" href="class_solver_1_1_linear_solver.html#adf5fbac605f462db9ce974a2b20aee4f" title="method to clear the data structures after use">clear</a>();
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_solver_1_1_newton_nonlinear_solver_a1bb91083ee56236b83138e4ea949f26b_cgraph.gif" border="0" usemap="#class_solver_1_1_newton_nonlinear_solver_a1bb91083ee56236b83138e4ea949f26b_cgraph" alt=""/></div>
<map name="class_solver_1_1_newton_nonlinear_solver_a1bb91083ee56236b83138e4ea949f26b_cgraph" id="class_solver_1_1_newton_nonlinear_solver_a1bb91083ee56236b83138e4ea949f26b_cgraph">
<area shape="rect" id="node3" href="class_solver_1_1_nonlinear_solver.html#a422f3547acce024d4de7a18840d29ca9" title="method to clear the data structures of this class" alt="" coords="296,5,494,33"/><area shape="rect" id="node5" href="class_solver_1_1_f_e_system_solver_base.html#a8a0975de208bb425f4c1b21d12a9f7b0" title="Solver::FESystemSolverBase::clear" alt="" coords="541,5,774,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a965f84fb6609819f896ecb928a3a7bd9"></a><!-- doxytag: member="Solver::NewtonNonlinearSolver::getCurrentIterationNumber" ref="a965f84fb6609819f896ecb928a3a7bd9" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#a965f84fb6609819f896ecb928a3a7bd9">Solver::NewtonNonlinearSolver::getCurrentIterationNumber</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>this returns the itertion number of the solution process </p>

<p>Implements <a class="el" href="class_solver_1_1_nonlinear_solver.html#a9728988b4ae6f8dd40a09207e9243c84">Solver::NonlinearSolver</a>.</p>

<p>Definition at line <a class="el" href="_newton_nonlinear_solver_8h_source.html#l00076">76</a> of file <a class="el" href="_newton_nonlinear_solver_8h_source.html">NewtonNonlinearSolver.h</a>.</p>

<p>References <a class="el" href="_newton_nonlinear_solver_8h_source.html#l00061">iteration_number</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#ac2e9d9342d71a9ed51ca1048d88cf575" title="iteration number">iteration_number</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afbb6e11862cd7f9c5a606e7f4429cf33"></a><!-- doxytag: member="Solver::NewtonNonlinearSolver::solve" ref="afbb6e11862cd7f9c5a606e7f4429cf33" args="(NumericVector&lt; double &gt; &amp;solution)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#afbb6e11862cd7f9c5a606e7f4429cf33">Solver::NewtonNonlinearSolver::solve</a> </td>
          <td>(</td>
          <td class="paramtype">NumericVector&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>solution</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>function to perform solution steps. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">solution</td><td>vector in which the solution will be returned. This should be initialized to the initial guess </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="class_solver_1_1_nonlinear_solver.html#a906fea55e6ccf680e5820577c66bd1b5">Solver::NonlinearSolver</a>.</p>

<p>Definition at line <a class="el" href="_newton_nonlinear_solver_8_c_source.html#l00050">50</a> of file <a class="el" href="_newton_nonlinear_solver_8_c_source.html">NewtonNonlinearSolver.C</a>.</p>

<p>References <a class="el" href="_f_e_system_common_8h_source.html#l00013">FESystem::COMM_WORLD</a>, and <a class="el" href="_parallel_utility_8h_source.html#l00034">FESystemUtility::Parallel::PrintAll()</a>.</p>
<div class="fragment"><pre class="fragment">{
  this-&gt;<a class="code" href="class_solver_1_1_f_e_system_solver_base.html#ad52a2063f53a41980f6da440ba289c64" title="analysis driver pointer">analysis_driver</a>-&gt;<a class="code" href="class_driver_1_1_analysis_driver.html#afc031cf4f9058917779cec23a3f8b995">getFESystemController</a>().<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a4201bf5919eac5fb0fcc87ba36368d6c" title="Performance logging.">performance_logging</a>-&gt;setEvent
  (<span class="stringliteral">&quot;NewtonNonlinearSolver::solve()&quot;</span>, <span class="stringliteral">&quot;Solver&quot;</span>);

  this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed" title="a linear solver is needed to solve the equations at each itertion">linear_solver</a>-&gt;<a class="code" href="class_solver_1_1_f_e_system_solver_base.html#a97e3bee31e0fe943a0f3b4f51a738293">attachAnalysisDriver</a>(this-&gt;<a class="code" href="class_solver_1_1_f_e_system_solver_base.html#ad52a2063f53a41980f6da440ba289c64" title="analysis driver pointer">analysis_driver</a>);
  
  <span class="comment">// create a vector to store the solution and delta solution at each iteration</span>
  Vec petsc_delta_sol, petsc_new_sol;
  PetscVector&lt;double&gt;&amp; sol_vec = <span class="keyword">dynamic_cast&lt;</span>PetscVector&lt;double&gt;&amp;<span class="keyword">&gt;</span>(solution);
  
  PetscErrorCode ierr = 0;
  ierr = VecDuplicate(sol_vec.vec(), &amp;petsc_delta_sol);
  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, ierr);
  
  ierr = VecDuplicate(sol_vec.vec(), &amp;petsc_new_sol);
  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, ierr);
  
  PetscVector&lt;double&gt;  delta_solution(petsc_delta_sol), new_sol(petsc_new_sol);
  delta_solution.zero();
  new_sol = solution;
  
  <span class="comment">// get the tolerance and max iterations from solver info</span>
  <span class="keyword">const</span> <span class="keywordtype">double</span> nonlinear_tol = this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#ad0682425342079055b93b348ef84eed3">nonlinear_solver_info</a>.<a class="code" href="class_solver_1_1_nonlinear_solver_info.html#aedbb95520b8de73a6ccfd7b218605f36">getConvergenceTolerance</a>();
  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nonlinear_maxits = this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#ad0682425342079055b93b348ef84eed3">nonlinear_solver_info</a>.<a class="code" href="class_solver_1_1_nonlinear_solver_info.html#a564250db21ea91e90dc0996233337caf">getMaximumIterations</a>();
  
  <span class="comment">// next, iterate till the termination criterion is satisfied  </span>
  <span class="keywordtype">double</span> old_res_norm = 0.0, new_res_norm = 0.0, delta_sol_norm = 0.0;
  
  <span class="keywordflow">for</span> (this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#ac2e9d9342d71a9ed51ca1048d88cf575" title="iteration number">iteration_number</a> = 0 ;this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#ac2e9d9342d71a9ed51ca1048d88cf575" title="iteration number">iteration_number</a> &lt; nonlinear_maxits; 
       this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#ac2e9d9342d71a9ed51ca1048d88cf575" title="iteration number">iteration_number</a>++)
    {
    this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#ac0842526503e86b65fb62859882767dd">evaluateResidual</a>(new_sol, *(this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#a0545a0965550e1030ff3da37237f0aa6">residual</a>));
    this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#a0545a0965550e1030ff3da37237f0aa6">residual</a>-&gt;close();
        
    <span class="comment">// calculate the norm of rhs. if norm is less than tolerance, break the loop</span>
    new_res_norm = this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#a0545a0965550e1030ff3da37237f0aa6">residual</a>-&gt;l2_norm();
    
      {
        std::ostringstream oss;
        oss &lt;&lt; <span class="stringliteral">&quot;rhs norm : &quot;</span>&lt;&lt; new_res_norm &lt;&lt; std::endl;
        <a class="code" href="namespace_f_e_system_utility_1_1_parallel.html#ada2fd6d252a18aa62e81cfedab493838">FESystemUtility::Parallel::PrintAll</a>(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, oss.str());
      }
                                    
    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#ac2e9d9342d71a9ed51ca1048d88cf575" title="iteration number">iteration_number</a> == 0 ||  new_res_norm &lt; old_res_norm)
      {
        old_res_norm = new_res_norm;
                solution = new_sol;
      
      <span class="keywordflow">if</span> (new_res_norm &lt; nonlinear_tol)
        {
              <a class="code" href="namespace_f_e_system_utility_1_1_parallel.html#ada2fd6d252a18aa62e81cfedab493838">FESystemUtility::Parallel::PrintAll</a>(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, 
                                            <span class="stringliteral">&quot;*** Nonlinear iterations converged through residual norm ***&quot;</span> );
              <span class="keywordflow">break</span>;
        }
      }
    <span class="keywordflow">else</span>
      {
      <span class="comment">// diverging solution</span>
                old_res_norm = new_res_norm;
        <a class="code" href="namespace_f_e_system_utility_1_1_parallel.html#ada2fd6d252a18aa62e81cfedab493838">FESystemUtility::Parallel::PrintAll</a>(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, <span class="stringliteral">&quot;*** Diverging Nonlinear iterations***&quot;</span>);
<span class="comment">//      break;</span>
      }
    
    <span class="comment">// zero the solution vector before going into the solution</span>
    this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#a14cef38b5f11640083d91720b20d9f0c">evaluateJacobian</a>(new_sol, *(this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#a640c094ca7de523e806408d30ab03720">jacobian</a>));
    this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#a640c094ca7de523e806408d30ab03720">jacobian</a>-&gt;close();
    this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#a0545a0965550e1030ff3da37237f0aa6">residual</a>-&gt;close(); delta_solution.close();
    
    <span class="comment">//Solve the linear system to calculate the delta_T for this iteration.</span>
    delta_solution.zero();
    this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed" title="a linear solver is needed to solve the equations at each itertion">linear_solver</a>-&gt;<a class="code" href="class_solver_1_1_linear_solver.html#ac94f10e970be59bf27468b6e2cc9ea6b">setSystemMatrix</a>(*(this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#a640c094ca7de523e806408d30ab03720">jacobian</a>));
    this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed" title="a linear solver is needed to solve the equations at each itertion">linear_solver</a>-&gt;<a class="code" href="class_solver_1_1_linear_solver.html#accc4d30bb755afcd90b457d648e5ad43">setPreconditionerMatrix</a>(*(this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#a640c094ca7de523e806408d30ab03720">jacobian</a>));
    this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed" title="a linear solver is needed to solve the equations at each itertion">linear_solver</a>-&gt;<a class="code" href="class_solver_1_1_linear_solver.html#aa2932e9f9425532adfb25e1331d63a01">solve</a>(*(this-&gt;<a class="code" href="class_solver_1_1_nonlinear_solver.html#a0545a0965550e1030ff3da37237f0aa6">residual</a>), delta_solution);
    
<span class="comment">// {  </span>
<span class="comment">//      std::auto_ptr&lt;PetscVector&lt;double&gt; &gt; old_res(new PetscVector&lt;double&gt;(this-&gt;residual-&gt;size()));</span>
<span class="comment">//      std::auto_ptr&lt;PetscVector&lt;double&gt; &gt; new_vec(new PetscVector&lt;double&gt;(this-&gt;residual-&gt;size()));</span>
<span class="comment">//      std::auto_ptr&lt;PetscVector&lt;double&gt; &gt; est_res(new PetscVector&lt;double&gt;(this-&gt;residual-&gt;size()));</span>
<span class="comment">//      std::auto_ptr&lt;PetscVector&lt;double&gt; &gt; frac_delta(new PetscVector&lt;double&gt;(this-&gt;residual-&gt;size()));</span>
<span class="comment">//      </span>
<span class="comment">//      *(old_res.get()) = *(this-&gt;residual);</span>
<span class="comment">//</span>
<span class="comment">//      // now calculate res and estimate it at different X and see if the two are</span>
<span class="comment">//      // tangent or not</span>
<span class="comment">//      unsigned int n_steps = 20;</span>
<span class="comment">//      std::vector&lt;double&gt; fract(n_steps+1), estimate(n_steps+1), actual(n_steps+1);</span>
<span class="comment">//      </span>
<span class="comment">//      double fraction = 0.0, dx = 1.0 / n_steps,</span>
<span class="comment">//        lower = -1.0, upper = 1.0;</span>
<span class="comment">//      for (unsigned int i=0; i &lt;= n_steps; i++)</span>
<span class="comment">//        {</span>
<span class="comment">//        // calculate the values of X</span>
<span class="comment">//        new_vec-&gt;close();</span>
<span class="comment">//        new_sol.close();</span>
<span class="comment">//        fraction = lower + dx * i * (upper - lower);</span>
<span class="comment">//        *new_vec = new_sol;</span>
<span class="comment">//        new_vec-&gt;close();</span>
<span class="comment">//        new_vec-&gt;add(-fraction, delta_solution);</span>
<span class="comment">//        new_vec-&gt;close();</span>
<span class="comment">//        // calculate the exact value of residual</span>
<span class="comment">//        this-&gt;residual-&gt;zero();</span>
<span class="comment">//        this-&gt;residual-&gt;close();</span>
<span class="comment">//        this-&gt;evaluateResidual(*new_vec, *(this-&gt;residual));</span>
<span class="comment">//        this-&gt;residual-&gt;close();</span>
<span class="comment">//                  </span>
<span class="comment">//        // calculate the estimated residual</span>
<span class="comment">//        est_res-&gt;zero();</span>
<span class="comment">//        est_res-&gt;close();</span>
<span class="comment">//        frac_delta-&gt;zero();</span>
<span class="comment">//        frac_delta-&gt;close();</span>
<span class="comment">//        </span>
<span class="comment">//        frac_delta-&gt;add(-fraction, delta_solution);</span>
<span class="comment">//        frac_delta-&gt;close();</span>
<span class="comment">//        </span>
<span class="comment">//        this-&gt;jacobian-&gt;multiply_vector(*(frac_delta.get()),</span>
<span class="comment">//                                        *(est_res.get()));</span>
<span class="comment">//        est_res-&gt;close();</span>
<span class="comment">//        </span>
<span class="comment">//        est_res-&gt;add(*(old_res.get()));</span>
<span class="comment">//        est_res-&gt;close();</span>
<span class="comment">//        </span>
<span class="comment">//        fract[i] = fraction;</span>
<span class="comment">//        actual[i] = this-&gt;residual-&gt;l2_norm();</span>
<span class="comment">//        estimate[i] = est_res-&gt;l2_norm();</span>
<span class="comment">//        }</span>
<span class="comment">//</span><span class="comment"></span>
<span class="comment">////      for (unsigned int it=0; it &lt; fract.size(); it++)</span>
<span class="comment">////        std::cout &lt;&lt; fract[it] &lt;&lt; &quot;   &quot; </span>
<span class="comment">////          &lt;&lt; actual[it] &lt;&lt; &quot;   &quot;</span>
<span class="comment">////          &lt;&lt; estimate[it] &lt;&lt; &quot;\n&quot;;</span>
<span class="comment"></span><span class="comment">//      </span>
<span class="comment">//      PetscDraw draw;</span>
<span class="comment">//      PetscDrawLG lgdraw;</span>
<span class="comment">//      PetscDrawOpenX(FESystem::COMM_WORLD, PETSC_NULL, &quot;residual_plot&quot;, PETSC_DECIDE, </span>
<span class="comment">//                     PETSC_DECIDE, PETSC_DRAW_HALF_SIZE, PETSC_DRAW_HALF_SIZE, &amp;draw);</span>
<span class="comment">//      PetscDrawSetPause(draw, -1);</span>
<span class="comment">//      PetscDrawLGCreate(draw, 2, &amp;lgdraw);</span>
<span class="comment">//      double x[2],y[2];</span>
<span class="comment">//      for (unsigned int it=0; it &lt; fract.size(); it++)</span>
<span class="comment">//        {</span>
<span class="comment">//        x[0]= fract[it]; x[1]=fract[it];</span>
<span class="comment">//        y[0] = actual[it]; y[1]= estimate[it];</span>
<span class="comment">//        PetscDrawLGAddPoint(lgdraw, x,y);</span>
<span class="comment">//        }</span>
<span class="comment">//      PetscDrawLGDraw(lgdraw);</span>
<span class="comment">//      PetscDrawPause(draw);</span>
<span class="comment">//      </span>
<span class="comment">//      PetscDrawDestroy(draw);</span>
<span class="comment">//    }</span>
    
    <span class="comment">// calculate the solution vector for next iteration</span>
    delta_solution.close();
    new_sol.add(-1.0, delta_solution);
    new_sol.close(); <span class="comment">// this now contains the new solution</span>
    delta_sol_norm = delta_solution.l2_norm();
    
      {
        std::ostringstream oss;
        oss &lt;&lt; <span class="stringliteral">&quot;delta_sol norm : &quot;</span>&lt;&lt; delta_sol_norm &lt;&lt; std::endl;
        <a class="code" href="namespace_f_e_system_utility_1_1_parallel.html#ada2fd6d252a18aa62e81cfedab493838">FESystemUtility::Parallel::PrintAll</a>(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, oss.str());
      }
    <span class="comment">// calculate the norm of delta_T. if norm is less than tolerance, break the loop</span>
    <span class="keywordflow">if</span> (delta_sol_norm &lt; nonlinear_tol)
      {
      solution = new_sol;
      <a class="code" href="namespace_f_e_system_utility_1_1_parallel.html#ada2fd6d252a18aa62e81cfedab493838">FESystemUtility::Parallel::PrintAll</a>(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, 
                                          <span class="stringliteral">&quot;*** Nonlinear iterations converged through dX norm ***&quot;</span> );
      <span class="keywordflow">break</span>;
      }
    }
  
  
  <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_solver_1_1_newton_nonlinear_solver.html#ac2e9d9342d71a9ed51ca1048d88cf575" title="iteration number">iteration_number</a> == nonlinear_maxits) 
    {
      <a class="code" href="namespace_f_e_system_utility_1_1_parallel.html#ada2fd6d252a18aa62e81cfedab493838">FESystemUtility::Parallel::PrintAll</a>(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, 
                                          <span class="stringliteral">&quot;*** Nonlinear iterations reached maximum iterations limit. ***&quot;</span>);
    }
  
  
  <span class="comment">// finally, before exiting, destroy the two vectors that were created</span>
  ierr = VecDestroy(petsc_delta_sol);
  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, ierr);
  
  ierr = VecDestroy(petsc_new_sol);
  CHKERRABORT(<a class="code" href="namespace_f_e_system.html#a5853d15aa6f256e9f068a040b5f13b6e" title="world MPI communicator for all processors">FESystem::COMM_WORLD</a>, ierr);
  
  this-&gt;<a class="code" href="class_solver_1_1_f_e_system_solver_base.html#ad52a2063f53a41980f6da440ba289c64" title="analysis driver pointer">analysis_driver</a>-&gt;<a class="code" href="class_driver_1_1_analysis_driver.html#afc031cf4f9058917779cec23a3f8b995">getFESystemController</a>().<a class="code" href="class_f_e_system_1_1_f_e_system_controller.html#a4201bf5919eac5fb0fcc87ba36368d6c" title="Performance logging.">performance_logging</a>-&gt;unsetEvent
    (<span class="stringliteral">&quot;NewtonNonlinearSolver::solve()&quot;</span>, <span class="stringliteral">&quot;Solver&quot;</span>);
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_solver_1_1_newton_nonlinear_solver_afbb6e11862cd7f9c5a606e7f4429cf33_cgraph.gif" border="0" usemap="#class_solver_1_1_newton_nonlinear_solver_afbb6e11862cd7f9c5a606e7f4429cf33_cgraph" alt=""/></div>
<map name="class_solver_1_1_newton_nonlinear_solver_afbb6e11862cd7f9c5a606e7f4429cf33_cgraph" id="class_solver_1_1_newton_nonlinear_solver_afbb6e11862cd7f9c5a606e7f4429cf33_cgraph">
<area shape="rect" id="node3" href="namespace_f_e_system_utility_1_1_parallel.html#ada2fd6d252a18aa62e81cfedab493838" title="FESystemUtility::Parallel::PrintAll" alt="" coords="300,5,516,33"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ac2e9d9342d71a9ed51ca1048d88cf575"></a><!-- doxytag: member="Solver::NewtonNonlinearSolver::iteration_number" ref="ac2e9d9342d71a9ed51ca1048d88cf575" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#ac2e9d9342d71a9ed51ca1048d88cf575">Solver::NewtonNonlinearSolver::iteration_number</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>iteration number </p>

<p>Definition at line <a class="el" href="_newton_nonlinear_solver_8h_source.html#l00061">61</a> of file <a class="el" href="_newton_nonlinear_solver_8h_source.html">NewtonNonlinearSolver.h</a>.</p>

<p>Referenced by <a class="el" href="_newton_nonlinear_solver_8h_source.html#l00076">getCurrentIterationNumber()</a>.</p>

</div>
</div>
<a class="anchor" id="a1456773a200034e2d0ae6bd39f5675ed"></a><!-- doxytag: member="Solver::NewtonNonlinearSolver::linear_solver" ref="a1456773a200034e2d0ae6bd39f5675ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_solver_1_1_linear_solver.html">Solver::LinearSolver</a>* <a class="el" href="class_solver_1_1_newton_nonlinear_solver.html#a1456773a200034e2d0ae6bd39f5675ed">Solver::NewtonNonlinearSolver::linear_solver</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>a linear solver is needed to solve the equations at each itertion </p>

<p>Definition at line <a class="el" href="_newton_nonlinear_solver_8h_source.html#l00064">64</a> of file <a class="el" href="_newton_nonlinear_solver_8h_source.html">NewtonNonlinearSolver.h</a>.</p>

<p>Referenced by <a class="el" href="_newton_nonlinear_solver_8_c_source.html#l00030">~NewtonNonlinearSolver()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/Users/manav/Documents/codes/FESystemOld/FESystem/src/Solvers/<a class="el" href="_newton_nonlinear_solver_8h_source.html">NewtonNonlinearSolver.h</a></li>
<li>/Users/manav/Documents/codes/FESystemOld/FESystem/src/Solvers/<a class="el" href="_newton_nonlinear_solver_8_c_source.html">NewtonNonlinearSolver.C</a></li>
</ul>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 12 2012 18:06:23 for fesystem by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
